<!DOCTYPE html><html lang="zh"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,minimal-ui"><meta name="renderer" content="webkit"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="theme-color" content="#000000"><meta http-equiv="window-target" content="_top"><title>星云盘 | 星辰大海</title><meta name="description" content="星云盘以下是整个项目的代码，时间截至2023-06-03 16:42:57 整个目录的划分未  annotation aspect component controller entity config constants dto enums po query vo   exception mappers service task utils  annotation包GlobalIntercepto"><meta property="og:type" content="article"><meta property="og:title" content="星云盘"><meta property="og:url" content="http://www.xc234.ltd/2023/06/03/%E6%98%9F%E4%BA%91%E7%9B%98/index.html"><meta property="og:site_name" content="星辰大海"><meta property="og:description" content="星云盘以下是整个项目的代码，时间截至2023-06-03 16:42:57 整个目录的划分未  annotation aspect component controller entity config constants dto enums po query vo   exception mappers service task utils  annotation包GlobalIntercepto"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2023-06-03T08:42:57.000Z"><meta property="article:modified_time" content="2023-06-03T09:15:39.237Z"><meta property="article:author" content="Xingchen"><meta name="twitter:card" content="summary"><link rel="canonical" href="http://www.xc234.ltd/2023/06/03/%E6%98%9F%E4%BA%91%E7%9B%98/index.html"><link rel="icon" href="/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="星辰大海" type="application/atom+xml"></head><body class="main-center" itemscope itemtype="http://schema.org/WebPage"><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="slimContent"><div class="navbar-header"><div class="profile-block text-center"><a id="avatar" href="https://github.com/HAOTIANXINGCHEN" target="_blank"><img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200"></a><h2 id="name" class="hidden-xs hidden-sm">星辰</h2><h3 id="title" class="hidden-xs hidden-sm hidden-md">不断学习的小菜鸡</h3><small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Shanghai, China</small></div><div class="search" id="search-form-wrap"><form class="search-form sidebar-form"><div class="input-group"><input type="text" class="search-form-input form-control" placeholder="搜索"> <span class="input-group-btn"><button type="submit" class="search-form-submit btn btn-flat" onclick="return!1"><i class="icon icon-search"></i></button></span></div></form><div class="ins-search"><div class="ins-search-mask"></div><div class="ins-search-container"><div class="ins-input-wrapper"><input type="text" class="ins-search-input" placeholder="想要查找什么..." x-webkit-speech> <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button></div><div class="ins-section-wrapper"><div class="ins-section-container"></div></div></div></div></div><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button></div><nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation"><ul class="nav navbar-nav main-nav menu-highlight"><li class="menu-item menu-item-home"><a href="/."><i class="icon icon-home-fill"></i> <span class="menu-title">首页</span></a></li><li class="menu-item menu-item-archives"><a href="/archives"><i class="icon icon-archives-fill"></i> <span class="menu-title">归档</span></a></li><li class="menu-item menu-item-categories"><a href="/categories"><i class="icon icon-folder"></i> <span class="menu-title">分类</span></a></li><li class="menu-item menu-item-tags"><a href="/tags"><i class="icon icon-tags"></i> <span class="menu-title">标签</span></a></li><li class="menu-item menu-item-repository"><a href="/repository"><i class="icon icon-project"></i> <span class="menu-title">项目</span></a></li><li class="menu-item menu-item-books"><a href="/books"><i class="icon icon-book-fill"></i> <span class="menu-title">书单</span></a></li><li class="menu-item menu-item-links"><a href="/links"><i class="icon icon-friendship"></i> <span class="menu-title">友链</span></a></li><li class="menu-item menu-item-about"><a href="/about"><i class="icon icon-cup-fill"></i> <span class="menu-title">关于</span></a></li></ul><ul class="social-links"><li><a href="https://github.com/HAOTIANXINGCHEN" target="_blank" title="Github"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/u/5202817724" target="_blank" title="Weibo"><i class="icon icon-weibo"></i></a></li><li><a href="/null" target="_blank" title="Twitter"><i class="icon icon-twitter"></i></a></li><li><a href="/null" target="_blank" title="Behance"><i class="icon icon-behance"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss"><i class="icon icon-rss"></i></a></li></ul></nav></div></header><aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar"><div class="slimContent"><div class="widget"><h3 class="widget-title">公告</h3><div class="widget-body"><div id="board"><div class="content"><p>欢迎交流与分享经验!</p></div></div></div></div><div class="widget"><h3 class="widget-title">分类</h3><div class="widget-body"><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%89%BA%E6%9C%AF/">艺术</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签</h3><div class="widget-body"><ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/MQ/" rel="tag">MQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySql/" rel="tag">MySql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SpringCloud/" rel="tag">SpringCloud</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java%E5%90%8E%E7%AB%AF/" rel="tag">java后端</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9B%BE%E7%89%87/" rel="tag">图片</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%AC%E5%9C%B0/" rel="tag">本地</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%B4%A2%E5%BC%95/" rel="tag">索引</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%89%BA%E6%9C%AF%E5%AE%B6/" rel="tag">艺术家</a><span class="tag-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">标签云</h3><div class="widget-body tagcloud"><a href="/tags/MQ/" style="font-size:13px">MQ</a> <a href="/tags/MySql/" style="font-size:13px">MySql</a> <a href="/tags/Redis/" style="font-size:13px">Redis</a> <a href="/tags/SpringBoot/" style="font-size:13px">SpringBoot</a> <a href="/tags/SpringCloud/" style="font-size:13px">SpringCloud</a> <a href="/tags/java%E5%90%8E%E7%AB%AF/" style="font-size:13px">java后端</a> <a href="/tags/test/" style="font-size:13px">test</a> <a href="/tags/%E5%9B%BE%E7%89%87/" style="font-size:13px">图片</a> <a href="/tags/%E6%9C%AC%E5%9C%B0/" style="font-size:13px">本地</a> <a href="/tags/%E7%B4%A2%E5%BC%95/" style="font-size:13px">索引</a> <a href="/tags/%E8%89%BA%E6%9C%AF%E5%AE%B6/" style="font-size:13px">艺术家</a></div></div><div class="widget"><h3 class="widget-title">归档</h3><div class="widget-body"><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/06/">六月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">六月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">三月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a><span class="archive-list-count">1</span></li></ul></div></div><div class="widget"><h3 class="widget-title">最新文章</h3><div class="widget-body"><ul class="recent-post-list list-unstyled no-thumbnail"><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2023/06/03/%E6%98%9F%E4%BA%91%E7%9B%98/" class="title">星云盘</a></p><p class="item-date"><time datetime="2023-06-03T08:42:57.000Z" itemprop="datePublished">2023-06-03</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/07/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="title">设计模式学习笔记</a></p><p class="item-date"><time datetime="2022-07-06T14:25:27.000Z" itemprop="datePublished">2022-07-06</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/06/22/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="title">并发编程学习笔记</a></p><p class="item-date"><time datetime="2022-06-22T14:07:40.000Z" itemprop="datePublished">2022-06-22</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/06/14/2022-2023/" class="title">2022-2023</a></p><p class="item-date"><time datetime="2022-06-14T14:27:24.000Z" itemprop="datePublished">2022-06-14</time></p></div></li><li><div class="item-inner"><p class="item-category"></p><p class="item-title"><a href="/2022/04/04/B%E7%AB%99%E5%90%8E%E7%AB%AF%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/" class="title">(no title)</a></p><p class="item-date"><time datetime="2022-04-04T06:10:44.109Z" itemprop="datePublished">2022-04-04</time></p></div></li></ul></div></div></div></aside><main class="main" role="main"><div class="content"><article id="post-星云盘" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting"><div class="article-header"><h1 class="article-title" itemprop="name">星云盘</h1><div class="article-meta"><span class="article-date"><i class="icon icon-calendar-check"></i> <a href="/2023/06/03/%E6%98%9F%E4%BA%91%E7%9B%98/" class="article-date"><time datetime="2023-06-03T08:42:57.000Z" itemprop="datePublished">2023-06-03</time> </a></span><span class="post-comment"><i class="icon icon-comment"></i> <a href="/2023/06/03/%E6%98%9F%E4%BA%91%E7%9B%98/#comments" class="article-comment-link">评论</a></span> <span class="post-wordcount hidden-xs" itemprop="wordCount">字数统计: 52.4k(字)</span> <span class="post-readcount hidden-xs" itemprop="timeRequired">阅读时长: 284(分)</span></div></div><div class="article-entry marked-body" itemprop="articleBody"><h1 id="星云盘"><a href="#星云盘" class="headerlink" title="星云盘"></a>星云盘</h1><p>以下是整个项目的代码，时间截至2023-06-03 16:42:57</p><p>整个目录的划分未</p><ul><li>annotation</li><li>aspect</li><li>component</li><li>controller</li><li>entity<ul><li>config</li><li>constants</li><li>dto</li><li>enums</li><li>po</li><li>query</li><li>vo</li></ul></li><li>exception</li><li>mappers</li><li>service</li><li>task</li><li>utils</li></ul><h2 id="annotation包"><a href="#annotation包" class="headerlink" title="annotation包"></a>annotation包</h2><h3 id="GlobalInterceptor类"><a href="#GlobalInterceptor类" class="headerlink" title="GlobalInterceptor类"></a>GlobalInterceptor类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.Mapping;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 全局拦截器注解，用于标记需要进行全局拦截的方法或类</span></span><br><span class="line"><span class="comment"> * 可以指定是否需要进行登录校验、参数校验和管理员校验</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 11:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//表示注解的作用目标，也就是注解可以用在什么地方。ElementType.METHOD表示注解可以用在方法上</span></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="comment">//表示注解的保留策略，也就是注解在什么时候有效。RetentionPolicy.RUNTIME表示注解在运行时有效，可以被反射机制读取</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">//表示注解是否会被包含在JavaDoc中</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="comment">//表示注解是否会被映射到请求路径上</span></span><br><span class="line"><span class="meta">@Mapping</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> GlobalInterceptor &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验参数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">checkParams</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">checkLogin</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 检验超级管理员</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">checkAdmin</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="VerifyParam类"><a href="#VerifyParam类" class="headerlink" title="VerifyParam类"></a>VerifyParam类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.VerifyRegexEnum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 参数校验注解，用于标记需要进行参数校验的参数或字段</span></span><br><span class="line"><span class="comment"> * 可以指定校验正则、最小长度、最大长度和是否必填</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 11:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//表示注解的保留策略，也就是注解在什么时候有效。RetentionPolicy.RUNTIME表示注解在运行时有效，可以被反射机制读取</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="comment">//表示注解的作用目标，也就是注解可以用在什么地方。ElementType.PARAMETER表示注解可以用在参数上，ElementType.FIELD表示注解可以用在字段上</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.PARAMETER, ElementType.FIELD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> VerifyParam &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最小长度，默认为-1，表示不限制最小长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 最小长度值，必须大于等于0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">min</span><span class="params">()</span> <span class="keyword">default</span> -1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最大长度，默认为-1，表示不限制最大长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 最大长度值，必须大于等于0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">()</span> <span class="keyword">default</span> -1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否必填，默认为false，表示不必填</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true表示必填，false表示不必</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">required</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验正则，默认为NO，表示不使用正则校验</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 校验正则枚举值，例如EMAIL表示邮箱格式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">VerifyRegexEnum <span class="title">regex</span><span class="params">()</span> <span class="keyword">default</span> VerifyRegexEnum.NO</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="aspect包"><a href="#aspect包" class="headerlink" title="aspect包"></a>aspect包</h2><h3 id="GlobalOperatcionAspect类"><a href="#GlobalOperatcionAspect类" class="headerlink" title="GlobalOperatcionAspect类"></a>GlobalOperatcionAspect类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.aspect;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.GlobalInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.VerifyParam;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.ResponseCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.VerifyUtils;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Pointcut;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.reflect.MethodSignature;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.RequestContextHolder;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.context.request.ServletRequestAttributes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Parameter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 全局操作切面类</span></span><br><span class="line"><span class="comment"> * 使用AOP实现全局拦截器注解的功能，对标注了该注解的方法进行参数校验和其他操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 12:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component(&quot;globalOperatcionAspect&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GlobalOperatcionAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(GlobalOperatcionAspect.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_STRING = <span class="string">&quot;java.lang.String&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_INTEGER = <span class="string">&quot;java.lang.Integer&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TYPE_LONG = <span class="string">&quot;java.lang.Long&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//定义切点，匹配标注了GlobalInterceptor注解的方法</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.xcshare.annotation.GlobalInterceptor)&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">requestInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在切点之前执行，对方法的参数进行校验和其他操作</span></span><br><span class="line">    <span class="meta">@Before(&quot;requestInterceptor()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">interceptorDo</span><span class="params">(JoinPoint point)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Object target = point.getTarget();</span><br><span class="line">            Object[] arguments = point.getArgs();</span><br><span class="line">            String methodName = point.getSignature().getName();</span><br><span class="line">            Class&lt;?&gt;[] parameterTypes = ((MethodSignature) point.getSignature()).getMethod().getParameterTypes();</span><br><span class="line">            Method method = target.getClass().getMethod(methodName, parameterTypes);</span><br><span class="line">            GlobalInterceptor interceptor = method.getAnnotation(GlobalInterceptor.class);</span><br><span class="line">            <span class="keyword">if</span> (interceptor == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 校验登录</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (interceptor.checkLogin() || interceptor.checkAdmin()) &#123;</span><br><span class="line">                checkLogin(interceptor.checkAdmin());</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 校验参数</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (interceptor.checkParams()) &#123;</span><br><span class="line">                validateParams(method, arguments);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BusinessException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;全局拦截器异常&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;全局拦截器异常&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_500);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;全局拦截器异常&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_500);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkAdmin 是否需要校验超级管理员</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果用户未登录或不是超级管理员，抛出业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkLogin</span><span class="params">(Boolean checkAdmin)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取当前请求对象</span></span><br><span class="line">        HttpServletRequest request = ((ServletRequestAttributes) RequestContextHolder.getRequestAttributes()).getRequest();</span><br><span class="line">        <span class="comment">//获取当前会话对象</span></span><br><span class="line">        HttpSession session = request.getSession();</span><br><span class="line">        <span class="comment">//从会话对象中获取用户信息的数据传输对象</span></span><br><span class="line">        SessionWebUserDto userDto = (SessionWebUserDto) session.getAttribute(Constants.SESSION_KEY);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果用户信息为空，说明用户未登录或登录超时，抛出业务异常，响应码为901，响应消息为&quot;登录超时，请重新登录&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (userDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_901);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果需要检验超级管理员，且用户不是超级管理员，抛出业务异常，响应码为404，响应消息为&quot;请求地址不存在&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (checkAdmin &amp;&amp; !userDto.getAdmin()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_404);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验方法的参数是否符合VerifyParam注解的要求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> m         方法对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> arguments 方法的参数数组</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果参数不符合要求，抛出业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">validateParams</span><span class="params">(Method m, Object[] arguments)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        Parameter[] parameters = m.getParameters();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; parameters.length; i++) &#123;</span><br><span class="line">            Parameter parameter = parameters[i];</span><br><span class="line">            Object value = arguments[i];</span><br><span class="line">            VerifyParam verifyParam = parameter.getAnnotation(VerifyParam.class);</span><br><span class="line">            <span class="keyword">if</span> (verifyParam == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//基本数据类型</span></span><br><span class="line">            <span class="keyword">if</span> (TYPE_STRING.equals(parameter.getParameterizedType().getTypeName()) || TYPE_LONG.equals(parameter.getParameterizedType().getTypeName()) || TYPE_INTEGER.equals(parameter.getParameterizedType().getTypeName())) &#123;</span><br><span class="line">                checkValue(value, verifyParam);</span><br><span class="line">                <span class="comment">//如果传递的是对象</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                checkObjValue(parameter, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验对象类型的参数是否符合VerifyParam注解的要求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameter 参数对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value     参数值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果参数不符合要求，抛出业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkObjValue</span><span class="params">(Parameter parameter, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String typeName = parameter.getParameterizedType().getTypeName();</span><br><span class="line">            Class targetClass = Class.forName(typeName);</span><br><span class="line">            Field[] fields = targetClass.getDeclaredFields();</span><br><span class="line">            <span class="keyword">for</span> (Field field : fields) &#123;</span><br><span class="line">                VerifyParam fieldVerifyParam = field.getAnnotation(VerifyParam.class);</span><br><span class="line">                <span class="keyword">if</span> (fieldVerifyParam == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                field.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">                Object resultValue = field.get(value);</span><br><span class="line">                checkValue(resultValue, fieldVerifyParam);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BusinessException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;校验参数失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;校验参数失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验基本数据类型的参数是否符合VerifyParam注解的要求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value       参数值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> verifyParam VerifyParam注解对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果参数不符合要求，抛出业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkValue</span><span class="params">(Object value, VerifyParam verifyParam)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        Boolean isEmpty = value == <span class="keyword">null</span> || StringTools.isEmpty(value.toString());</span><br><span class="line">        Integer length = value == <span class="keyword">null</span> ? <span class="number">0</span> : value.toString().length();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 校验空</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (isEmpty &amp;&amp; verifyParam.required()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 校验长度</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (!isEmpty &amp;&amp; (verifyParam.max() != -<span class="number">1</span> &amp;&amp; verifyParam.max() &lt; length ||</span><br><span class="line">                verifyParam.min() != -<span class="number">1</span> &amp;&amp; verifyParam.min() &gt; length)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 校验正则</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (!isEmpty &amp;&amp; !StringTools.isEmpty(verifyParam.regex().getRegex()) &amp;&amp;</span><br><span class="line">                !VerifyUtils.verify(verifyParam.regex(), String.valueOf(value))) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="component包"><a href="#component包" class="headerlink" title="component包"></a>component包</h2><h3 id="RedisComponent类"><a href="#RedisComponent类" class="headerlink" title="RedisComponent类"></a>RedisComponent类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.DownloadFileDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SysSettingsDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.UserSpaceDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.UserInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.mappers.FileInfoMapper;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.mappers.UserInfoMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> Redis组件类，封装了一些Redis相关的操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 10:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(&quot;redisComponent&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisUtils redisUtils;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoMapper&lt;FileInfo, FileInfoQuery&gt; fileInfoMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoMapper&lt;UserInfo, UserInfoQuery&gt; userInfoMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取系统设置对象，包含一些系统相关的设置信息，例如注册邮件标题、内容等</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 系统设置对象，如果Redis缓存中不存在，则创建一个默认的对象并存入缓存中</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SysSettingsDto <span class="title">getSysSettingsDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SysSettingsDto sysSettingsDto = (SysSettingsDto) redisUtils.get(Constants.REDIS_KEY_SYS_SETTING);</span><br><span class="line">        <span class="keyword">if</span> (sysSettingsDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">            sysSettingsDto = <span class="keyword">new</span> SysSettingsDto();</span><br><span class="line">            redisUtils.set(Constants.REDIS_KEY_SYS_SETTING, sysSettingsDto);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sysSettingsDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存系统设置对象，包含一些系统相关的设置信息，例如注册邮件标题、内容、用户初始可用空间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveSysSettings</span><span class="params">(SysSettingsDto sysSettingsDto)</span> </span>&#123;</span><br><span class="line">        redisUtils.set(Constants.REDIS_KEY_SYS_SETTING, sysSettingsDto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存用户存储空间信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId       用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userSpaceDto 用户空间对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveUserSpaceUse</span><span class="params">(String userId, UserSpaceDto userSpaceDto)</span> </span>&#123;</span><br><span class="line">        redisUtils.set(Constants.REDIS_KEY_USER_SPACE_USE + userId, userSpaceDto, Constants.REDIS_KEY_EXPIRED_DAY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重置用户的存储空间信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserSpaceDto <span class="title">resetUserSpaceUse</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        UserSpaceDto userSpaceDto = <span class="keyword">new</span> UserSpaceDto();</span><br><span class="line">        Long useSpace = <span class="keyword">this</span>.fileInfoMapper.selectUseSpace(userId);</span><br><span class="line">        userSpaceDto.setUseSpace(useSpace);</span><br><span class="line">        UserInfo userInfo = userInfoMapper.selectByUserId(userId);</span><br><span class="line">        userSpaceDto.setTotalSpace(userInfo.getTotalSpace());</span><br><span class="line">        redisUtils.set(Constants.REDIS_KEY_USER_SPACE_USE + userId, userSpaceDto, Constants.REDIS_KEY_EXPIRED_DAY);</span><br><span class="line">        <span class="keyword">return</span> userSpaceDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据用户id获取已使用空间和总空间大小</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserSpaceDto <span class="title">getUserSpaceUse</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        UserSpaceDto spaceDto = (UserSpaceDto) redisUtils.get(Constants.REDIS_KEY_USER_SPACE_USE + userId);</span><br><span class="line">        <span class="keyword">if</span> (spaceDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">            spaceDto = <span class="keyword">new</span> UserSpaceDto();</span><br><span class="line">            Long useSpace = fileInfoMapper.selectUseSpace(userId);</span><br><span class="line">            spaceDto.setUseSpace(useSpace);</span><br><span class="line">            spaceDto.setTotalSpace(getSysSettingsDto().getUserInitUseSpace() * Constants.MB);</span><br><span class="line">            saveUserSpaceUse(userId, spaceDto);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> spaceDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveFileTempSize</span><span class="params">(String userId, String fileId, Long fileSize)</span> </span>&#123;</span><br><span class="line">        Long currentSize = getFileTempSize(userId, fileId);</span><br><span class="line">        redisUtils.set(Constants.REDIS_KEY_USER_FILE_TEMP_SIZE + userId + fileId,</span><br><span class="line">                currentSize + fileSize, Constants.REDIS_KEY_EXPIRED_ONE_HOUR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取临时文件大小</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getFileTempSize</span><span class="params">(String userId, String fileId)</span> </span>&#123;</span><br><span class="line">        Long currentSize = getFileSizeFromRedis(Constants.REDIS_KEY_USER_FILE_TEMP_SIZE + userId + fileId);</span><br><span class="line">        <span class="keyword">return</span> currentSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从缓存中获取文件大小</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getFileSizeFromRedis</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        Object sizeObj = redisUtils.get(key);</span><br><span class="line">        <span class="keyword">if</span> (sizeObj == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sizeObj <span class="keyword">instanceof</span> Integer) &#123;</span><br><span class="line">            <span class="keyword">return</span> ((Integer) sizeObj).longValue();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (sizeObj <span class="keyword">instanceof</span> Long) &#123;</span><br><span class="line">            <span class="keyword">return</span> (Long) sizeObj;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将下载码和文件信息存储到Redis中，设置过期时间为5分钟</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code            文件下载码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> downloadFileDto 文件下载信息对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveDownloadCode</span><span class="params">(String code, DownloadFileDto downloadFileDto)</span> </span>&#123;</span><br><span class="line">        redisUtils.set(Constants.REDIS_KEY_DOWNLOAD + code, downloadFileDto, Constants.REDIS_KEY_EXPIRED_FIVE_MINUTE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从Redis中获取文件信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code 文件下载码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DownloadFileDto <span class="title">getDownloadCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (DownloadFileDto) redisUtils.get(Constants.REDIS_KEY_DOWNLOAD + code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RedisUtils类"><a href="#RedisUtils类" class="headerlink" title="RedisUtils类"></a>RedisUtils类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> Redis工具类，封装了一些常用的Redis操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 10:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(&quot;redisUtils&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtils</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, V&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(RedisUtils.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据键获取Redis中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键，不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Redis中的值，或默认值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="keyword">null</span> ? <span class="keyword">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置键和值到Redis缓存中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键，不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值，不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否设置成功，true表示成功，false表示失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, V value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;设置redisKey:&#123;&#125;,value:&#123;&#125;失败&quot;</span>, key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 设置键和值到Redis缓存中，并指定过期时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键，不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值，不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  过期时间，单位秒</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 是否设置成功，true表示成功，false表示失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, V value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;设置redisKey:&#123;&#125;,value:&#123;&#125;失败&quot;</span>, key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Controller包"><a href="#Controller包" class="headerlink" title="Controller包"></a>Controller包</h2><h3 id="ABaseController类"><a href="#ABaseController类" class="headerlink" title="ABaseController类"></a>ABaseController类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionShareDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.ResponseCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ResponseVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.CopyTools;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 基础控制器类  提供一些公共的方法，供子类继承使用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 21:04</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(ABaseController.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String STATUS_SUCCESS = <span class="string">&quot;success&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keyword">final</span> String STATUS_ERROR = <span class="string">&quot;error&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取成功的响应对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> t 响应数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> &lt;T&gt; <span class="function">ResponseVO <span class="title">getSuccessResponseVO</span><span class="params">(T t)</span> </span>&#123;</span><br><span class="line">        ResponseVO&lt;T&gt; responseVO = <span class="keyword">new</span> ResponseVO&lt;&gt;();</span><br><span class="line">        responseVO.setStatus(STATUS_SUCCESS);</span><br><span class="line">        responseVO.setCode(ResponseCodeEnum.CODE_200.getCode());</span><br><span class="line">        responseVO.setInfo(ResponseCodeEnum.CODE_200.getMsg());</span><br><span class="line">        responseVO.setData(t);</span><br><span class="line">        <span class="keyword">return</span> responseVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转换分页结果对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result 源分页结果对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetClass 目标类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 目标分页结果对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> &lt;S, T&gt; <span class="function">PaginationResultVO&lt;T&gt; <span class="title">convert2PaginationVO</span><span class="params">(PaginationResultVO&lt;S&gt; result, Class&lt;T&gt; targetClass)</span> </span>&#123;</span><br><span class="line">        PaginationResultVO&lt;T&gt; resultVO = <span class="keyword">new</span> PaginationResultVO&lt;&gt;();</span><br><span class="line">        resultVO.setList(CopyTools.copyList(result.getList(), targetClass));</span><br><span class="line">        resultVO.setPageNo(result.getPageNo());</span><br><span class="line">        resultVO.setPageSize(result.getPageSize());</span><br><span class="line">        resultVO.setPageTotal(result.getPageTotal());</span><br><span class="line">        resultVO.setTotalCount(result.getTotalCount());</span><br><span class="line">        <span class="keyword">return</span> resultVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从会话中获取用户信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 会话对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 用户信息对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SessionWebUserDto <span class="title">getUserInfoFromSession</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto sessionWebUserDto = (SessionWebUserDto) session.getAttribute(Constants.SESSION_KEY);</span><br><span class="line">        <span class="keyword">return</span> sessionWebUserDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从会话中获取分享信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 会话对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId 分享ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分享信息对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> SessionShareDto <span class="title">getSessionShareFromSession</span><span class="params">(HttpSession session, String shareId)</span> </span>&#123;</span><br><span class="line">        SessionShareDto sessionShareDto = (SessionShareDto) session.getAttribute(Constants.SESSION_SHARE_KEY + shareId);</span><br><span class="line">        <span class="keyword">return</span> sessionShareDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePath 文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">readFile</span><span class="params">(HttpServletResponse response, String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!StringTools.pathIsOk(filePath)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        OutputStream out = <span class="keyword">null</span>;</span><br><span class="line">        FileInputStream in = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">            <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            in = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">            <span class="keyword">byte</span>[] byteData = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            out = response.getOutputStream();</span><br><span class="line">            <span class="keyword">int</span> len = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span> ((len = in.read(byteData)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                out.write(byteData, <span class="number">0</span>, len);</span><br><span class="line">            &#125;</span><br><span class="line">            out.flush();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;读取文件异常&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (out != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    out.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;IO异常&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (in != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    in.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;IO异常&quot;</span>, e);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AccountController类"><a href="#AccountController类" class="headerlink" title="AccountController类"></a>AccountController类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.GlobalInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.VerifyParam;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.component.RedisComponent;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.config.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.UserSpaceDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.VerifyRegexEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ResponseVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.EmailCodeService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.UserInfoService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.CreateImageCodeTools;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.Operation;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.Parameter;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.HttpStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-25 22:38</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController(&quot;userInfoController&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(AccountController.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTENT_TYPE = <span class="string">&quot;Content-Type&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String CONTENT_TYPE_VALUE = <span class="string">&quot;application/json;charset=UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EmailCodeService emailCodeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoService userInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisComponent redisComponent;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  会话对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type     验证码类型，0表示登录验证码，1表示邮箱验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取验证码&quot;, description = &quot;根据验证码类型生成图片验证码并返回给客户端&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/checkCode&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkCode</span><span class="params">(HttpServletResponse response, HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="meta">@Parameter(name = &quot;type&quot;, description = &quot;验证码类型，0表示登录验证码，1表示邮箱验证码&quot;,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="meta">                                  example = &quot;0&quot;)</span> Integer type)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        CreateImageCodeTools vCode = <span class="keyword">new</span> CreateImageCodeTools(<span class="number">130</span>, <span class="number">38</span>, <span class="number">5</span>, <span class="number">10</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Pragma&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">        response.setDateHeader(<span class="string">&quot;Expires&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        response.setContentType(<span class="string">&quot;image/jpeg&quot;</span>);</span><br><span class="line">        String code = vCode.getCode();</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="keyword">null</span> || type == <span class="number">0</span>) &#123;</span><br><span class="line">            session.setAttribute(Constants.CHECK_CODE_KEY, code);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            session.setAttribute(Constants.CHECK_CODE_KEY_EMAIL, code);</span><br><span class="line">        &#125;</span><br><span class="line">        vCode.write(response.getOutputStream());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送邮箱验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session   会话对象，用于存储图片验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> email     邮箱地址，用于接收验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkCode 图片验证码，用于验证用户身份</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> type      验证码类型，0表示登录验证码，1表示邮箱验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;发送邮箱验证码&quot;, description = &quot;根据邮箱地址和图片验证码发送邮箱验证码&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/sendEmailCode&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">sendEmailCode</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@VerifyParam(required = true, regex = VerifyRegexEnum.EMAIL, max = 150)</span> String email,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@VerifyParam(required = true)</span> String checkCode,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@VerifyParam(required = true)</span> Integer type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!checkCode.equalsIgnoreCase((String) session.getAttribute(Constants.CHECK_CODE_KEY_EMAIL))) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;图片验证码不正确&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            emailCodeService.sendEmailCode(email, type);</span><br><span class="line">            <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            session.removeAttribute(Constants.CHECK_CODE_KEY_EMAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册账号</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session   会话对象，用于存储图片验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> email     邮箱地址，用于注册账号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> nickName  昵称，用于显示用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password  密码，用于登录验证</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkCode 图片验证码，用于验证用户身份</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> emailCode 邮箱验证码，用于验证邮箱地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;注册账号&quot;, description = &quot;根据邮箱地址，昵称，密码，图片验证码和邮箱验证码注册账号&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">register</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true, regex = VerifyRegexEnum.EMAIL, max = 150)</span> String email,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true)</span> String nickName,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true, regex = VerifyRegexEnum.PASSWORD, min = 8, max = 18)</span> String password,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true)</span> String checkCode,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true)</span> String emailCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!checkCode.equalsIgnoreCase((String) session.getAttribute(Constants.CHECK_CODE_KEY))) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;图片验证码不正确&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            userInfoService.register(email, nickName, password, emailCode);</span><br><span class="line">            <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            session.removeAttribute(Constants.CHECK_CODE_KEY_EMAIL);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session   会话对象，用于存储图片验证码和用户信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> email     邮箱地址，用于登录账号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password  密码，用于登录验证</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkCode 图片验证码，用于验证用户身份</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息，以及用户信息数据传输对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;登录&quot;, description = &quot;根据邮箱地址，密码和图片验证码登录账号，并返回用户信息&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">login</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="meta">@VerifyParam(required = true)</span> String email,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="meta">@VerifyParam(required = true)</span> String password,</span></span></span><br><span class="line"><span class="function"><span class="params">                            <span class="meta">@VerifyParam(required = true)</span> String checkCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!checkCode.equalsIgnoreCase((String) session.getAttribute(Constants.CHECK_CODE_KEY))) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;图片验证码不正确&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            SessionWebUserDto sessionWebUserDto = userInfoService.login(email, password);</span><br><span class="line">            session.setAttribute(Constants.SESSION_KEY, sessionWebUserDto);</span><br><span class="line">            <span class="keyword">return</span> getSuccessResponseVO(sessionWebUserDto);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            session.removeAttribute(Constants.CHECK_CODE_KEY);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重置密码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session   会话对象，用于存储图片验证码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> email     邮箱地址，用于重置密码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password  新密码，用于登录验证</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> checkCode 图片验证码，用于验证用户身份</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> emailCode 邮箱验证码，用于验证邮箱</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;重置密码&quot;, description = &quot;根据邮箱地址，新密码，图片验证码和邮箱验证码重置密码&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/resetPwd&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">resetPwd</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true)</span> String email,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true)</span> String password,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true)</span> String checkCode,</span></span></span><br><span class="line"><span class="function"><span class="params">                               <span class="meta">@VerifyParam(required = true)</span> String emailCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!checkCode.equalsIgnoreCase((String) session.getAttribute(Constants.CHECK_CODE_KEY))) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;图片验证码不正确&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            userInfoService.resetPwd(email, password, emailCode);</span><br><span class="line">            <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            session.removeAttribute(Constants.CHECK_CODE_KEY);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户头像</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象，用于返回图片数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId   用户ID，用于查找对应的头像文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取用户头像&quot;, description = &quot;根据用户ID返回用户头像的图片数据&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getAvatar/&#123;userId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAvatar</span><span class="params">(HttpServletResponse response, <span class="meta">@VerifyParam(required = true)</span> <span class="meta">@PathVariable(&quot;userId&quot;)</span> String userId)</span> </span>&#123;</span><br><span class="line">        String avatarFolderName = Constants.FILE_FOLDER_FILE + Constants.FILE_FOLDER_AVATAR_NAME;</span><br><span class="line">        File folder = <span class="keyword">new</span> File(appConfig.getProjectFolder() + avatarFolderName);</span><br><span class="line">        <span class="keyword">if</span> (!folder.exists()) &#123;</span><br><span class="line">            folder.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        String avatarPath = appConfig.getProjectFolder() + avatarFolderName + userId + Constants.AVATAR_SUFFIX;</span><br><span class="line">        File file = <span class="keyword">new</span> File(avatarPath);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">new</span> File(appConfig.getProjectFolder() + avatarFolderName + Constants.AVATAR_DEFAULT).exists()) &#123;</span><br><span class="line">                printNoDefaultImage(response);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            avatarPath = appConfig.getProjectFolder() + avatarFolderName + Constants.AVATAR_DEFAULT;</span><br><span class="line">        &#125;</span><br><span class="line">        response.setContentType(<span class="string">&quot;image/jpg&quot;</span>);</span><br><span class="line">        readFile(response, avatarPath);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">printNoDefaultImage</span><span class="params">(HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">        response.setHeader(CONTENT_TYPE, CONTENT_TYPE_VALUE);</span><br><span class="line">        response.setStatus(HttpStatus.OK.value());</span><br><span class="line">        PrintWriter writer = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            writer = response.getWriter();</span><br><span class="line">            writer.print(<span class="string">&quot;请在头像目录下放置默认头像default_avatar.jpg&quot;</span>);</span><br><span class="line">            writer.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;输出无默认图失败&quot;</span>, e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            writer.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">///**</span></span><br><span class="line">    <span class="comment">// * 获取用户信息</span></span><br><span class="line">    <span class="comment">// *</span></span><br><span class="line">    <span class="comment">// * @param session 会话对象，用于获取用户的登录状态和身份</span></span><br><span class="line">    <span class="comment">// * @return 响应对象，包含响应码和响应消息，以及用户信息的数据传输对象</span></span><br><span class="line">    <span class="comment">// */</span></span><br><span class="line">    <span class="comment">//@Operation(summary = &quot;获取用户信息&quot;, description = &quot;根据会话对象，返回用户的基本信息和角色信息&quot;)</span></span><br><span class="line">    <span class="comment">//@GetMapping(&quot;/getUserInfo&quot;)</span></span><br><span class="line">    <span class="comment">//@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="comment">//public ResponseVO getUserInfo(HttpSession session) &#123;</span></span><br><span class="line">    <span class="comment">//    SessionWebUserDto sessionWebUserDto = getUserInfoFromSession(session);</span></span><br><span class="line">    <span class="comment">//    return getSuccessResponseVO(sessionWebUserDto);</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户空间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 会话对象，用于获取用户的登录状态和身份</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息，以及用户空间的数据传输对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取用户空间&quot;, description = &quot;根据会话对象，返回用户的空间使用情况，包括总空间和已用空间&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/getUseSpace&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">getUseSpace</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto sessionWebUserDto = getUserInfoFromSession(session);</span><br><span class="line">        UserSpaceDto spaceDto = redisComponent.getUserSpaceUse(sessionWebUserDto.getUserId());</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(spaceDto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 退出登录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 会话对象，用于清除用户的登录状态和身份</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息，不包含任何数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取用户空间&quot;, description = &quot;“根据会话对象，清除用户的登录状态和身份，并返回成功的响应&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/logout&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">logout</span><span class="params">(HttpSession session)</span> </span>&#123;</span><br><span class="line">        session.invalidate();</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新用户头像</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 会话对象，用于获取用户的登录状态和身份</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> avatar  头像文件，用于上传和更新用户的头像</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息，不包含任何数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;更新用户头像&quot;, description = &quot;根据会话对象和头像文件，上传和更新用户的头像，并清除用户的QQ头像&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/updateUserAvatar&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">updateUserAvatar</span><span class="params">(HttpSession session, MultipartFile avatar)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        String baseFolder = appConfig.getProjectFolder() + Constants.FILE_FOLDER_FILE;</span><br><span class="line">        File targetFileFolder = <span class="keyword">new</span> File(baseFolder + Constants.FILE_FOLDER_AVATAR_NAME);</span><br><span class="line">        <span class="keyword">if</span> (!targetFileFolder.exists()) &#123;</span><br><span class="line">            targetFileFolder.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        String targetFilePath = Paths.get(targetFileFolder.getPath(), webUserDto.getUserId()</span><br><span class="line">                + Constants.AVATAR_SUFFIX).toString();</span><br><span class="line">        File targetFile = <span class="keyword">new</span> File(targetFilePath);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            avatar.transferTo(targetFile);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;上传头像失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        UserInfo userInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">        userInfo.setQqAvatar(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        userInfoService.updateUserInfoByUserId(userInfo, webUserDto.getUserId());</span><br><span class="line">        webUserDto.setAvatar(<span class="keyword">null</span>);</span><br><span class="line">        session.setAttribute(Constants.SESSION_KEY, webUserDto);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新用户密码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  会话对象，用于获取用户的登录状态和身份</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> password 新密码，用于登录验证，必须符合密码的正则表达式，长度在8到18之间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息，不包含任何数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;更新用户密码&quot;, description = &quot;根据会话对象和新密码，更新用户的密码&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/updatePassword&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">updatePassword</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="meta">@VerifyParam(required = true, regex = VerifyRegexEnum.PASSWORD, min = 8, max = 18)</span> String password)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//TODO 后面需要校验初始密码</span></span><br><span class="line">        SessionWebUserDto sessionWebUserDto = getUserInfoFromSession(session);</span><br><span class="line">        UserInfo userInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">        userInfo.setPassword(StringTools.encodeByMD5(password));</span><br><span class="line">        userInfoService.updateUserInfoByUserId(userInfo, sessionWebUserDto.getUserId());</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq登录接口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session     会话对象，用于存储回调地址和状态码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> callbackUrl 登录成功后的回调地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息，以及qq授权的url</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;qqlogin&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;qq登录接口&quot;, description = &quot;根据会话对象和回调地址，生成qq授权的url，并返回给前端&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">qqLogin</span><span class="params">(HttpSession session, String callbackUrl)</span> <span class="keyword">throws</span> UnsupportedEncodingException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成一个随机的状态码</span></span><br><span class="line">        String state = StringTools.getRandomString(Constants.LENGTH_30);</span><br><span class="line">        <span class="comment">//如果回调地址不为空，将其存储到会话对象中，以便跳转</span></span><br><span class="line">        <span class="keyword">if</span> (!StringTools.isEmpty(callbackUrl)) &#123;</span><br><span class="line">            session.setAttribute(state, callbackUrl);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//拼接qq授权的url，包含应用id，回调地址和状态码</span></span><br><span class="line">        String url = String.format(appConfig.getQqUrlAuthorization(), appConfig.getQqAppId(),</span><br><span class="line">                URLEncoder.encode(appConfig.getQqUrlRedirect(), <span class="string">&quot;utf-8&quot;</span>), state);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(url);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前端回调接口</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 会话对象，用于存储用户信息和回调地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code    qq官方回调的code</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> state   获取登录信息后端传入的状态码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含响应码和响应消息，以及回调地址和用户信息的数据传输对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;qqlogin/callback&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;前端回调接口&quot;, description = &quot;根据会话对象，授权码和状态码，获取用户信息并存储到会话对象中，并返回给前端&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkLogin = false, checkParams = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">qqLoginCallback</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      <span class="meta">@VerifyParam(required = true)</span> String code,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      <span class="meta">@VerifyParam(required = true)</span> String state)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据授权码，调用用户服务层的qq登录方法，获取用户信息的数据传输对象</span></span><br><span class="line">        SessionWebUserDto sessionWebUserDto = userInfoService.qqLogin(code);</span><br><span class="line">        <span class="comment">//将用户信息存储到会话对象中</span></span><br><span class="line">        session.setAttribute(Constants.SESSION_KEY, sessionWebUserDto);</span><br><span class="line">        <span class="comment">//创建一个结果集，用于存储回调地址和用户信息</span></span><br><span class="line">        Map&lt;String, Object&gt; result = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        result.put(<span class="string">&quot;callbackUrl&quot;</span>, session.getAttribute(state));</span><br><span class="line">        result.put(<span class="string">&quot;userInfo&quot;</span>, sessionWebUserDto);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AdminController类"><a href="#AdminController类" class="headerlink" title="AdminController类"></a>AdminController类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.GlobalInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.VerifyParam;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.component.RedisComponent;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SysSettingsDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.UserInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ResponseVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.UserInfoVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileInfoService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.UserInfoService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.Operation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 管理员</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-01 23:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController(&quot;adminController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/admin&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdminController</span> <span class="keyword">extends</span> <span class="title">CommonFileController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoService fileInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisComponent redisComponent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoService userInfoService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取系统设置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含系统设置对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取系统设置&quot;, description = &quot;从Redis缓存中获取系统设置对象，包含一些系统相关的设置信息，例如注册邮件标题、内容等&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/getSysSettings&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">getSysSettings</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(redisComponent.getSysSettingsDto());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存系统设置</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registerEmailTitle   注册邮件标题</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> registerEmailContent 注册邮件内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userInitUseSpace     用户初始可用空间，单位为MB</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，不包含数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;保存系统设置&quot;, description = &quot;根据注册邮件标题、内容和用户初始可用空间，创建一个系统设置对象并保存到Redis缓存中&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/saveSysSettings&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">saveSysSettings</span><span class="params">(<span class="meta">@VerifyParam(required = true)</span> String registerEmailTitle,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      <span class="meta">@VerifyParam(required = true)</span> String registerEmailContent,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      <span class="meta">@VerifyParam(required = true)</span> Integer userInitUseSpace)</span> </span>&#123;</span><br><span class="line">        SysSettingsDto sysSettingsDto = <span class="keyword">new</span> SysSettingsDto();</span><br><span class="line">        sysSettingsDto.setRegisterEmailTitle(registerEmailTitle);</span><br><span class="line">        sysSettingsDto.setRegisterEmailContent(registerEmailContent);</span><br><span class="line">        sysSettingsDto.setUserInitUseSpace(userInitUseSpace);</span><br><span class="line">        redisComponent.saveSysSettings(sysSettingsDto);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userInfoQuery</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取用户列表&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/loadUserList&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">loadUserList</span><span class="params">(UserInfoQuery userInfoQuery)</span> </span>&#123;</span><br><span class="line">        userInfoQuery.setOrderBy(<span class="string">&quot;join_time desc&quot;</span>);</span><br><span class="line">        PaginationResultVO resultVO = userInfoService.findListByPage(userInfoQuery);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(convert2PaginationVO(resultVO, UserInfoVO.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户状态</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status 用户状态，0为禁用，1为启用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，不包含数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;修改用户状态&quot;, description = &quot;根据用户ID和用户状态，修改用户信息表中的对应字段，如果禁用用户，则删除该用户的所有文件&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/updateUserStatus&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">updateUserStatus</span><span class="params">(<span class="meta">@VerifyParam(required = true)</span> String userId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="meta">@VerifyParam(required = true)</span> Integer status)</span> </span>&#123;</span><br><span class="line">        userInfoService.updateUserStatus(userId, status);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户空间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId      用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> changeSpace 改变的空间，单位为MB</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，不包含数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;修改用户空间&quot;, description = &quot;根据用户ID和改变的空间，修改用户信息表中的存储总空间字段，并重置Redis缓存中的用户已用空间&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/updateUserSpace&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">updateUserSpace</span><span class="params">(<span class="meta">@VerifyParam(required = true)</span> String userId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      <span class="meta">@VerifyParam(required = true)</span> Integer changeSpace)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        userInfoService.changeUserSpace(userId, changeSpace);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有用户的所有文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取所有用户的所有文件&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/loadFileList&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">loadFileList</span><span class="params">(FileInfoQuery query)</span> </span>&#123;</span><br><span class="line">        query.setOrderBy(<span class="string">&quot;last_update_time desc&quot;</span>);</span><br><span class="line">        query.setQueryNickName(<span class="keyword">true</span>);</span><br><span class="line">        PaginationResultVO resultVO = fileInfoService.findListByPage(query);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(resultVO);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前目录信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path 路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取当前目录信息&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkLogin = false, checkAdmin = true, checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/getFolderInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">getFolderInfo</span><span class="params">(<span class="meta">@VerifyParam(required = true)</span> String path)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getFolderInfo(path, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视频预览</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象，用于输出视频内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId   用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件ID，不能为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;视频预览&quot;, description = &quot;分片获取视频ts，用于视频播放预览&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/ts/getVideoInfo/&#123;userId&#125;/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getVideoInfo</span><span class="params">(HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="meta">@PathVariable(&quot;userId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String userId,</span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.getFile(response, fileId, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象，用于输出文件内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId   用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件ID，不能为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取文件信息&quot;, description = &quot;读取文件内容，用于预览展示&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getFile/&#123;userId&#125;/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFile</span><span class="params">(HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="meta">@PathVariable(&quot;userId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String userId,</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">super</span>.getFile(response, fileId, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建下载链接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId 文件id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;创建下载链接&quot;, description = &quot;根据文件id生成一个随机的下载码，并存储到Redis中，返回下载码给前端&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/createDownloadUrl/&#123;userId&#125;/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">createDownloadUrl</span><span class="params">(<span class="meta">@PathVariable(&quot;userId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String userId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.createDownloadUrl(fileId, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 管理端下载文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  HttpServletRequest对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response HttpServletResponse对象，用于设置响应类型和头部信息，以及写入响应流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code     下载码，用于从Redis中获取文件信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;管理端下载文件&quot;, description = &quot;根据下载码从Redis中获取文件信息，读取文件并写入响应流中，实现文件的下载&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download/&#123;code&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@PathVariable(&quot;code&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String code)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.download(request, response, code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 管理端删除用户文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIdAndUserIds 文件id_用户id多个以逗号隔开</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;管理端删除用户文件&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkAdmin = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/delFile&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">delFile</span><span class="params">(<span class="meta">@VerifyParam(required = true)</span> String fileIdAndUserIds)</span> </span>&#123;</span><br><span class="line">        String[] fileIdAndUserIdArray = fileIdAndUserIds.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String fileIdAndUserId : fileIdAndUserIdArray) &#123;</span><br><span class="line">            String[] itemArray = fileIdAndUserId.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            fileInfoService.batchDelFile(itemArray[<span class="number">0</span>], itemArray[<span class="number">1</span>], <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="CommonFileController类"><a href="#CommonFileController类" class="headerlink" title="CommonFileController类"></a>CommonFileController类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.component.RedisComponent;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.config.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.DownloadFileDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileCategoryEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileFolderTypeEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.ResponseCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.FileInfoVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ResponseVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileInfoService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.CopyTools;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 公共文件控制器类，用于处理公共文件的请求，如获取图片，获取视频等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 16:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonFileController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">protected</span> AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoService fileInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisComponent redisComponent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">getImage</span><span class="params">(HttpServletResponse response, String imageFolder, String imageName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringTools.isEmpty(imageFolder) || StringUtils.isBlank(imageName)</span><br><span class="line">                || !StringTools.pathIsOk(imageFolder) || !StringTools.pathIsOk(imageName)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String imageSuffix = StringTools.getFileSuffix(imageName);</span><br><span class="line">        String filePath = appConfig.getProjectFolder() + Constants.FILE_FOLDER_FILE + imageFolder + <span class="string">&quot;/&quot;</span> + imageName;</span><br><span class="line">        imageSuffix = imageSuffix.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        String contentType = <span class="string">&quot;image/&quot;</span> + imageSuffix;</span><br><span class="line">        response.setContentType(contentType);</span><br><span class="line">        response.setHeader(<span class="string">&quot;Cache-Control&quot;</span>, <span class="string">&quot;max-age=2592000&quot;</span>);</span><br><span class="line">        readFile(response, filePath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取文件，并返回给响应对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象，用于输出文件内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件ID，不能为空，可以是视频文件或视频片段文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId   用户ID，不能为空，用于查询文件信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">getFile</span><span class="params">(HttpServletResponse response, String fileId, String userId)</span> </span>&#123;</span><br><span class="line">        String filePath = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//判断是否是视频片段文件</span></span><br><span class="line">        <span class="keyword">if</span> (fileId.endsWith(<span class="string">&quot;.ts&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//判断是否是视频片段文件</span></span><br><span class="line">            String[] tsArray = fileId.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">            <span class="comment">//获取真实的文件ID</span></span><br><span class="line">            String realFileId = tsArray[<span class="number">0</span>];</span><br><span class="line">            <span class="comment">//查询文件信息对象</span></span><br><span class="line">            FileInfo fileInfo = fileInfoService.getFileInfoByFileIdAndUserId(realFileId, userId);</span><br><span class="line">            <span class="keyword">if</span> (fileInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取原始的视频文件路径</span></span><br><span class="line">            String fileName = fileInfo.getFilePath();</span><br><span class="line"></span><br><span class="line">            fileName = Paths.get(StringTools.getFileNameNoSuffix(fileName), fileId).toString();</span><br><span class="line">            <span class="comment">//拼接出完整的视频片段文件路径</span></span><br><span class="line">            filePath = appConfig.getProjectFolder() + Constants.FILE_FOLDER_FILE + fileName;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            FileInfo fileInfo = fileInfoService.getFileInfoByFileIdAndUserId(fileId, userId);</span><br><span class="line">            <span class="keyword">if</span> (fileInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 视频文件读取.m3u8文件</span></span><br><span class="line">            <span class="keyword">if</span> (FileCategoryEnums.VIDEO.getCategory().equals(fileInfo.getFileCategory())) &#123;</span><br><span class="line">                String fileNameNoSuffix = StringTools.getFileNameNoSuffix(fileInfo.getFilePath());</span><br><span class="line">                filePath = Paths.get(appConfig.getProjectFolder() + Constants.FILE_FOLDER_FILE +</span><br><span class="line">                        fileNameNoSuffix, Constants.M3U8_NAME).toString();</span><br><span class="line"></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//如果不是视频片段文件也不是视频文件</span></span><br><span class="line">                filePath = appConfig.getProjectFolder() + Constants.FILE_FOLDER_FILE + fileInfo.getFilePath();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        File file = <span class="keyword">new</span> File(filePath);</span><br><span class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 调用readFile方法读取并输出内容</span></span><br><span class="line">        readFile(response, filePath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前目录信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path   完整路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> ResponseVO <span class="title">getFolderInfo</span><span class="params">(String path, String userId)</span> </span>&#123;</span><br><span class="line">        String[] pathArray = path.split(<span class="string">&quot;/&quot;</span>);</span><br><span class="line">        FileInfoQuery infoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        infoQuery.setUserId(userId);</span><br><span class="line">        infoQuery.setFolderType(FileFolderTypeEnums.FOLDER.getType());</span><br><span class="line">        infoQuery.setFileIdArray(pathArray);</span><br><span class="line">        <span class="comment">//根据传入的文件id顺序排序</span></span><br><span class="line">        String orderBy = <span class="string">&quot;field(file_id,\&quot;&quot;</span> + StringUtils.join(pathArray, <span class="string">&quot;\&quot;,\&quot;&quot;</span>) + <span class="string">&quot;\&quot;)&quot;</span>;</span><br><span class="line">        infoQuery.setOrderBy(orderBy);</span><br><span class="line">        List&lt;FileInfo&gt; fileInfoList = fileInfoService.findListByParam(infoQuery);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(CopyTools.copyList(fileInfoList, FileInfoVO.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建下载链接（目前只支持文件）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId 文件id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> ResponseVO <span class="title">createDownloadUrl</span><span class="params">(String fileId, String userId)</span> </span>&#123;</span><br><span class="line">        FileInfo fileInfo = fileInfoService.getFileInfoByFileIdAndUserId(fileId, userId);</span><br><span class="line">        <span class="keyword">if</span> (fileInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (FileFolderTypeEnums.FOLDER.getType().equals(fileInfo.getFolderType())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String code = StringTools.getRandomString(Constants.LENGTH_50);</span><br><span class="line">        DownloadFileDto downloadFileDto = <span class="keyword">new</span> DownloadFileDto();</span><br><span class="line">        downloadFileDto.setDownloadCode(code);</span><br><span class="line">        downloadFileDto.setFilePath(fileInfo.getFilePath());</span><br><span class="line">        downloadFileDto.setFileName(fileInfo.getFileName());</span><br><span class="line"></span><br><span class="line">        redisComponent.saveDownloadCode(code, downloadFileDto);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  HttpServletRequest对象，用于获取请求头中的User-Agent信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response HttpServletResponse对象，用于设置响应类型和头部信息，以及写入响应流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code     下载码，用于从Redis中获取文件信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception 如果读取文件或写入响应流出现异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(HttpServletRequest request, HttpServletResponse response, String code)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//从Redis中获取文件信息，如果为空则返回</span></span><br><span class="line">        DownloadFileDto downloadFileDto = redisComponent.getDownloadCode(code);</span><br><span class="line">        <span class="keyword">if</span> (downloadFileDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 拼接文件路径</span></span><br><span class="line">        String filePath = appConfig.getProjectFolder() + Constants.FILE_FOLDER_FILE + downloadFileDto.getFilePath();</span><br><span class="line">        String fileName = downloadFileDto.getFileName();</span><br><span class="line">        <span class="comment">//设置响应类型和头部信息，根据不同的浏览器进行编码处理</span></span><br><span class="line">        response.setContentType(<span class="string">&quot;application/x-msdownload; charset=UTF-8&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (request.getHeader(<span class="string">&quot;User-Agent&quot;</span>).toLowerCase().indexOf(<span class="string">&quot;msie&quot;</span>) &gt; <span class="number">0</span>) &#123;<span class="comment">//IE浏览器</span></span><br><span class="line">            fileName = URLEncoder.encode(fileName, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            fileName = <span class="keyword">new</span> String(fileName.getBytes(<span class="string">&quot;UTF-8&quot;</span>), <span class="string">&quot;ISO8859-1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//设置响应头部信息，指示内容是作为附件下载，而不是直接显示在浏览器中</span></span><br><span class="line">        response.setHeader(<span class="string">&quot;Content-Disposition&quot;</span>, <span class="string">&quot;attachment;filename=\&quot;&quot;</span> + fileName + <span class="string">&quot;\&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">//读取文件并写入响应流中</span></span><br><span class="line">        readFile(response, filePath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="FileInfoController类"><a href="#FileInfoController类" class="headerlink" title="FileInfoController类"></a>FileInfoController类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.GlobalInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.VerifyParam;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.UploadResultDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileCategoryEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileDelFlagEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileFolderTypeEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.FileInfoVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ResponseVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileInfoService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.CopyTools;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.Operation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 22:37</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController(&quot;fileInfoController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/file&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileInfoController</span> <span class="keyword">extends</span> <span class="title">CommonFileController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoService fileInfoService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加载文件列表数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> query    文件查询条件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> category 文件分类代码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含文件列表数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;加载文件列表数据&quot;, description = &quot;根据用户会话，文件查询条件和文件分类代码，返回符合条件的文件列表数据，按照最后更新时间降序排列&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/loadDataList&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">loadDataList</span><span class="params">(HttpSession session, FileInfoQuery query, String category)</span> </span>&#123;</span><br><span class="line">        FileCategoryEnums categoryEnum = FileCategoryEnums.getByCode(category);</span><br><span class="line">        <span class="keyword">if</span> (categoryEnum != <span class="keyword">null</span>) &#123;</span><br><span class="line">            query.setFileCategory(categoryEnum.getCategory());</span><br><span class="line">        &#125;</span><br><span class="line">        query.setUserId(getUserInfoFromSession(session).getUserId());</span><br><span class="line">        query.setOrderBy(<span class="string">&quot;last_update_time desc&quot;</span>);</span><br><span class="line">        query.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        PaginationResultVO result = fileInfoService.findListByPage(query);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(convert2PaginationVO(result, FileInfoVO.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件分片上传</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session    用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId     文件ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file       文件流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName   文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid    文件父id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileMd5    文件MD5值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chunkIndex 当前分片索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chunks     总分片数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含上传结果数据传输对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;文件分片上传&quot;, description = &quot;根据用户会话，文件ID，文件流，文件名，文件父id，文件MD5值，当前分片索引和总分片数，实现文件的分片上传功能，支持秒传和断点续传&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/uploadFile&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">uploadFile</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 String fileId, MultipartFile file,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="meta">@VerifyParam(required = true)</span> String fileName,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="meta">@VerifyParam(required = true)</span> String filePid,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="meta">@VerifyParam(required = true)</span> String fileMd5,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="meta">@VerifyParam(required = true)</span> Integer chunkIndex,</span></span></span><br><span class="line"><span class="function"><span class="params">                                 <span class="meta">@VerifyParam(required = true)</span> Integer chunks)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        UploadResultDto resultDto = fileInfoService.uploadFile(webUserDto, fileId, file,</span><br><span class="line">                fileName, filePid, fileMd5, chunkIndex, chunks);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(resultDto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 显示封面</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response    响应对象，用于输出图片内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageFolder 图片的文件夹名称</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> imageName   图片的文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;显示封面&quot;, description = &quot;根据图片的文件夹和文件名，读取图片，并返回给响应对象&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true,checkLogin = false)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getImage/&#123;imageFolder&#125;/&#123;imageName&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getImage</span><span class="params">(HttpServletResponse response, <span class="meta">@PathVariable(&quot;imageFolder&quot;)</span> String imageFolder,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@PathVariable(&quot;imageName&quot;)</span> String imageName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.getImage(response, imageFolder, imageName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视频预览</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象，用于输出视频内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件ID，不能为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;视频预览&quot;, description = &quot;分片获取视频ts，用于视频播放预览&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/ts/getVideoInfo/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getVideoInfo</span><span class="params">(HttpServletResponse response, HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        <span class="keyword">super</span>.getFile(response, fileId, webUserDto.getUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象，用于输出文件内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件ID，不能为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取文件信息&quot;, description = &quot;读取文件内容，用于预览展示&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getFile/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFile</span><span class="params">(HttpServletResponse response, HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        <span class="keyword">super</span>.getFile(response, fileId, webUserDto.getUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新建目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid  父目录id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 目录名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;新建目录&quot;, description = &quot;新建一个目录，并返回新建的目录信息&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/newFolder&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">newFolder</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="meta">@VerifyParam(required = true)</span> String filePid,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="meta">@VerifyParam(required = true)</span> String fileName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        FileInfo fileInfo = fileInfoService.newFolder(filePid, webUserDto.getUserId(), fileName);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(CopyTools.copy(fileInfo, FileInfoVO.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path    完整路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取当前目录&quot;, description = &quot;根据用户id和完整路径，获取当前目录的相关信息，并返回给响应对象&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/getFolderInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">getFolderInfo</span><span class="params">(HttpSession session, <span class="meta">@VerifyParam(required = true)</span> String path)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getFolderInfo(path, webUserDto.getUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件重命名</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;文件重命名&quot;, description = &quot;重命名文件或目录，并返回重命名后的文件信息给响应对象&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/rename&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">rename</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="meta">@VerifyParam(required = true)</span> String fileId,</span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="meta">@VerifyParam(required = true)</span> String fileName)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        FileInfo fileInfo = fileInfoService.rename(fileId, webUserDto.getUserId(), fileName);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(CopyTools.copy(fileInfo, FileInfoVO.class));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取所有目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session        用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid        目录id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> currentFileIds 需要排除返回的目录id信息，多个以逗号隔开</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取所有目录&quot;, description = &quot;移动文件时，需要获取指定位置的所有目录&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/loadAllFolder&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">loadAllFolder</span><span class="params">(HttpSession session, <span class="meta">@VerifyParam(required = true)</span> String filePid,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    String currentFileIds)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        FileInfoQuery infoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        infoQuery.setUserId(webUserDto.getUserId());</span><br><span class="line">        infoQuery.setFilePid(filePid);</span><br><span class="line">        infoQuery.setFolderType(FileFolderTypeEnums.FOLDER.getType());</span><br><span class="line">        <span class="keyword">if</span> (!StringTools.isEmpty(currentFileIds)) &#123;</span><br><span class="line"></span><br><span class="line">            infoQuery.setExcludeFileIdArray(currentFileIds.split(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        infoQuery.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        infoQuery.setOrderBy(<span class="string">&quot;create_time desc&quot;</span>);</span><br><span class="line">        List&lt;FileInfo&gt; fileInfoList = fileInfoService.findListByParam(infoQuery);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(CopyTools.copyList(fileInfoList, FileInfoVO.class));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改文件目录、移动文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIds 需要移动的文件id，多个以逗号隔开</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid 需要移动到的指定位置目录id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;移动文件&quot;, description = &quot;将需要移动的文件，移动到指定目录下&quot;)</span></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/changeFileFolder&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">changeFileFolder</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="meta">@VerifyParam(required = true)</span> String fileIds,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="meta">@VerifyParam(required = true)</span> String filePid)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        fileInfoService.changeFileFolder(fileIds, filePid, webUserDto.getUserId());</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建下载链接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId  文件id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;创建下载链接&quot;, description = &quot;根据文件id生成一个随机的下载码，并存储到Redis中，返回下载码给前端&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/createDownloadUrl/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">createDownloadUrl</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.createDownloadUrl(fileId, webUserDto.getUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  HttpServletRequest对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response HttpServletResponse对象，用于设置响应类型和头部信息，以及写入响应流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code     下载码，用于从Redis中获取文件信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;下载文件&quot;, description = &quot;根据下载码从Redis中获取文件信息，读取文件并写入响应流中，实现文件的下载&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download/&#123;code&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@PathVariable(&quot;code&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String code)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.download(request, response, code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIds 文件id列表，用逗号分隔</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;删除文件&quot;, description = &quot;将用户选择的文件或目录移动到回收站中，可以在10天内恢复&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/delFile&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">delFile</span><span class="params">(HttpSession session, <span class="meta">@VerifyParam(required = true)</span> String fileIds)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        fileInfoService.removeFile2RecycleBatch(webUserDto.getUserId(), fileIds);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="RecycleController类"><a href="#RecycleController类" class="headerlink" title="RecycleController类"></a>RecycleController类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.GlobalInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.VerifyParam;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileDelFlagEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ResponseVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileInfoService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.Operation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 回收站</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-30 22:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController(&quot;recycleController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/recycle&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RecycleController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoService fileInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取回收站文件列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageNo   页码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pageSize 分页大小</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取回收站文件列表&quot;, description = &quot;根据用户id和分页参数查询回收站中的文件或目录，按照删除时间降序排序&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/loadRecycleList&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">loadRecycleList</span><span class="params">(HttpSession session, <span class="meta">@RequestParam(defaultValue = &quot;1&quot;)</span> Integer pageNo,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      <span class="meta">@RequestParam(defaultValue = &quot;15&quot;)</span> Integer pageSize)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        FileInfoQuery query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        query.setPageSize(pageSize);</span><br><span class="line">        query.setPageNo(pageNo);</span><br><span class="line">        query.setUserId(webUserDto.getUserId());</span><br><span class="line">        query.setOrderBy(<span class="string">&quot;recovery_time desc&quot;</span>);</span><br><span class="line">        query.setDelFlag(FileDelFlagEnums.RECYCLE.getFlag());</span><br><span class="line">        PaginationResultVO resultVO = fileInfoService.findListByPage(query);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(resultVO);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 恢复文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIds 需要恢复的文件id，多个以逗号隔开</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;恢复文件&quot;, description = &quot;将用户选择的文件或目录从回收站中恢复&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/recoverFile&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">recoverFile</span><span class="params">(HttpSession session, <span class="meta">@VerifyParam(required = true)</span> String fileIds)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        fileInfoService.recoverFileBatch(webUserDto.getUserId(), fileIds);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;删除回收站文件&quot;, description = &quot;彻底删除文件，包括数据库和本地文件&quot;)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/deleteRecoveryFile&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">deleteRecoveryFile</span><span class="params">(HttpSession session, <span class="meta">@VerifyParam(required = true)</span> String fileIds)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        fileInfoService.batchDelFile(webUserDto.getUserId(), fileIds, <span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ShareController类"><a href="#ShareController类" class="headerlink" title="ShareController类"></a>ShareController类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.GlobalInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.VerifyParam;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileShare;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileShareQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ResponseVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileShareService;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.Operation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分享文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-01 20:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController(&quot;shareController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/share&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShareController</span> <span class="keyword">extends</span> <span class="title">ABaseController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileShareService fileShareService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取分享文件列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> query   分享文件查询条件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含分享文件列表数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取分享文件列表&quot;, description = &quot;根据用户会话和分享文件查询条件，返回符合条件的分享文件列表数据，按照分享时间降序排列&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/loadShareList&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">loadShareList</span><span class="params">(HttpSession session, FileShareQuery query)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        query.setOrderBy(<span class="string">&quot;share_time desc&quot;</span>);</span><br><span class="line">        query.setUserId(webUserDto.getUserId());</span><br><span class="line">        query.setQueryFileName(<span class="keyword">true</span>);</span><br><span class="line">        PaginationResultVO resultVO = fileShareService.findListByPage(query);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(resultVO);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session   用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId    文件ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> validType 分享有效期类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code      分享密码（可选）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含分享信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;分享文件&quot;, description = &quot;根据用户会话，文件ID，分享有效期类型和分享码（可选），创建一个分享信息并返回&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/shareFile&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">shareFile</span><span class="params">(HttpSession session, <span class="meta">@VerifyParam(required = true)</span> String fileId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="meta">@VerifyParam(required = true)</span> Integer validType, String code)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        FileShare fileShare = <span class="keyword">new</span> FileShare();</span><br><span class="line">        fileShare.setValidType(validType);</span><br><span class="line">        fileShare.setFileId(fileId);</span><br><span class="line">        fileShare.setCode(code);</span><br><span class="line">        fileShare.setUserId(webUserDto.getUserId());</span><br><span class="line"></span><br><span class="line">        fileShareService.saveShare(fileShare);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(fileShare);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 取消分享</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareIds 分享ID列表，用逗号分隔</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，不包含数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;取消分享&quot;, description = &quot;根据用户会话和分享ID列表，批量删除对应的分享信息&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/cancelShare&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">cancelShare</span><span class="params">(HttpSession session, <span class="meta">@VerifyParam(required = true)</span> String shareIds)</span> </span>&#123;</span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        fileShareService.batchDeleteFileShare(shareIds, webUserDto.getUserId());</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="WebShareController类"><a href="#WebShareController类" class="headerlink" title="WebShareController类"></a>WebShareController类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.GlobalInterceptor;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.annotation.VerifyParam;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionShareDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileDelFlagEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.ResponseCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileShare;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.FileInfoVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ResponseVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.ShareInfoVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileInfoService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileShareService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.UserInfoService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.CopyTools;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.Operation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 外部文件分享</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-03 10:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController(&quot;/WebShareController&quot;)</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/showShare&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebShareController</span> <span class="keyword">extends</span> <span class="title">CommonFileController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileShareService fileShareService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoService fileInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoService userInfoService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户登录信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId 分享id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含用户登录信息和分享文件信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取用户登录信息&quot;, description = &quot;根据用户会话和分享id，返回用户的昵称、头像、&quot; +</span></span><br><span class="line"><span class="meta">            &quot;是否是当前用户以及分享文件的名称、分享时间、过期时间等信息&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/getShareLoginInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">getShareLoginInfo</span><span class="params">(HttpSession session, <span class="meta">@VerifyParam(required = true)</span> String shareId)</span> </span>&#123;</span><br><span class="line">        SessionShareDto sessionShareDto = getSessionShareFromSession(session, shareId);</span><br><span class="line">        <span class="keyword">if</span> (sessionShareDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        ShareInfoVO shareInfoVO = getShareInfoCommon(shareId);</span><br><span class="line">        <span class="comment">//判断是否是当前用户分享的文件</span></span><br><span class="line">        SessionWebUserDto webUserDto = getUserInfoFromSession(session);</span><br><span class="line">        <span class="keyword">if</span> (webUserDto != <span class="keyword">null</span>) &#123;</span><br><span class="line">            shareInfoVO.setCurrentUser(<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            shareInfoVO.setCurrentUser(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(shareInfoVO);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取分享信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId 分享id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含分享文件信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取分享信息&quot;, description = &quot;根据分享id，返回分享文件的名称、分享时间、过期时间等信息&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/getShareInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">getShareInfo</span><span class="params">(<span class="meta">@VerifyParam(required = true)</span> String shareId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(getShareInfoCommon(shareId));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取分享文件的基本信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId 分享id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分享文件信息对象，包含分享者昵称、头像、ID，分享文件名称、ID，分享时间、过期时间等信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果分享文件不存在或者已过期，抛出业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ShareInfoVO <span class="title">getShareInfoCommon</span><span class="params">(String shareId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据分享id，查询分享记录</span></span><br><span class="line">        FileShare share = fileShareService.getFileShareByShareId(shareId);</span><br><span class="line">        <span class="keyword">if</span> (share == <span class="keyword">null</span> || (share.getExpireTime() != <span class="keyword">null</span> &amp;&amp; <span class="keyword">new</span> Date().after(share.getExpireTime()))) &#123;</span><br><span class="line">            <span class="comment">//如果分享记录为空或者已过期，抛出分享失效异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_902);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将分享记录转换为分享文件信息对象</span></span><br><span class="line">        ShareInfoVO shareInfoVO = CopyTools.copy(share, ShareInfoVO.class);</span><br><span class="line">        <span class="comment">//根据分享id和分享者ID，查询文件信息</span></span><br><span class="line">        FileInfo fileInfo = fileInfoService.getFileInfoByFileIdAndUserId(share.getFileId(), share.getUserId());</span><br><span class="line">        <span class="keyword">if</span> (fileInfo == <span class="keyword">null</span> || FileDelFlagEnums.USING.equals(fileInfo.getDelFlag())) &#123;</span><br><span class="line">            <span class="comment">//如果文件信息为空或者已删除，抛出分享失效异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_902);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//设置分享文件信息对象的文件名称</span></span><br><span class="line">        shareInfoVO.setFileName(fileInfo.getFileName());</span><br><span class="line">        <span class="comment">//根据分享者ID，查询用户信息</span></span><br><span class="line">        UserInfo userInfo = userInfoService.getUserInfoByUserId(share.getUserId());</span><br><span class="line">        <span class="comment">//设置分享文件信息对象的分享者昵称、头像、ID</span></span><br><span class="line">        shareInfoVO.setNickName(userInfo.getNickName());</span><br><span class="line">        shareInfoVO.setAvatar(userInfo.getQqAvatar());</span><br><span class="line">        shareInfoVO.setUserId(userInfo.getUserId());</span><br><span class="line">        <span class="comment">//返回分享文件信息对象</span></span><br><span class="line">        <span class="keyword">return</span> shareInfoVO;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验分享码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId 分享id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code    分享码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，表示校验结果</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;校验分享码&quot;, description = &quot;根据用户会话、分享id和分享码，验证分享码是否正确，如果正确则将分享信息保存到会话中&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/checkShareCode&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">checkShareCode</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="meta">@VerifyParam(required = true)</span> String shareId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                     <span class="meta">@VerifyParam(required = true)</span> String code)</span> </span>&#123;</span><br><span class="line">        SessionShareDto sessionShareDto = fileShareService.checkShareCode(shareId, code);</span><br><span class="line">        session.setAttribute(Constants.SESSION_SHARE_KEY + shareId, sessionShareDto);</span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId 分享id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid 文件父级ID，如果为空或者为0，则表示获取根目录下的文件列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含文件列表数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取文件列表&quot;, description = &quot;根据用户会话、分享id和文件父级ID，返回符合条件的文件列表数据，按照最后更新时间降序排列&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;loadFileList&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">loadFileList</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="meta">@VerifyParam(required = true)</span> String shareId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   String filePid)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        SessionShareDto sessionShareDto = checkShare(session, shareId);</span><br><span class="line">        FileInfoQuery query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        <span class="keyword">if</span> (!StringTools.isEmpty(filePid) &amp;&amp; !Constants.ZERO_STR.equals(filePid)) &#123;</span><br><span class="line">            fileInfoService.checkRootFilePid(sessionShareDto.getFileId(), sessionShareDto.getShareUserId(), filePid);</span><br><span class="line">            query.setFilePid(filePid);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            query.setFileId(sessionShareDto.getFileId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        query.setUserId(sessionShareDto.getShareUserId());</span><br><span class="line">        query.setOrderBy(<span class="string">&quot;last_update_time desc&quot;</span>);</span><br><span class="line">        query.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        PaginationResultVO result = fileInfoService.findListByPage(query);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> getSuccessResponseVO(convert2PaginationVO(result, FileInfoVO.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验是否有权限访问分享文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session 用户会话</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId 分享id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分享信息对象，包含分享者ID、分享文件ID和过期时间等信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> SessionShareDto <span class="title">checkShare</span><span class="params">(HttpSession session, String shareId)</span> </span>&#123;</span><br><span class="line">        SessionShareDto sessionShareDto = getSessionShareFromSession(session, shareId);</span><br><span class="line">        <span class="keyword">if</span> (sessionShareDto == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_903);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (sessionShareDto.getExpireTime() != <span class="keyword">null</span> &amp;&amp; <span class="keyword">new</span> Date().after(sessionShareDto.getExpireTime())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_902);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sessionShareDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取目录信息&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/getFolderInfo&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">getFolderInfo</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@VerifyParam(required = true)</span> String shareId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="meta">@VerifyParam(required = true)</span> String path)</span> </span>&#123;</span><br><span class="line">        SessionShareDto sessionShareDto = checkShare(session, shareId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.getFolderInfo(path, sessionShareDto.getShareUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视频预览</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象，用于输出视频内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件ID，不能为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;视频预览&quot;, description = &quot;分片获取视频ts，用于视频播放预览&quot;)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/ts/getVideoInfo/&#123;shareId&#125;/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getVideoInfo</span><span class="params">(HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                             HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="meta">@PathVariable(&quot;shareId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String shareId,</span></span></span><br><span class="line"><span class="function"><span class="params">                             <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line">        SessionShareDto shareSessionDto = checkShare(session, shareId);</span><br><span class="line">        <span class="keyword">super</span>.getFile(response, fileId, shareSessionDto.getShareUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response 响应对象，用于输出文件内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session  用户会话对象，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件ID，不能为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;获取文件信息&quot;, description = &quot;读取文件内容，用于预览展示&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true, checkLogin = false)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getFile/&#123;shareId&#125;/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getFile</span><span class="params">(HttpServletResponse response, HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="meta">@PathVariable(&quot;shareId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String shareId,</span></span></span><br><span class="line"><span class="function"><span class="params">                        <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line">        SessionShareDto shareSessionDto = checkShare(session, shareId);</span><br><span class="line">        <span class="keyword">super</span>.getFile(response, fileId, shareSessionDto.getShareUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建下载链接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;创建下载链接&quot;, description = &quot;根据文件id生成一个随机的下载码，并存储到Redis中，返回下载码给前端&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkLogin = false)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/createDownloadUrl/&#123;userId&#125;/&#123;fileId&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseVO <span class="title">createDownloadUrl</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        <span class="meta">@PathVariable(&quot;shareId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String shareId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                        <span class="meta">@PathVariable(&quot;fileId&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String fileId)</span> </span>&#123;</span><br><span class="line">        SessionShareDto shareSessionDto = checkShare(session, shareId);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.createDownloadUrl(fileId, shareSessionDto.getShareUserId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 下载文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request  HttpServletRequest对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response HttpServletResponse对象，用于设置响应类型和头部信息，以及写入响应流</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code     下载码，用于从Redis中获取文件信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;下载文件&quot;, description = &quot;根据下载码从Redis中获取文件信息，读取文件并写入响应流中，实现文件的下载&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkLogin = false, checkParams = true)</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/download/&#123;code&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">download</span><span class="params">(HttpServletRequest request, HttpServletResponse response,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="meta">@PathVariable(&quot;code&quot;)</span> <span class="meta">@VerifyParam(required = true)</span> String code)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>.download(request, response, code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;保存到我的网盘&quot;)</span></span><br><span class="line">    <span class="meta">@GlobalInterceptor(checkParams = true)</span></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/saveShare&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveShare</span><span class="params">(HttpSession session,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="meta">@VerifyParam(required = true)</span> String shareId,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="meta">@VerifyParam(required = true)</span> String shareFileIds,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="meta">@VerifyParam(required = true)</span> String myFolderId)</span> </span>&#123;</span><br><span class="line">        SessionShareDto sessionShareDto = getSessionShareFromSession(session, shareId);</span><br><span class="line">        SessionWebUserDto sessionWebUserDto = getUserInfoFromSession(session);</span><br><span class="line">        <span class="comment">//判断是否是自己分享的文件</span></span><br><span class="line">        <span class="keyword">if</span> (sessionShareDto.getShareUserId().equals(sessionWebUserDto.getUserId())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;自己分享的文件无法保存到自己的网盘&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fileInfoService.saveShare(sessionShareDto.getFileId(), shareFileIds, myFolderId,</span><br><span class="line">                sessionShareDto.getShareUserId(), sessionWebUserDto.getUserId());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="entity包"><a href="#entity包" class="headerlink" title="entity包"></a>entity包</h2><h3 id="config包"><a href="#config包" class="headerlink" title="config包"></a>config包</h3><h4 id="AppConfig类"><a href="#AppConfig类" class="headerlink" title="AppConfig类"></a>AppConfig类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 应用配置类，封装了一些应用相关的配置信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 10:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component(&quot;appConfig&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送邮件的用户名，即发件人邮箱地址</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;spring.mail.username:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String sendUserName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 管理员邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;admin.emails:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String adminEmails;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;project.folder:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String projectFolder;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//region qq登录相关</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq应用的id，用于标识应用的身份</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qq.app.id:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qqAppId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq应用的密钥，用于验证应用的合法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qq.app.key:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qqAppKey;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq授权的url，用于获取用户的授权码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qq.url.authorization:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qqUrlAuthorization;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq获取访问令牌的url，用于获取用户的访问令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qq.url.access.token:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qqUrlAccessToken;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq获取用户唯一标识的url，用于获取用户的openid</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qq.url.openid:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qqUrlOpenId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq获取用户信息的url，用于获取用户的基本信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qq.url.user.info:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qqUrlUserInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq回调的url，用于接收授权码和访问令牌</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;qq.url.redirect:&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String qqUrlRedirect;</span><br><span class="line">    <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSendUserName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> sendUserName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAdminEmails</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> adminEmails;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getProjectFolder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> projectFolder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqAppId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qqAppId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqAppKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qqAppKey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqUrlAuthorization</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qqUrlAuthorization;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqUrlAccessToken</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qqUrlAccessToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqUrlOpenId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qqUrlOpenId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqUrlUserInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qqUrlUserInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqUrlRedirect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qqUrlRedirect;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="RedisConfig类"><a href="#RedisConfig类" class="headerlink" title="RedisConfig类"></a>RedisConfig类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> Redis配置类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 18:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义RedisTemplate类，设置不同的序列化方式</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> factory Redis连接工厂，用于创建Redis连接</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> RedisTemplate对象，用于操作Redis数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, V&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        RedisTemplate&lt;String, V&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        <span class="comment">//设置Redis连接工厂</span></span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line">        <span class="comment">//设置key的序列化方式</span></span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="comment">//设置value的序列化方式</span></span><br><span class="line">        template.setValueSerializer(RedisSerializer.json());</span><br><span class="line">        <span class="comment">//设置hash的key序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="comment">//设置hash的value序列化方式</span></span><br><span class="line">        template.setHashValueSerializer(RedisSerializer.json());</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="constants包"><a href="#constants包" class="headerlink" title="constants包"></a>constants包</h3><h4 id="Constants类"><a href="#Constants类" class="headerlink" title="Constants类"></a>Constants类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.constants;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 常量类，定义一些常用的常量</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Constants</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ZERO_STR = <span class="string">&quot;0&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer ZERO = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer LENGTH_5 = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer LENGTH_10 = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer LENGTH_15 = <span class="number">15</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer LENGTH_20 = <span class="number">20</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer LENGTH_30 = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer LENGTH_50 = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer LENGTH_150 = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SESSION_KEY = <span class="string">&quot;session_key&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SESSION_SHARE_KEY = <span class="string">&quot;session_share_key_&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CHECK_CODE_KEY = <span class="string">&quot;check_code_key&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CHECK_CODE_KEY_EMAIL = <span class="string">&quot;check_code_key_email&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_FOLDER_AVATAR_NAME = <span class="string">&quot;avatar/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AVATAR_SUFFIX = <span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String IMAGE_PNG_SUFFIX = <span class="string">&quot;.png&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String AVATAR_DEFAULT = <span class="string">&quot;default_avatar.jpg&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_FOLDER_FILE = <span class="string">&quot;/file/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_FOLDER_TEMP = <span class="string">&quot;/temp&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> MB = <span class="number">1024</span> * <span class="number">1024L</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//region Redis</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一分钟</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer REDIS_KEY_EXPIRED_ONE_MINUTE = <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 五分钟</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer REDIS_KEY_EXPIRED_FIVE_MINUTE = REDIS_KEY_EXPIRED_ONE_MINUTE * <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一小时</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer REDIS_KEY_EXPIRED_ONE_HOUR = REDIS_KEY_EXPIRED_ONE_MINUTE * <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一天</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Integer REDIS_KEY_EXPIRED_DAY = REDIS_KEY_EXPIRED_ONE_MINUTE * <span class="number">60</span> * <span class="number">24</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REDIS_KEY_SYS_SETTING = <span class="string">&quot;xingyunpan:syssetting:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REDIS_KEY_USER_SPACE_USE = <span class="string">&quot;xingyunpan:user:spaceuse:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REDIS_KEY_USER_FILE_TEMP_SIZE = <span class="string">&quot;xingyunpan:user:file:temp:&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String REDIS_KEY_DOWNLOAD = <span class="string">&quot;xingyunpan:download:&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String VIEW_OBJ_RESULT_KEY = <span class="string">&quot;result&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String TS_NAME = <span class="string">&quot;index.ts&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String M3U8_NAME = <span class="string">&quot;index.m3u8&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="dto包"><a href="#dto包" class="headerlink" title="dto包"></a>dto包</h3><h4 id="DownloadFileDto类"><a href="#DownloadFileDto类" class="headerlink" title="DownloadFileDto类"></a>DownloadFileDto类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.dto;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件下载信息类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-29 21:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DownloadFileDto</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件下载码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String downloadCode;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String filePath;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDownloadCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> downloadCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDownloadCode</span><span class="params">(String downloadCode)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.downloadCode = downloadCode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePath</span><span class="params">(String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePath = filePath;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="QQInfoDto类"><a href="#QQInfoDto类" class="headerlink" title="QQInfoDto类"></a>QQInfoDto类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.dto;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 21:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QQInfoDto</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer ret;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> String nickname;</span><br><span class="line">    <span class="keyword">private</span> String figureurl_qq_1;</span><br><span class="line">    <span class="keyword">private</span> String figureurl_qq_2;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getRet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRet</span><span class="params">(Integer ret)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.ret = ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMsg</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickname</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickname</span><span class="params">(String nickname)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickname = nickname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFigureurl_qq_1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> figureurl_qq_1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFigureurl_qq_1</span><span class="params">(String figureurl_qq_1)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.figureurl_qq_1 = figureurl_qq_1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFigureurl_qq_2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> figureurl_qq_2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFigureurl_qq_2</span><span class="params">(String figureurl_qq_2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.figureurl_qq_2 = figureurl_qq_2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getGender</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> gender;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setGender</span><span class="params">(String gender)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.gender = gender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="SessionShareDto类"><a href="#SessionShareDto类" class="headerlink" title="SessionShareDto类"></a>SessionShareDto类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分享信息类</span></span><br><span class="line"><span class="comment"> * 封装了分享的相关信息，如分享ID，分享用户ID，过期时间，文件ID等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 21:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionShareDto</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String shareId;</span><br><span class="line">    <span class="keyword">private</span> String shareUserId;</span><br><span class="line">    <span class="keyword">private</span> Date expireTime;</span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getShareId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shareId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareId</span><span class="params">(String shareId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareId = shareId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getShareUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shareUserId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareUserId</span><span class="params">(String shareUserId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareUserId = shareUserId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getExpireTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExpireTime</span><span class="params">(Date expireTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.expireTime = expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileId</span><span class="params">(String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileId = fileId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="SessionWebUserDto类"><a href="#SessionWebUserDto类" class="headerlink" title="SessionWebUserDto类"></a>SessionWebUserDto类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.dto;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息类</span></span><br><span class="line"><span class="comment"> * 封装了用户的相关信息，如昵称，用户ID，是否是管理员，已用空间，总空间，头像等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 21:09</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SessionWebUserDto</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> Boolean isAdmin;</span><br><span class="line">    <span class="keyword">private</span> Long useSpace;</span><br><span class="line">    <span class="keyword">private</span> Long totalSpace;</span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAvatar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> avatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAvatar</span><span class="params">(String avatar)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.avatar = avatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickName</span><span class="params">(String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickName = nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getAdmin</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isAdmin;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAdmin</span><span class="params">(Boolean admin)</span> </span>&#123;</span><br><span class="line">        isAdmin = admin;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="SysSettingsDto类"><a href="#SysSettingsDto类" class="headerlink" title="SysSettingsDto类"></a>SysSettingsDto类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 系统设置对象类，封装了一些系统相关的设置信息，例如注册邮件标题、内容等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 10:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(ignoreUnknown = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SysSettingsDto</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String registerEmailTitle = <span class="string">&quot;邮箱验证码&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String registerEmailContent = <span class="string">&quot;你好，您的邮箱验证码是：%s，15分钟有效&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用户初始可用空间，默认为5MB</span></span><br><span class="line">    <span class="keyword">private</span> Integer userInitUseSpace = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRegisterEmailTitle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> registerEmailTitle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRegisterEmailTitle</span><span class="params">(String registerEmailTitle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.registerEmailTitle = registerEmailTitle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRegisterEmailContent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> registerEmailContent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRegisterEmailContent</span><span class="params">(String registerEmailContent)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.registerEmailContent = registerEmailContent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getUserInitUseSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userInitUseSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserInitUseSpace</span><span class="params">(Integer userInitUseSpace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userInitUseSpace = userInitUseSpace;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="UploadResultDto类"><a href="#UploadResultDto类" class="headerlink" title="UploadResultDto类"></a>UploadResultDto类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.dto;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 上传结果的数据传输对象，用于返回给前端</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 10:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(ignoreUnknown = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UploadResultDto</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件的唯一标识符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件的上传状态，如秒传，上传中，上传完成等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileId</span><span class="params">(String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileId = fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(String status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="UserSpaceDto类"><a href="#UserSpaceDto类" class="headerlink" title="UserSpaceDto类"></a>UserSpaceDto类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.dto;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户空间数据传输对象类</span></span><br><span class="line"><span class="comment"> * 封装了用户的使用空间和总空间的信息</span></span><br><span class="line"><span class="comment"> * 提供了获取和设置使用空间和总空间的方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 13:44</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserSpaceDto</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用户的使用空间</span></span><br><span class="line">    <span class="keyword">private</span> Long useSpace;</span><br><span class="line">    <span class="comment">//用户的总空间</span></span><br><span class="line">    <span class="keyword">private</span> Long totalSpace;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getUseSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> useSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUseSpace</span><span class="params">(Long useSpace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.useSpace = useSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getTotalSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalSpace</span><span class="params">(Long totalSpace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalSpace = totalSpace;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="enums包"><a href="#enums包" class="headerlink" title="enums包"></a>enums包</h3><h4 id="DateTimePatternEnum类"><a href="#DateTimePatternEnum类" class="headerlink" title="DateTimePatternEnum类"></a>DateTimePatternEnum类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定义不同的日期时间格式，每个枚举值都有一个对应的字符串格式</span></span><br><span class="line"><span class="comment"> * 可以根据这些格式来进行日期时间的转换和显示</span></span><br><span class="line"><span class="comment"> * 例如，YYYY_MM_DD_HH_MM_SS表示&quot;2023-05-26 21:17:41&quot;这样的格式</span></span><br><span class="line"><span class="comment"> * YYYY_MM_DD表示&quot;2023-05-26&quot;这样的格式</span></span><br><span class="line"><span class="comment"> * YYYYMM表示&quot;202305&quot;这样的格式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">DateTimePatternEnum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//常用的日期时间格式</span></span><br><span class="line">    YYYY_MM_DD_HH_MM_SS(<span class="string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span>), YYYY_MM_DD(<span class="string">&quot;yyyy-MM-dd&quot;</span>), YYYYMM(<span class="string">&quot;yyyyMM&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//每个枚举值都有一个对应的字符串格式</span></span><br><span class="line">    <span class="keyword">private</span> String pattern;</span><br><span class="line"></span><br><span class="line">    DateTimePatternEnum(String pattern) &#123;</span><br><span class="line">        <span class="keyword">this</span>.pattern = pattern;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPattern</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pattern;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileCategoryEnums类"><a href="#FileCategoryEnums类" class="headerlink" title="FileCategoryEnums类"></a>FileCategoryEnums类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件的分类枚举，用于区分不同类型的文件，如视频，音频，图片，文档等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 10:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FileCategoryEnums</span> </span>&#123;</span><br><span class="line">    VIDEO(<span class="number">1</span>, <span class="string">&quot;video&quot;</span>, <span class="string">&quot;视频&quot;</span>),</span><br><span class="line">    MUSIC(<span class="number">2</span>, <span class="string">&quot;music&quot;</span>, <span class="string">&quot;音频&quot;</span>),</span><br><span class="line">    IMAGE(<span class="number">3</span>, <span class="string">&quot;image&quot;</span>, <span class="string">&quot;图片&quot;</span>),</span><br><span class="line">    DOC(<span class="number">4</span>, <span class="string">&quot;doc&quot;</span>, <span class="string">&quot;文档&quot;</span>),</span><br><span class="line">    OTHERS(<span class="number">5</span>, <span class="string">&quot;others&quot;</span>, <span class="string">&quot;其他&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer category;</span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    FileCategoryEnums(Integer category, String code, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> FileCategoryEnums <span class="title">getByCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (FileCategoryEnums item : FileCategoryEnums.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.getCode().equals(code)) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileDelFlagEnums类"><a href="#FileDelFlagEnums类" class="headerlink" title="FileDelFlagEnums类"></a>FileDelFlagEnums类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件的删除标志枚举，用于标识文件的删除状态，如删除，回收站，使用中等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 10:23</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FileDelFlagEnums</span> </span>&#123;</span><br><span class="line">    DEL(<span class="number">0</span>, <span class="string">&quot;删除&quot;</span>),</span><br><span class="line">    RECYCLE(<span class="number">1</span>, <span class="string">&quot;回收站&quot;</span>),</span><br><span class="line">    USING(<span class="number">2</span>, <span class="string">&quot;使用中&quot;</span>);;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer flag;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    FileDelFlagEnums(Integer flag, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.flag = flag;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFlag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> flag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileFolderTypeEnums类"><a href="#FileFolderTypeEnums类" class="headerlink" title="FileFolderTypeEnums类"></a>FileFolderTypeEnums类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件目录的类型枚举，用于区分文件和目录</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 13:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FileFolderTypeEnums</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    FILE(<span class="number">0</span>, <span class="string">&quot;文件&quot;</span>),</span><br><span class="line"></span><br><span class="line">    FOLDER(<span class="number">1</span>, <span class="string">&quot;目录&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    FileFolderTypeEnums(Integer type, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileStatusEnums类"><a href="#FileStatusEnums类" class="headerlink" title="FileStatusEnums类"></a>FileStatusEnums类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件的状态枚举，用于标识文件的转码状态，如转码中，转码失败，使用中等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 10:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FileStatusEnums</span> </span>&#123;</span><br><span class="line">    TRANSFER(<span class="number">0</span>, <span class="string">&quot;转码中&quot;</span>),</span><br><span class="line">    TRANSFER_FAIL(<span class="number">1</span>, <span class="string">&quot;转码失败&quot;</span>),</span><br><span class="line">    USING(<span class="number">2</span>, <span class="string">&quot;使用中&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    FileStatusEnums(Integer status, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileTypeEnums类"><a href="#FileTypeEnums类" class="headerlink" title="FileTypeEnums类"></a>FileTypeEnums类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ArrayUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件的具体类型枚举，用于区分不同格式的文件，如视频，音频，图片，文档等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 13:27</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">FileTypeEnums</span> </span>&#123;</span><br><span class="line">    <span class="comment">//1:视频 2:音频  3:图片 4:pdf 5:word 6:excel 7:txt 8:code 9:zip 10:其他文件</span></span><br><span class="line">    VIDEO(FileCategoryEnums.VIDEO, <span class="number">1</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;.mp4&quot;</span>, <span class="string">&quot;.avi&quot;</span>, <span class="string">&quot;.rmvb&quot;</span>, <span class="string">&quot;.mkv&quot;</span>, <span class="string">&quot;.mov&quot;</span>&#125;, <span class="string">&quot;视频&quot;</span>),</span><br><span class="line">    MUSIC(FileCategoryEnums.MUSIC, <span class="number">2</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;.mp3&quot;</span>, <span class="string">&quot;.wav&quot;</span>, <span class="string">&quot;.wma&quot;</span>, <span class="string">&quot;.mp2&quot;</span>, <span class="string">&quot;.flac&quot;</span>, <span class="string">&quot;.midi&quot;</span>, <span class="string">&quot;.ra&quot;</span>, <span class="string">&quot;.ape&quot;</span>, <span class="string">&quot;.aac&quot;</span>, <span class="string">&quot;.cda&quot;</span>&#125;, <span class="string">&quot;音频&quot;</span>),</span><br><span class="line">    IMAGE(FileCategoryEnums.IMAGE, <span class="number">3</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;.jpeg&quot;</span>, <span class="string">&quot;.jpg&quot;</span>, <span class="string">&quot;.png&quot;</span>, <span class="string">&quot;.gif&quot;</span>, <span class="string">&quot;.bmp&quot;</span>, <span class="string">&quot;.dds&quot;</span>, <span class="string">&quot;.psd&quot;</span>, <span class="string">&quot;.pdt&quot;</span>, <span class="string">&quot;.webp&quot;</span>, <span class="string">&quot;.xmp&quot;</span>, <span class="string">&quot;.svg&quot;</span>, <span class="string">&quot;.tiff&quot;</span>&#125;, <span class="string">&quot;图片&quot;</span>),</span><br><span class="line">    PDF(FileCategoryEnums.DOC, <span class="number">4</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;.pdf&quot;</span>&#125;, <span class="string">&quot;pdf&quot;</span>),</span><br><span class="line">    WORD(FileCategoryEnums.DOC, <span class="number">5</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;.docx&quot;</span>&#125;, <span class="string">&quot;word&quot;</span>),</span><br><span class="line">    EXCEL(FileCategoryEnums.DOC, <span class="number">6</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;.xlsx&quot;</span>&#125;, <span class="string">&quot;excel&quot;</span>),</span><br><span class="line">    TXT(FileCategoryEnums.DOC, <span class="number">7</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;.txt&quot;</span>&#125;, <span class="string">&quot;txt文本&quot;</span>),</span><br><span class="line">    PROGRAME(FileCategoryEnums.OTHERS, <span class="number">8</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;.h&quot;</span>, <span class="string">&quot;.c&quot;</span>, <span class="string">&quot;.hpp&quot;</span>, <span class="string">&quot;.hxx&quot;</span>, <span class="string">&quot;.cpp&quot;</span>, <span class="string">&quot;.cc&quot;</span>, <span class="string">&quot;.c++&quot;</span>, <span class="string">&quot;.cxx&quot;</span>, <span class="string">&quot;.m&quot;</span>, <span class="string">&quot;.o&quot;</span>, <span class="string">&quot;.s&quot;</span>, <span class="string">&quot;.dll&quot;</span>, <span class="string">&quot;.cs&quot;</span>,</span><br><span class="line">            <span class="string">&quot;.java&quot;</span>, <span class="string">&quot;.class&quot;</span>, <span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.ts&quot;</span>, <span class="string">&quot;.css&quot;</span>, <span class="string">&quot;.scss&quot;</span>, <span class="string">&quot;.vue&quot;</span>, <span class="string">&quot;.jsx&quot;</span>, <span class="string">&quot;.sql&quot;</span>, <span class="string">&quot;.md&quot;</span>, <span class="string">&quot;.json&quot;</span>, <span class="string">&quot;.html&quot;</span>, <span class="string">&quot;.xml&quot;</span>&#125;, <span class="string">&quot;CODE&quot;</span>),</span><br><span class="line">    ZIP(FileCategoryEnums.OTHERS, <span class="number">9</span>, <span class="keyword">new</span> String[]&#123;<span class="string">&quot;rar&quot;</span>, <span class="string">&quot;.zip&quot;</span>, <span class="string">&quot;.7z&quot;</span>, <span class="string">&quot;.cab&quot;</span>, <span class="string">&quot;.arj&quot;</span>, <span class="string">&quot;.lzh&quot;</span>, <span class="string">&quot;.tar&quot;</span>, <span class="string">&quot;.gz&quot;</span>, <span class="string">&quot;.ace&quot;</span>, <span class="string">&quot;.uue&quot;</span>, <span class="string">&quot;.bz&quot;</span>, <span class="string">&quot;.jar&quot;</span>, <span class="string">&quot;.iso&quot;</span>,</span><br><span class="line">            <span class="string">&quot;.mpq&quot;</span>&#125;, <span class="string">&quot;压缩包&quot;</span>),</span><br><span class="line">    OTHERS(FileCategoryEnums.OTHERS, <span class="number">10</span>, <span class="keyword">new</span> String[]&#123;&#125;, <span class="string">&quot;其他&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件的分类，如视频，音频，图片，文档等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> FileCategoryEnums category;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件的类型编号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件的后缀数组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] suffixs;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件的类型描述</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    FileTypeEnums(FileCategoryEnums category, Integer type, String[] suffixs, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.category = category;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.suffixs = suffixs;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据文件的后缀获取对应的文件类型枚举</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> suffix 文件的后缀</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> FileTypeEnums <span class="title">getFileTypeBySuffix</span><span class="params">(String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (FileTypeEnums item : FileTypeEnums.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ArrayUtils.contains(item.getSuffixs(), suffix)) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> FileTypeEnums.OTHERS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> FileTypeEnums <span class="title">getByType</span><span class="params">(Integer type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (FileTypeEnums item : FileTypeEnums.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.getType().equals(type)) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getSuffixs() &#123;</span><br><span class="line">        <span class="keyword">return</span> suffixs;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FileCategoryEnums <span class="title">getCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> category;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="PageSize类"><a href="#PageSize类" class="headerlink" title="PageSize类"></a>PageSize类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定义不同的分页大小，每个枚举值都有一个对应的整数大小</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">PageSize</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//种常用的分页大小</span></span><br><span class="line">    SIZE15(<span class="number">15</span>), SIZE20(<span class="number">20</span>), SIZE30(<span class="number">30</span>), SIZE40(<span class="number">40</span>), SIZE50(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//每个枚举值都有一个对应的整数大小</span></span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">PageSize</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ResponseCodeEnum类"><a href="#ResponseCodeEnum类" class="headerlink" title="ResponseCodeEnum类"></a>ResponseCodeEnum类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 响应编码枚举类</span></span><br><span class="line"><span class="comment"> * 定义了一些常用的响应编码和对应的信息，用于封装响应对象</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 21:05</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ResponseCodeEnum</span> </span>&#123;</span><br><span class="line">    CODE_200(<span class="number">200</span>, <span class="string">&quot;请求成功&quot;</span>),</span><br><span class="line">    CODE_404(<span class="number">404</span>, <span class="string">&quot;请求地址不存在&quot;</span>),</span><br><span class="line">    CODE_600(<span class="number">600</span>, <span class="string">&quot;请求参数错误&quot;</span>),</span><br><span class="line">    CODE_601(<span class="number">601</span>, <span class="string">&quot;信息已经存在&quot;</span>),</span><br><span class="line">    CODE_500(<span class="number">500</span>, <span class="string">&quot;服务器返回错误，请联系管理员&quot;</span>),</span><br><span class="line">    CODE_901(<span class="number">901</span>, <span class="string">&quot;登录超时，请重新登录&quot;</span>),</span><br><span class="line">    CODE_902(<span class="number">902</span>, <span class="string">&quot;分享连接不存在，或者已失效&quot;</span>),</span><br><span class="line">    CODE_903(<span class="number">903</span>, <span class="string">&quot;分享验证失效，请重新验证&quot;</span>),</span><br><span class="line">    CODE_904(<span class="number">904</span>, <span class="string">&quot;网盘空间不足，请扩容&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    ResponseCodeEnum(Integer code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMsg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ShareValidTypeEnums类"><a href="#ShareValidTypeEnums类" class="headerlink" title="ShareValidTypeEnums类"></a>ShareValidTypeEnums类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-01 21:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">ShareValidTypeEnums</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    DAY_1(<span class="number">0</span>, <span class="number">1</span>, <span class="string">&quot;1天&quot;</span>),</span><br><span class="line">    DAY_7(<span class="number">1</span>, <span class="number">7</span>, <span class="string">&quot;7天&quot;</span>),</span><br><span class="line">    DAY_30(<span class="number">2</span>, <span class="number">30</span>, <span class="string">&quot;30天&quot;</span>),</span><br><span class="line">    FOREVER(<span class="number">3</span>, -<span class="number">1</span>, <span class="string">&quot;永久有效&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer type;</span><br><span class="line">    <span class="keyword">private</span> Integer days;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    ShareValidTypeEnums(Integer type, Integer days, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.days = days;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ShareValidTypeEnums <span class="title">getByType</span><span class="params">(Integer type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (ShareValidTypeEnums typeEnums : ShareValidTypeEnums.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (typeEnums.getType().equals(type)) &#123;</span><br><span class="line">                <span class="keyword">return</span> typeEnums;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getDays</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> days;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="UploadStatusEnums类"><a href="#UploadStatusEnums类" class="headerlink" title="UploadStatusEnums类"></a>UploadStatusEnums类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件的上传状态枚举，用于标识文件的上传进度，如秒传，上传中，上传完成等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 11:03</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">UploadStatusEnums</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    UPLOAD_SECONDS(<span class="string">&quot;upload_seconds&quot;</span>, <span class="string">&quot;秒传&quot;</span>),</span><br><span class="line">    UPLOADING(<span class="string">&quot;uploading&quot;</span>, <span class="string">&quot;上传中&quot;</span>),</span><br><span class="line">    UPLOAD_FINISH(<span class="string">&quot;upload_finish&quot;</span>, <span class="string">&quot;上传完成&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    UploadStatusEnums(String code, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="UserStatusEnum类"><a href="#UserStatusEnum类" class="headerlink" title="UserStatusEnum类"></a>UserStatusEnum类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户状态枚举类 定义了用户的两种状态：禁用和启用</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 13:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">UserStatusEnum</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    DISABLE(<span class="number">0</span>, <span class="string">&quot;禁用&quot;</span>),</span><br><span class="line">    ENABLE(<span class="number">1</span>, <span class="string">&quot;启用&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    UserStatusEnum(Integer status, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserStatusEnum <span class="title">getByStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (UserStatusEnum item : UserStatusEnum.values()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (item.getStatus().equals(status)) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDesc</span><span class="params">(String desc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="VerifyRegexEnum类"><a href="#VerifyRegexEnum类" class="headerlink" title="VerifyRegexEnum类"></a>VerifyRegexEnum类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.enums;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 校验正则枚举类，定义了一些常用的校验正则表达式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 11:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">VerifyRegexEnum</span> </span>&#123;</span><br><span class="line">    NO(<span class="string">&quot;&quot;</span>, <span class="string">&quot;不校验&quot;</span>),</span><br><span class="line">    IP(<span class="string">&quot;([1-9]|[1-9]\\d|1\\d&#123;2&#125;|2[0-4]\\d|25[0-5])(\\.(\\d|[1-9]\\d|1\\d&#123;2&#125;|2[0-4]\\d|25[0-5]))&#123;3&#125;&quot;</span>, <span class="string">&quot;IP地址&quot;</span>),</span><br><span class="line">    POSITIVE_INTEGER(<span class="string">&quot;^[0-9]*[1-9][0-9]*$&quot;</span>, <span class="string">&quot;正整数&quot;</span>),</span><br><span class="line">    NUMBER_LETTER_UNDER_LINE(<span class="string">&quot;^\\w+$&quot;</span>, <span class="string">&quot;由数字、26个英文字母或者下划线组成的字符串&quot;</span>),</span><br><span class="line">    EMAIL(<span class="string">&quot;^[\\w-]+(\\.[\\w-]+)*@[\\w-]+(\\.[\\w-]+)+$&quot;</span>, <span class="string">&quot;邮箱&quot;</span>),</span><br><span class="line">    PHONE(<span class="string">&quot;(1[0-9])\\d&#123;9&#125;$&quot;</span>, <span class="string">&quot;手机号码&quot;</span>),</span><br><span class="line">    COMMON(<span class="string">&quot;^[a-zA-Z0-9_\\u4e00-\\u9fa5]+$&quot;</span>, <span class="string">&quot;数字，字母，中文，下划线&quot;</span>),</span><br><span class="line">    PASSWORD(<span class="string">&quot;^(?=.*\\d)(?=.*[a-zA-Z])[\\da-zA-Z~!@#$%^&amp;*_]&#123;8,&#125;$&quot;</span>, <span class="string">&quot;只能是数字，字母，特殊字符 8-18位&quot;</span>),</span><br><span class="line">    ACCOUNT(<span class="string">&quot;^[0-9a-zA-Z_]&#123;1,&#125;$&quot;</span>, <span class="string">&quot;字母开头,由数字、英文字母或者下划线组成&quot;</span>),</span><br><span class="line">    MONEY(<span class="string">&quot;^[0-9]+(.[0-9]&#123;1,2&#125;)?$&quot;</span>, <span class="string">&quot;金额&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String regex;</span><br><span class="line">    <span class="keyword">private</span> String desc;</span><br><span class="line"></span><br><span class="line">    VerifyRegexEnum(String regex, String desc) &#123;</span><br><span class="line">        <span class="keyword">this</span>.regex = regex;</span><br><span class="line">        <span class="keyword">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRegex</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> regex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDesc</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="po包"><a href="#po包" class="headerlink" title="po包"></a>po包</h3><h4 id="EmailCode类"><a href="#EmailCode类" class="headerlink" title="EmailCode类"></a>EmailCode类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.po;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.DateTimePatternEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.DateUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 邮箱验证码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailCode</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:未使用  1:已使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTime</span><span class="params">(Date createTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTime = createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;邮箱:&quot;</span> + (email == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : email) + <span class="string">&quot;，编号:&quot;</span> + (code == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : code) +</span><br><span class="line">                <span class="string">&quot;，创建时间:&quot;</span> + (createTime == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : DateUtil.format(createTime,</span><br><span class="line">                DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern())) +</span><br><span class="line">                <span class="string">&quot;，0:未使用  1:已使用:&quot;</span> + (status == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : status);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileInfo类"><a href="#FileInfo类" class="headerlink" title="FileInfo类"></a>FileInfo类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.po;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.DateTimePatternEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.DateUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 13:56</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileInfo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * md5值，第一次上传记录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileMd5;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 父级ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String filePid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long fileSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileCover;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String filePath;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date lastUpdateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:文件 1:目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer folderType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1:视频 2:音频  3:图片 4:文档 5:其他</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileCategory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1:视频 2:音频  3:图片 4:pdf 5:doc 6:excel 7:txt 8:code 9:zip 10:其他</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:转码中 1转码失败 2:转码成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 回收站时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date recoveryTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除标记 0:删除  1:回收站  2:正常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickName</span><span class="params">(String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickName = nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileId</span><span class="params">(String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileId = fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileMd5</span><span class="params">(String fileMd5)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileMd5 = fileMd5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileMd5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileMd5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePid</span><span class="params">(String filePid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePid = filePid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilePid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.filePid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileSize</span><span class="params">(Long fileSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileSize = fileSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getFileSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCover</span><span class="params">(String fileCover)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCover = fileCover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileCover</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileCover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePath</span><span class="params">(String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePath = filePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.filePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTime</span><span class="params">(Date createTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTime = createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastUpdateTime</span><span class="params">(Date lastUpdateTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastUpdateTime = lastUpdateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getLastUpdateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.lastUpdateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFolderType</span><span class="params">(Integer folderType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.folderType = folderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFolderType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.folderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCategory</span><span class="params">(Integer fileCategory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCategory = fileCategory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFileCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileCategory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileType</span><span class="params">(Integer fileType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileType = fileType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFileType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRecoveryTime</span><span class="params">(Date recoveryTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.recoveryTime = recoveryTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getRecoveryTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.recoveryTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDelFlag</span><span class="params">(Integer delFlag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.delFlag = delFlag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getDelFlag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.delFlag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;文件ID:&quot;</span> + (fileId == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : fileId) + <span class="string">&quot;，用户ID:&quot;</span> +</span><br><span class="line">                (userId == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : userId) + <span class="string">&quot;，md5值，第一次上传记录:&quot;</span> +</span><br><span class="line">                (fileMd5 == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : fileMd5) + <span class="string">&quot;，父级ID:&quot;</span> + (filePid == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : filePid) +</span><br><span class="line">                <span class="string">&quot;，文件大小:&quot;</span> + (fileSize == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : fileSize) + <span class="string">&quot;，文件名称:&quot;</span> +</span><br><span class="line">                (fileName == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : fileName) + <span class="string">&quot;，封面:&quot;</span> + (fileCover == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> :</span><br><span class="line">                fileCover) + <span class="string">&quot;，文件路径:&quot;</span> + (filePath == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : filePath) + <span class="string">&quot;，创建时间:&quot;</span> +</span><br><span class="line">                (createTime == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : DateUtil.format(createTime, DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern())) + <span class="string">&quot;，最后更新时间:&quot;</span> + (lastUpdateTime == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : DateUtil.format(lastUpdateTime, DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern())) + <span class="string">&quot;，0:文件 1:目录:&quot;</span> + (folderType == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : folderType) + <span class="string">&quot;，1:视频 2:音频  3:图片 4:文档 5:其他:&quot;</span> + (fileCategory == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : fileCategory) + <span class="string">&quot;， 1:视频 2:音频  3:图片 4:pdf 5:doc 6:excel 7:txt 8:code 9:zip 10:其他:&quot;</span> + (fileType == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : fileType) + <span class="string">&quot;，0:转码中 1转码失败 2:转码成功:&quot;</span> + (status == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : status) + <span class="string">&quot;，回收站时间:&quot;</span> + (recoveryTime == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : DateUtil.format(recoveryTime, DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern())) + <span class="string">&quot;，删除标记 0:删除  1:回收站  2:正常:&quot;</span> + (delFlag == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : delFlag);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileShare类"><a href="#FileShare类" class="headerlink" title="FileShare类"></a>FileShare类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.po;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.DateTimePatternEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.DateUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件分享</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-01 19:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileShare</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String shareId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 有效期类型 0:1天 1:7天 2:30天 3:永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer validType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失效时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date shareTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提取码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 浏览次数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer showCount;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:文件 1:目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer folderType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1:视频 2:音频  3:图片 4:文档 5:其他</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileCategory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1:视频 2:音频  3:图片 4:pdf 5:doc 6:excel 7:txt 8:code 9:zip 10:其他</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileCover;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareId</span><span class="params">(String shareId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareId = shareId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getShareId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.shareId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileId</span><span class="params">(String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileId = fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValidType</span><span class="params">(Integer validType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.validType = validType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getValidType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.validType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExpireTime</span><span class="params">(Date expireTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.expireTime = expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getExpireTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareTime</span><span class="params">(Date shareTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareTime = shareTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getShareTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.shareTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShowCount</span><span class="params">(Integer showCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.showCount = showCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getShowCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.showCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFolderType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> folderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFolderType</span><span class="params">(Integer folderType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.folderType = folderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFileCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileCategory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCategory</span><span class="params">(Integer fileCategory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCategory = fileCategory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFileType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileType</span><span class="params">(Integer fileType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileType = fileType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileCover</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileCover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCover</span><span class="params">(String fileCover)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCover = fileCover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;分享ID:&quot;</span> + (shareId == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : shareId) + <span class="string">&quot;，文件ID:&quot;</span> + (fileId == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : fileId) + <span class="string">&quot;，用户ID:&quot;</span> + (userId == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : userId) + <span class="string">&quot;，有效期类型 0:1天 &quot;</span> +</span><br><span class="line">                <span class="string">&quot;1:7天 2:30天 3:永久有效:&quot;</span> + (validType == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : validType) + <span class="string">&quot;，失效时间:&quot;</span> + (expireTime == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : DateUtil.format(expireTime,</span><br><span class="line">                DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern())) + <span class="string">&quot;，分享时间:&quot;</span> + (shareTime == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : DateUtil.format(shareTime,</span><br><span class="line">                DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern())) + <span class="string">&quot;，提取码:&quot;</span> + (code == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : code) + <span class="string">&quot;，浏览次数:&quot;</span> + (showCount == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : showCount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="UserInfo类"><a href="#UserInfo类" class="headerlink" title="UserInfo类"></a>UserInfo类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.po;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.DateTimePatternEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.DateUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq 头像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String qqAvatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq openID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String qqOpenId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加入时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date joinTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后登录时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date lastLoginTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:禁用 1:正常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用空间单位byte</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long useSpace;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 总空间单位byte</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long totalSpace;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickName</span><span class="params">(String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickName = nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQqAvatar</span><span class="params">(String qqAvatar)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.qqAvatar = qqAvatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqAvatar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.qqAvatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQqOpenId</span><span class="params">(String qqOpenId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.qqOpenId = qqOpenId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqOpenId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.qqOpenId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJoinTime</span><span class="params">(Date joinTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.joinTime = joinTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getJoinTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.joinTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastLoginTime</span><span class="params">(Date lastLoginTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastLoginTime = lastLoginTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getLastLoginTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.lastLoginTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUseSpace</span><span class="params">(Long useSpace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.useSpace = useSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getUseSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.useSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalSpace</span><span class="params">(Long totalSpace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalSpace = totalSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getTotalSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.totalSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;用户ID:&quot;</span> + (userId == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : userId) + <span class="string">&quot;，昵称:&quot;</span> +</span><br><span class="line">                (nickName == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : nickName) + <span class="string">&quot;，邮箱:&quot;</span> + (email == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : email) +</span><br><span class="line">                <span class="string">&quot;，qqAvatar:&quot;</span> + (qqAvatar == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : qqAvatar) + <span class="string">&quot;，qqOpenId:&quot;</span> +</span><br><span class="line">                (qqOpenId == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : qqOpenId) + <span class="string">&quot;，密码:&quot;</span> + (password == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : password) +</span><br><span class="line">                <span class="string">&quot;，加入时间:&quot;</span> + (joinTime == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> :</span><br><span class="line">                DateUtil.format(joinTime, DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern())) +</span><br><span class="line">                <span class="string">&quot;，最后登录时间:&quot;</span> + (lastLoginTime == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> :</span><br><span class="line">                DateUtil.format(lastLoginTime, DateTimePatternEnum.YYYY_MM_DD_HH_MM_SS.getPattern())) +</span><br><span class="line">                <span class="string">&quot;，0:禁用 1:正常:&quot;</span> + (status == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : status) + <span class="string">&quot;，useSpace:&quot;</span> +</span><br><span class="line">                (useSpace == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : useSpace) + <span class="string">&quot;，totalSpace:&quot;</span> + (totalSpace == <span class="keyword">null</span> ? <span class="string">&quot;空&quot;</span> : totalSpace);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="query包"><a href="#query包" class="headerlink" title="query包"></a>query包</h3><h4 id="BaseParam类"><a href="#BaseParam类" class="headerlink" title="BaseParam类"></a>BaseParam类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.query;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 基础参数类，用于封装分页和排序的参数</span></span><br><span class="line"><span class="comment"> * 包含一个简单分页对象，当前页码，每页显示的记录数，排序字段等属性</span></span><br><span class="line"><span class="comment"> * 提供了相应的getter和setter方法，以及设置排序字段的方法</span></span><br><span class="line"><span class="comment"> * 可以根据这些参数来构造查询条件和返回结果集合</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BaseParam</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一个简单分页对象，用于存储分页相关的信息</span></span><br><span class="line">    <span class="keyword">private</span> SimplePage simplePage;</span><br><span class="line">    <span class="comment">//当前页码，从1开始</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageNo;</span><br><span class="line">    <span class="comment">//每页显示的记录数</span></span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">    <span class="comment">//排序字段，可以为空</span></span><br><span class="line">    <span class="keyword">private</span> String orderBy;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SimplePage <span class="title">getSimplePage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> simplePage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSimplePage</span><span class="params">(SimplePage simplePage)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.simplePage = simplePage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getPageNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageNo</span><span class="params">(Integer pageNo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageNo = pageNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getPageSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageSize</span><span class="params">(Integer pageSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOrderBy</span><span class="params">(String orderBy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.orderBy = orderBy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOrderBy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.orderBy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="EmailCodeQuery类"><a href="#EmailCodeQuery类" class="headerlink" title="EmailCodeQuery类"></a>EmailCodeQuery类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.query;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 邮箱验证码参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EmailCodeQuery</span> <span class="keyword">extends</span> <span class="title">BaseParam</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String emailFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 编号</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String codeFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String createTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String createTimeEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:未使用  1:已使用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmailFuzzy</span><span class="params">(String emailFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.emailFuzzy = emailFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmailFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.emailFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCodeFuzzy</span><span class="params">(String codeFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.codeFuzzy = codeFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCodeFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.codeFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTime</span><span class="params">(String createTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTime = createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTimeStart</span><span class="params">(String createTimeStart)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTimeStart = createTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCreateTimeStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.createTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTimeEnd</span><span class="params">(String createTimeEnd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTimeEnd = createTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCreateTimeEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.createTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileInfoQuery类"><a href="#FileInfoQuery类" class="headerlink" title="FileInfoQuery类"></a>FileInfoQuery类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.query;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件信息参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 13:59</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileInfoQuery</span> <span class="keyword">extends</span> <span class="title">BaseParam</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileIdFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userIdFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * md5值，第一次上传记录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileMd5;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileMd5Fuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 父级ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String filePid;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String filePidFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long fileSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileNameFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileCover;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileCoverFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String filePath;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String filePathFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String createTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String createTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String createTimeEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String lastUpdateTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastUpdateTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastUpdateTimeEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:文件 1:目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer folderType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1:视频 2:音频  3:图片 4:文档 5:其他</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileCategory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1:视频 2:音频  3:图片 4:pdf 5:doc 6:excel 7:txt 8:code 9:zip 10:其他</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:转码中 1转码失败 2:转码成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 回收站时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String recoveryTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String recoveryTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String recoveryTimeEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除标记 0:删除  1:回收站  2:正常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer delFlag;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件id集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] fileIdArray;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 父目录id集合</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] filePidArray;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排除掉的文件id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String[] excludeFileIdArray;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件是否过期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean queryExpire;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Boolean queryNickName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileId</span><span class="params">(String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileId = fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileIdFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileIdFuzzy</span><span class="params">(String fileIdFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileIdFuzzy = fileIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserIdFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserIdFuzzy</span><span class="params">(String userIdFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userIdFuzzy = userIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileMd5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileMd5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileMd5</span><span class="params">(String fileMd5)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileMd5 = fileMd5;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileMd5Fuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileMd5Fuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileMd5Fuzzy</span><span class="params">(String fileMd5Fuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileMd5Fuzzy = fileMd5Fuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilePid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filePid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePid</span><span class="params">(String filePid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePid = filePid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilePidFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filePidFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePidFuzzy</span><span class="params">(String filePidFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePidFuzzy = filePidFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getFileSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileSize</span><span class="params">(Long fileSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileSize = fileSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileNameFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileNameFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileNameFuzzy</span><span class="params">(String fileNameFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileNameFuzzy = fileNameFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileCover</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileCover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCover</span><span class="params">(String fileCover)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCover = fileCover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileCoverFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileCoverFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCoverFuzzy</span><span class="params">(String fileCoverFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCoverFuzzy = fileCoverFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilePath</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePath</span><span class="params">(String filePath)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePath = filePath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilePathFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filePathFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePathFuzzy</span><span class="params">(String filePathFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePathFuzzy = filePathFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCreateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTime</span><span class="params">(String createTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTime = createTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCreateTimeStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTimeStart</span><span class="params">(String createTimeStart)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTimeStart = createTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCreateTimeEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> createTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCreateTimeEnd</span><span class="params">(String createTimeEnd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.createTimeEnd = createTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastUpdateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lastUpdateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastUpdateTime</span><span class="params">(String lastUpdateTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastUpdateTime = lastUpdateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastUpdateTimeStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lastUpdateTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastUpdateTimeStart</span><span class="params">(String lastUpdateTimeStart)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastUpdateTimeStart = lastUpdateTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastUpdateTimeEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lastUpdateTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastUpdateTimeEnd</span><span class="params">(String lastUpdateTimeEnd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastUpdateTimeEnd = lastUpdateTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFolderType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> folderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFolderType</span><span class="params">(Integer folderType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.folderType = folderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFileCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileCategory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCategory</span><span class="params">(Integer fileCategory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCategory = fileCategory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFileType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileType</span><span class="params">(Integer fileType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileType = fileType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRecoveryTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> recoveryTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRecoveryTime</span><span class="params">(String recoveryTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.recoveryTime = recoveryTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRecoveryTimeStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> recoveryTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRecoveryTimeStart</span><span class="params">(String recoveryTimeStart)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.recoveryTimeStart = recoveryTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getRecoveryTimeEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> recoveryTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRecoveryTimeEnd</span><span class="params">(String recoveryTimeEnd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.recoveryTimeEnd = recoveryTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getDelFlag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> delFlag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDelFlag</span><span class="params">(Integer delFlag)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.delFlag = delFlag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getFileIdArray() &#123;</span><br><span class="line">        <span class="keyword">return</span> fileIdArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileIdArray</span><span class="params">(String[] fileIdArray)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileIdArray = fileIdArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getFilePidArray() &#123;</span><br><span class="line">        <span class="keyword">return</span> filePidArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePidArray</span><span class="params">(String[] filePidArray)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePidArray = filePidArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String[] getExcludeFileIdArray() &#123;</span><br><span class="line">        <span class="keyword">return</span> excludeFileIdArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExcludeFileIdArray</span><span class="params">(String[] excludeFileIdArray)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.excludeFileIdArray = excludeFileIdArray;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getQueryExpire</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> queryExpire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQueryExpire</span><span class="params">(Boolean queryExpire)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.queryExpire = queryExpire;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getQueryNickName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> queryNickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQueryNickName</span><span class="params">(Boolean queryNickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.queryNickName = queryNickName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileShareQuery类"><a href="#FileShareQuery类" class="headerlink" title="FileShareQuery类"></a>FileShareQuery类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.query;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分享信息参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-01 19:50</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileShareQuery</span> <span class="keyword">extends</span> <span class="title">BaseParam</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String shareId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String shareIdFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String fileIdFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userIdFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 有效期类型 0:1天 1:7天 2:30天 3:永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer validType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失效时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String expireTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String expireTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String expireTimeEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String shareTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String shareTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String shareTimeEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提取码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String code;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String codeFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 浏览次数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer showCount;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否查询文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean queryFileName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getQueryFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> queryFileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQueryFileName</span><span class="params">(Boolean queryFileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.queryFileName = queryFileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareId</span><span class="params">(String shareId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareId = shareId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getShareId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.shareId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareIdFuzzy</span><span class="params">(String shareIdFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareIdFuzzy = shareIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getShareIdFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.shareIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileId</span><span class="params">(String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileId = fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileIdFuzzy</span><span class="params">(String fileIdFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileIdFuzzy = fileIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileIdFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserIdFuzzy</span><span class="params">(String userIdFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userIdFuzzy = userIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserIdFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValidType</span><span class="params">(Integer validType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.validType = validType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getValidType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.validType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExpireTime</span><span class="params">(String expireTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.expireTime = expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getExpireTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExpireTimeStart</span><span class="params">(String expireTimeStart)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.expireTimeStart = expireTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getExpireTimeStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.expireTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExpireTimeEnd</span><span class="params">(String expireTimeEnd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.expireTimeEnd = expireTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getExpireTimeEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.expireTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareTime</span><span class="params">(String shareTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareTime = shareTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getShareTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.shareTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareTimeStart</span><span class="params">(String shareTimeStart)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareTimeStart = shareTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getShareTimeStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.shareTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareTimeEnd</span><span class="params">(String shareTimeEnd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareTimeEnd = shareTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getShareTimeEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.shareTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCodeFuzzy</span><span class="params">(String codeFuzzy)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.codeFuzzy = codeFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCodeFuzzy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.codeFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShowCount</span><span class="params">(Integer showCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.showCount = showCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getShowCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.showCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="SimplePage类"><a href="#SimplePage类" class="headerlink" title="SimplePage类"></a>SimplePage类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.query;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.PageSize;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 简单分页类，用于封装分页相关的信息</span></span><br><span class="line"><span class="comment"> * 包含当前页码，总记录数，每页显示的记录数，总页数，开始记录索引，结束记录索引等属性</span></span><br><span class="line"><span class="comment"> * 提供了无参构造方法和有参构造方法，以及相应的getter和setter方法</span></span><br><span class="line"><span class="comment"> * 还提供了一个action()方法，用于根据当前页码、总记录数和每页显示的记录数计算出总页数、开始记录索引和结束记录索引，并进行一些边界检查和修正</span></span><br><span class="line"><span class="comment"> * 可以根据这些信息来进行分页查询和返回结果集合</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimplePage</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当前页码，从1开始</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageNo;</span><br><span class="line">    <span class="comment">//总记录数，从数据库查询得到</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> countTotal;</span><br><span class="line">    <span class="comment">//每页显示的记录数，由用户指定或使用默认值</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageSize;</span><br><span class="line">    <span class="comment">//总页数，根据总记录数和每页显示的记录数计算得到</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> pageTotal;</span><br><span class="line">    <span class="comment">//开始记录索引，根据当前页码和每页显示的记录数计算得到</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> start;</span><br><span class="line">    <span class="comment">//结束记录索引，根据当前页码和每页显示的记录数计算得到</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> end;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimplePage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimplePage</span><span class="params">(Integer pageNo, <span class="keyword">int</span> countTotal, <span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pageNo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            pageNo = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.pageNo = pageNo;</span><br><span class="line">        <span class="keyword">this</span>.countTotal = countTotal;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = pageSize;</span><br><span class="line">        action();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SimplePage</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">action</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.pageSize &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.pageSize = PageSize.SIZE20.getSize();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.countTotal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.pageTotal = <span class="keyword">this</span>.countTotal % <span class="keyword">this</span>.pageSize == <span class="number">0</span> ? <span class="keyword">this</span>.countTotal / <span class="keyword">this</span>.pageSize</span><br><span class="line">                    : <span class="keyword">this</span>.countTotal / <span class="keyword">this</span>.pageSize + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pageTotal = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (pageNo &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">            pageNo = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pageNo &gt; pageTotal) &#123;</span><br><span class="line">            pageNo = pageTotal;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.start = (pageNo - <span class="number">1</span>) * pageSize;</span><br><span class="line">        <span class="keyword">this</span>.end = <span class="keyword">this</span>.pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getStart</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getEnd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPageTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageTotal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPageNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageNo</span><span class="params">(<span class="keyword">int</span> pageNo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageNo = pageNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageTotal</span><span class="params">(<span class="keyword">int</span> pageTotal)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageTotal = pageTotal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCountTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> countTotal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getPageSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStart</span><span class="params">(<span class="keyword">int</span> start)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.start = start;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEnd</span><span class="params">(<span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.end = end;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCountTotal</span><span class="params">(<span class="keyword">int</span> countTotal)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.countTotal = countTotal;</span><br><span class="line">        <span class="keyword">this</span>.action();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageSize</span><span class="params">(<span class="keyword">int</span> pageSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = pageSize;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="UserInfoQuery类"><a href="#UserInfoQuery类" class="headerlink" title="UserInfoQuery类"></a>UserInfoQuery类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.query;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:21</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoQuery</span> <span class="keyword">extends</span> <span class="title">BaseParam</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userIdFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String nickNameFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String emailFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String qqAvatar;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String qqAvatarFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String qqOpenId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String qqOpenIdFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String passwordFuzzy;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加入时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String joinTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String joinTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String joinTimeEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后登录时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String lastLoginTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastLoginTimeStart;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String lastLoginTimeEnd;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:禁用 1:正常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long useSpace;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long totalSpace;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserIdFuzzy</span><span class="params">(String userIdFuzzy)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userIdFuzzy = userIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserIdFuzzy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickName</span><span class="params">(String nickName)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickName = nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickNameFuzzy</span><span class="params">(String nickNameFuzzy)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickNameFuzzy = nickNameFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickNameFuzzy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.nickNameFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmailFuzzy</span><span class="params">(String emailFuzzy)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.emailFuzzy = emailFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmailFuzzy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.emailFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQqAvatar</span><span class="params">(String qqAvatar)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.qqAvatar = qqAvatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqAvatar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.qqAvatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQqAvatarFuzzy</span><span class="params">(String qqAvatarFuzzy)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.qqAvatarFuzzy = qqAvatarFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqAvatarFuzzy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.qqAvatarFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQqOpenId</span><span class="params">(String qqOpenId)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.qqOpenId = qqOpenId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqOpenId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.qqOpenId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQqOpenIdFuzzy</span><span class="params">(String qqOpenIdFuzzy)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.qqOpenIdFuzzy = qqOpenIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqOpenIdFuzzy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.qqOpenIdFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPasswordFuzzy</span><span class="params">(String passwordFuzzy)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.passwordFuzzy = passwordFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPasswordFuzzy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.passwordFuzzy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJoinTime</span><span class="params">(String joinTime)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.joinTime = joinTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getJoinTime</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.joinTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJoinTimeStart</span><span class="params">(String joinTimeStart)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.joinTimeStart = joinTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getJoinTimeStart</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.joinTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJoinTimeEnd</span><span class="params">(String joinTimeEnd)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.joinTimeEnd = joinTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getJoinTimeEnd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.joinTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastLoginTime</span><span class="params">(String lastLoginTime)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastLoginTime = lastLoginTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastLoginTime</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.lastLoginTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastLoginTimeStart</span><span class="params">(String lastLoginTimeStart)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastLoginTimeStart = lastLoginTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastLoginTimeStart</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.lastLoginTimeStart;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastLoginTimeEnd</span><span class="params">(String lastLoginTimeEnd)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastLoginTimeEnd = lastLoginTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastLoginTimeEnd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.lastLoginTimeEnd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUseSpace</span><span class="params">(Long useSpace)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.useSpace = useSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getUseSpace</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.useSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalSpace</span><span class="params">(Long totalSpace)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalSpace = totalSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getTotalSpace</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.totalSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vo包"><a href="#vo包" class="headerlink" title="vo包"></a>vo包</h3><h4 id="FileInfoVO类"><a href="#FileInfoVO类" class="headerlink" title="FileInfoVO类"></a>FileInfoVO类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 10:17</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileInfoVO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 父级ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String filePid;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long fileSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件名称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 封面</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileCover;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后更新时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date lastUpdateTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:文件 1:目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer folderType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1:视频 2:音频  3:图片 4:文档 5:其他</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileCategory;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1:视频 2:音频  3:图片 4:pdf 5:doc 6:excel 7:txt 8:code 9:zip 10:其他</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer fileType;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:转码中 1转码失败 2:转码成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileId</span><span class="params">(String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileId = fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFilePid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filePid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFilePid</span><span class="params">(String filePid)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.filePid = filePid;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getFileSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileSize</span><span class="params">(Long fileSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileSize = fileSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileCover</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileCover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCover</span><span class="params">(String fileCover)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCover = fileCover;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getLastUpdateTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lastUpdateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastUpdateTime</span><span class="params">(Date lastUpdateTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastUpdateTime = lastUpdateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFolderType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> folderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFolderType</span><span class="params">(Integer folderType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.folderType = folderType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFileCategory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileCategory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileCategory</span><span class="params">(Integer fileCategory)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileCategory = fileCategory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getFileType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileType</span><span class="params">(Integer fileType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileType = fileType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="PaginationResultVO类"><a href="#PaginationResultVO类" class="headerlink" title="PaginationResultVO类"></a>PaginationResultVO类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分页结果类</span></span><br><span class="line"><span class="comment"> * 封装了分页查询的相关信息，如总记录数，每页大小，当前页码，总页数，数据列表等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 21:07</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PaginationResultVO</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer totalCount;</span><br><span class="line">    <span class="keyword">private</span> Integer pageSize;</span><br><span class="line">    <span class="keyword">private</span> Integer pageNo;</span><br><span class="line">    <span class="keyword">private</span> Integer pageTotal;</span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PaginationResultVO</span><span class="params">(Integer totalCount, Integer pageSize, Integer pageNo, List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalCount = totalCount;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = pageSize;</span><br><span class="line">        <span class="keyword">this</span>.pageNo = pageNo;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PaginationResultVO</span><span class="params">(Integer totalCount, Integer pageSize, Integer pageNo, Integer pageTotal, List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pageNo == <span class="number">0</span>) &#123;</span><br><span class="line">            pageNo = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.totalCount = totalCount;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = pageSize;</span><br><span class="line">        <span class="keyword">this</span>.pageNo = pageNo;</span><br><span class="line">        <span class="keyword">this</span>.pageTotal = pageTotal;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PaginationResultVO</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PaginationResultVO</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getTotalCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalCount</span><span class="params">(Integer totalCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalCount = totalCount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getPageSize</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageSize</span><span class="params">(Integer pageSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageSize = pageSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getPageNo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageNo</span><span class="params">(Integer pageNo)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageNo = pageNo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;T&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;T&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getPageTotal</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> pageTotal;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPageTotal</span><span class="params">(Integer pageTotal)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.pageTotal = pageTotal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ResponseVO类"><a href="#ResponseVO类" class="headerlink" title="ResponseVO类"></a>ResponseVO类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.vo;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 响应数据类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-25 22:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseVO</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String status;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应编码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String info;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(String status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> info;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setInfo</span><span class="params">(String info)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.info = info;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="ShareInfoVO类"><a href="#ShareInfoVO类" class="headerlink" title="ShareInfoVO类"></a>ShareInfoVO类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件分享</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-03 10:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ShareInfoVO</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date shareTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失效时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date expireTime;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享人的昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享的文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 是否是当前用户</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Boolean currentUser;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String fileId;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 头像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String avatar;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享人id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAvatar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> avatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAvatar</span><span class="params">(String avatar)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.avatar = avatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileId</span><span class="params">(String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileId = fileId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getShareTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> shareTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setShareTime</span><span class="params">(Date shareTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.shareTime = shareTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getExpireTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExpireTime</span><span class="params">(Date expireTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.expireTime = expireTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickName</span><span class="params">(String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickName = nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getFileName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setFileName</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Boolean <span class="title">getCurrentUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> currentUser;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCurrentUser</span><span class="params">(Boolean currentUser)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.currentUser = currentUser;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="UserInfoVO类"><a href="#UserInfoVO类" class="headerlink" title="UserInfoVO类"></a>UserInfoVO类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.entity.vo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> org.springframework.format.annotation.DateTimeFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:12</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoVO</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户ID</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 昵称</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String nickName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 邮箱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq 头像</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String qqAvatar;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加入时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date joinTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最后登录时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@JsonFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;, timezone = &quot;GMT+8&quot;)</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd HH:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date lastLoginTime;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 0:禁用 1:正常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer status;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用空间单位byte</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long useSpace;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 总空间单位byte</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Long totalSpace;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUserId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.userId = userId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNickName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNickName</span><span class="params">(String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.nickName = nickName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getEmail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getQqAvatar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> qqAvatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setQqAvatar</span><span class="params">(String qqAvatar)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.qqAvatar = qqAvatar;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getJoinTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> joinTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJoinTime</span><span class="params">(Date joinTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.joinTime = joinTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">getLastLoginTime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> lastLoginTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLastLoginTime</span><span class="params">(Date lastLoginTime)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.lastLoginTime = lastLoginTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getStatus</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStatus</span><span class="params">(Integer status)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.status = status;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getUseSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> useSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUseSpace</span><span class="params">(Long useSpace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.useSpace = useSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getTotalSpace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> totalSpace;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotalSpace</span><span class="params">(Long totalSpace)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.totalSpace = totalSpace;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="exception包"><a href="#exception包" class="headerlink" title="exception包"></a>exception包</h2><h3 id="BusinessException类"><a href="#BusinessException类" class="headerlink" title="BusinessException类"></a>BusinessException类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.exception;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.ResponseCodeEnum;</span><br><span class="line"><span class="keyword">import</span> io.swagger.v3.oas.annotations.media.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 业务异常类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:39</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Schema(description = &quot;业务异常类&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BusinessException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;响应码枚举&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ResponseCodeEnum codeEnum;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;响应码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Schema(description = &quot;响应消息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BusinessException</span><span class="params">(String message, Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message, e);</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BusinessException</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BusinessException</span><span class="params">(Throwable e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BusinessException</span><span class="params">(ResponseCodeEnum codeEnum)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(codeEnum.getMsg());</span><br><span class="line">        <span class="keyword">this</span>.codeEnum = codeEnum;</span><br><span class="line">        <span class="keyword">this</span>.code = codeEnum.getCode();</span><br><span class="line">        <span class="keyword">this</span>.message = codeEnum.getMsg();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BusinessException</span><span class="params">(Integer code, String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(message);</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseCodeEnum <span class="title">getCodeEnum</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> codeEnum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重写fillInStackTrace 业务异常不需要堆栈信息，提高效率.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Throwable <span class="title">fillInStackTrace</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="mappers包"><a href="#mappers包" class="headerlink" title="mappers包"></a>mappers包</h2><h3 id="BaseMapper"><a href="#BaseMapper" class="headerlink" title="BaseMapper"></a>BaseMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.mappers;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; </span>&#123;</span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * insert:(插入). &lt;br/&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Integer <span class="title">insert</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * insertOrUpdate:(插入或者更新). &lt;br/&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Integer <span class="title">insertOrUpdate</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * insertBatch:(批量插入). &lt;br/&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Integer <span class="title">insertBatch</span><span class="params">(<span class="meta">@Param(&quot;list&quot;)</span> List&lt;T&gt; list)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * insertOrUpdateBatch:(批量插入或更新). &lt;br/&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Integer <span class="title">insertOrUpdateBatch</span><span class="params">(<span class="meta">@Param(&quot;list&quot;)</span> List&lt;T&gt; list)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * selectList:(根据参数查询集合). &lt;br/&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">selectList</span><span class="params">(<span class="meta">@Param(&quot;query&quot;)</span> P p)</span></span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * selectCount:(根据集合查询数量). &lt;br/&gt;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="function">Integer <span class="title">selectCount</span><span class="params">(<span class="meta">@Param(&quot;query&quot;)</span> P p)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="EmailCodeMapper"><a href="#EmailCodeMapper" class="headerlink" title="EmailCodeMapper"></a>EmailCodeMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 邮箱验证码 数据库操作接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmailCodeMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据EmailAndCode更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateByEmailAndCode</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t, <span class="meta">@Param(&quot;email&quot;)</span> String email, <span class="meta">@Param(&quot;code&quot;)</span> String code)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据EmailAndCode删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteByEmailAndCode</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email, <span class="meta">@Param(&quot;code&quot;)</span> String code)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据EmailAndCode获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">selectByEmailAndCode</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email, <span class="meta">@Param(&quot;code&quot;)</span> String code)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重置邮箱验证码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> email</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">disableEmailCode</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="FileInfoMapper"><a href="#FileInfoMapper" class="headerlink" title="FileInfoMapper"></a>FileInfoMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 文件信息 数据库操作接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FileInfoMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateByFileIdAndUserId</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t, <span class="meta">@Param(&quot;fileId&quot;)</span> String fileId, <span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteByFileIdAndUserId</span><span class="params">(<span class="meta">@Param(&quot;fileId&quot;)</span> String fileId, <span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">selectByFileIdAndUserId</span><span class="params">(<span class="meta">@Param(&quot;fileId&quot;)</span> String fileId, <span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取用户已使用空间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Long <span class="title">selectUseSpace</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateFileStatusWithOldStatus</span><span class="params">(<span class="meta">@Param(&quot;fileId&quot;)</span> String fileId, <span class="meta">@Param(&quot;userId&quot;)</span> String userId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       <span class="meta">@Param(&quot;bean&quot;)</span> T t, <span class="meta">@Param(&quot;oldStatus&quot;)</span> Integer oldStatus)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量更新文件状态（删除/回收状态）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">batchUpdateFileDelFlag</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> FileInfo fileInfo, <span class="meta">@Param(&quot;userId&quot;)</span> String userId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="meta">@Param(&quot;filePidList&quot;)</span> List&lt;String&gt; filePidList,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="meta">@Param(&quot;fileIdList&quot;)</span> List&lt;String&gt; fileIdList,</span></span></span><br><span class="line"><span class="function"><span class="params">                                <span class="meta">@Param(&quot;oldDelFlag&quot;)</span> Integer oldDelFlag)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">batchDelFile</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> String userId, <span class="meta">@Param(&quot;filePidList&quot;)</span> List&lt;String&gt; filePidList,</span></span></span><br><span class="line"><span class="function"><span class="params">                      <span class="meta">@Param(&quot;fileIdList&quot;)</span> List&lt;String&gt; fileIdList, <span class="meta">@Param(&quot;oldDelFlag&quot;)</span> Integer oldDelFlag)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteFileByUserId</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span>String userId)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="FileShareMapper"><a href="#FileShareMapper" class="headerlink" title="FileShareMapper"></a>FileShareMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-01 20:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FileShareMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateByShareId</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t, <span class="meta">@Param(&quot;shareId&quot;)</span> String shareId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteByShareId</span><span class="params">(<span class="meta">@Param(&quot;shareId&quot;)</span> String shareId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">selectByShareId</span><span class="params">(<span class="meta">@Param(&quot;shareId&quot;)</span> String shareId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">batchDeleteFileShare</span><span class="params">(<span class="meta">@Param(&quot;shareIdList&quot;)</span> List&lt;String&gt; shareIdList, <span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新浏览次数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateShareShowCount</span><span class="params">(<span class="meta">@Param(&quot;shareId&quot;)</span> String shareId)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="UserInfoMapper"><a href="#UserInfoMapper" class="headerlink" title="UserInfoMapper"></a>UserInfoMapper</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.mappers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.annotations.Param;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用户信息 数据库操作接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserInfoMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span>, <span class="title">P</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateByUserId</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t, <span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteByUserId</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">selectByUserId</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateByEmail</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t, <span class="meta">@Param(&quot;email&quot;)</span> String email)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteByEmail</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">selectByEmail</span><span class="params">(<span class="meta">@Param(&quot;email&quot;)</span> String email)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateByNickName</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t, <span class="meta">@Param(&quot;nickName&quot;)</span> String nickName)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteByNickName</span><span class="params">(<span class="meta">@Param(&quot;nickName&quot;)</span> String nickName)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">selectByNickName</span><span class="params">(<span class="meta">@Param(&quot;nickName&quot;)</span> String nickName)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId更新</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateByQqOpenId</span><span class="params">(<span class="meta">@Param(&quot;bean&quot;)</span> T t, <span class="meta">@Param(&quot;qqOpenId&quot;)</span> String qqOpenId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteByQqOpenId</span><span class="params">(<span class="meta">@Param(&quot;qqOpenId&quot;)</span> String qqOpenId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">T <span class="title">selectByQqOpenId</span><span class="params">(<span class="meta">@Param(&quot;qqOpenId&quot;)</span> String qqOpenId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新用户使用空间或者总空间大小</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateUserSpace</span><span class="params">(<span class="meta">@Param(&quot;userId&quot;)</span> String userId, <span class="meta">@Param(&quot;useSpace&quot;)</span> Long useSpace, <span class="meta">@Param(&quot;totalSpace&quot;)</span> Long totalSpace)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="service包"><a href="#service包" class="headerlink" title="service包"></a>service包</h2><h3 id="impl包"><a href="#impl包" class="headerlink" title="impl包"></a>impl包</h3><h4 id="EmailCodeServiceImpl类"><a href="#EmailCodeServiceImpl类" class="headerlink" title="EmailCodeServiceImpl类"></a>EmailCodeServiceImpl类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br></pre></td><td class="code"><pre><span class="line">package com.xcshare.service.impl;</span><br><span class="line"></span><br><span class="line">import com.xcshare.component.RedisComponent;</span><br><span class="line">import com.xcshare.entity.config.AppConfig;</span><br><span class="line">import com.xcshare.entity.constants.Constants;</span><br><span class="line">import com.xcshare.entity.dto.SysSettingsDto;</span><br><span class="line">import com.xcshare.entity.enums.PageSize;</span><br><span class="line">import com.xcshare.entity.po.EmailCode;</span><br><span class="line">import com.xcshare.entity.po.UserInfo;</span><br><span class="line">import com.xcshare.entity.query.EmailCodeQuery;</span><br><span class="line">import com.xcshare.entity.query.SimplePage;</span><br><span class="line">import com.xcshare.entity.query.UserInfoQuery;</span><br><span class="line">import com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line">import com.xcshare.exception.BusinessException;</span><br><span class="line">import com.xcshare.mappers.EmailCodeMapper;</span><br><span class="line">import com.xcshare.mappers.UserInfoMapper;</span><br><span class="line">import com.xcshare.service.EmailCodeService;</span><br><span class="line">import com.xcshare.utils.StringTools;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line">import org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line">import javax.annotation.Resource;</span><br><span class="line">import javax.mail.internet.MimeMessage;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line"> * @author xingchen</span><br><span class="line"> * @description</span><br><span class="line"> * @create 2023-05-26 22:35</span><br><span class="line"> *&#x2F;</span><br><span class="line">@Service(&quot;emailCodeService&quot;)</span><br><span class="line">public class EmailCodeServiceImpl implements EmailCodeService &#123;</span><br><span class="line"></span><br><span class="line">    private static final Logger logger &#x3D; LoggerFactory.getLogger(EmailCodeServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private EmailCodeMapper&lt;EmailCode, EmailCodeQuery&gt; emailCodeMapper;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private UserInfoMapper&lt;UserInfo, UserInfoQuery&gt; userInfoMapper;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private JavaMailSender javaMailSender;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">    @Resource</span><br><span class="line">    private RedisComponent redisComponent;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据条件查询列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;EmailCode&gt; findListByParam(EmailCodeQuery param) &#123;</span><br><span class="line">        return this.emailCodeMapper.selectList(param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据条件查询列表</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public Integer findCountByParam(EmailCodeQuery param) &#123;</span><br><span class="line">        return this.emailCodeMapper.selectCount(param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 分页查询方法</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public PaginationResultVO&lt;EmailCode&gt; findListByPage(EmailCodeQuery param) &#123;</span><br><span class="line">        int count &#x3D; this.findCountByParam(param);</span><br><span class="line">        int pageSize &#x3D; param.getPageSize() &#x3D;&#x3D; null ? PageSize.SIZE15.getSize() : param.getPageSize();</span><br><span class="line"></span><br><span class="line">        SimplePage page &#x3D; new SimplePage(param.getPageNo(), count, pageSize);</span><br><span class="line">        param.setSimplePage(page);</span><br><span class="line">        List&lt;EmailCode&gt; list &#x3D; this.findListByParam(param);</span><br><span class="line">        PaginationResultVO&lt;EmailCode&gt; result &#x3D; new PaginationResultVO(count, page.getPageSize(),</span><br><span class="line">                page.getPageNo(), page.getPageTotal(), list);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 新增</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public Integer add(EmailCode bean) &#123;</span><br><span class="line">        return this.emailCodeMapper.insert(bean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 批量新增</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public Integer addBatch(List&lt;EmailCode&gt; listBean) &#123;</span><br><span class="line">        if (listBean &#x3D;&#x3D; null || listBean.isEmpty()) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        return this.emailCodeMapper.insertBatch(listBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 批量新增或者修改</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public Integer addOrUpdateBatch(List&lt;EmailCode&gt; listBean) &#123;</span><br><span class="line">        if (listBean &#x3D;&#x3D; null || listBean.isEmpty()) &#123;</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">        return this.emailCodeMapper.insertOrUpdateBatch(listBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据EmailAndCode获取对象</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public EmailCode getEmailCodeByEmailAndCode(String email, String code) &#123;</span><br><span class="line">        return this.emailCodeMapper.selectByEmailAndCode(email, code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据EmailAndCode修改</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public Integer updateEmailCodeByEmailAndCode(EmailCode bean, String email, String code) &#123;</span><br><span class="line">        return this.emailCodeMapper.updateByEmailAndCode(bean, email, code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据EmailAndCode删除</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    public Integer deleteEmailCodeByEmailAndCode(String email, String code) &#123;</span><br><span class="line">        return this.emailCodeMapper.deleteByEmailAndCode(email, code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 根据邮箱地址和验证码类型发送邮件验证码</span><br><span class="line">     *</span><br><span class="line">     * @param toEmail 邮箱地址，用于接收验证码</span><br><span class="line">     * @param type    验证码类型，0表示登录验证码，1表示邮箱验证码</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @Override</span><br><span class="line">    @Transactional(rollbackFor &#x3D; Exception.class)</span><br><span class="line">    public void sendEmailCode(String toEmail, Integer type) &#123;</span><br><span class="line">        &#x2F;&#x2F;如果是注册，校验邮箱是否已存在</span><br><span class="line">        if (Constants.ZERO.equals(type)) &#123;</span><br><span class="line">            UserInfo userInfo &#x3D; userInfoMapper.selectByEmail(toEmail);</span><br><span class="line">            if (null !&#x3D; userInfo) &#123;</span><br><span class="line">                throw new BusinessException(&quot;邮箱已经存在&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String code &#x3D; StringTools.getRandomNumber(Constants.LENGTH_5);</span><br><span class="line">        sendEmailCode(toEmail, code);</span><br><span class="line"></span><br><span class="line">        &#x2F;&#x2F;将之前的验证码置为无效</span><br><span class="line">        emailCodeMapper.disableEmailCode(toEmail);</span><br><span class="line">        EmailCode emailCode &#x3D; new EmailCode();</span><br><span class="line">        emailCode.setCode(code);</span><br><span class="line">        emailCode.setEmail(toEmail);</span><br><span class="line">        emailCode.setStatus(Constants.ZERO);</span><br><span class="line">        emailCode.setCreateTime(new Date());</span><br><span class="line">        emailCodeMapper.insert(emailCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 发送邮件验证码到指定邮箱</span><br><span class="line">     *</span><br><span class="line">     * @param toEmail 目标邮箱地址</span><br><span class="line">     * @param code    验证码，由5位数字组成</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private void sendEmailCode(String toEmail, String code) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            MimeMessage message &#x3D; javaMailSender.createMimeMessage();</span><br><span class="line">            MimeMessageHelper helper &#x3D; new MimeMessageHelper(message, true);</span><br><span class="line">            &#x2F;&#x2F;邮件发件人</span><br><span class="line">            helper.setFrom(appConfig.getSendUserName());</span><br><span class="line">            &#x2F;&#x2F;邮件收件人 1或多个</span><br><span class="line">            helper.setTo(toEmail);</span><br><span class="line"></span><br><span class="line">            SysSettingsDto sysSettingsDto &#x3D; redisComponent.getSysSettingsDto();</span><br><span class="line"></span><br><span class="line">            &#x2F;&#x2F;邮件主题</span><br><span class="line">            helper.setSubject(sysSettingsDto.getRegisterEmailTitle());</span><br><span class="line">            &#x2F;&#x2F;邮件内容</span><br><span class="line">            helper.setText(String.format(sysSettingsDto.getRegisterEmailContent(), code));</span><br><span class="line">            &#x2F;&#x2F;邮件发送时间</span><br><span class="line">            helper.setSentDate(new Date());</span><br><span class="line">            javaMailSender.send(message);</span><br><span class="line"></span><br><span class="line">        &#125; catch (Exception ex) &#123;</span><br><span class="line">            logger.error(&quot;邮件发送失败&quot;, ex);</span><br><span class="line">            throw new BusinessException(&quot;邮件发送失败&quot;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void checkCode(String email, String code) &#123;</span><br><span class="line">        EmailCode emailCode &#x3D; emailCodeMapper.selectByEmailAndCode(email, code);</span><br><span class="line">        if (emailCode &#x3D;&#x3D; null) &#123;</span><br><span class="line">            throw new BusinessException(&quot;邮箱验证码不正确&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if (emailCode.getStatus() &#x3D;&#x3D; 1 || System.currentTimeMillis() - emailCode.getCreateTime().getTime() &gt; Constants.LENGTH_15 * 1000 * 60) &#123;</span><br><span class="line">            throw new BusinessException(&quot;邮箱验证码已失效&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        emailCodeMapper.disableEmailCode(email);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileInfoServiceImpl类"><a href="#FileInfoServiceImpl类" class="headerlink" title="FileInfoServiceImpl类"></a>FileInfoServiceImpl类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br><span class="line">756</span><br><span class="line">757</span><br><span class="line">758</span><br><span class="line">759</span><br><span class="line">760</span><br><span class="line">761</span><br><span class="line">762</span><br><span class="line">763</span><br><span class="line">764</span><br><span class="line">765</span><br><span class="line">766</span><br><span class="line">767</span><br><span class="line">768</span><br><span class="line">769</span><br><span class="line">770</span><br><span class="line">771</span><br><span class="line">772</span><br><span class="line">773</span><br><span class="line">774</span><br><span class="line">775</span><br><span class="line">776</span><br><span class="line">777</span><br><span class="line">778</span><br><span class="line">779</span><br><span class="line">780</span><br><span class="line">781</span><br><span class="line">782</span><br><span class="line">783</span><br><span class="line">784</span><br><span class="line">785</span><br><span class="line">786</span><br><span class="line">787</span><br><span class="line">788</span><br><span class="line">789</span><br><span class="line">790</span><br><span class="line">791</span><br><span class="line">792</span><br><span class="line">793</span><br><span class="line">794</span><br><span class="line">795</span><br><span class="line">796</span><br><span class="line">797</span><br><span class="line">798</span><br><span class="line">799</span><br><span class="line">800</span><br><span class="line">801</span><br><span class="line">802</span><br><span class="line">803</span><br><span class="line">804</span><br><span class="line">805</span><br><span class="line">806</span><br><span class="line">807</span><br><span class="line">808</span><br><span class="line">809</span><br><span class="line">810</span><br><span class="line">811</span><br><span class="line">812</span><br><span class="line">813</span><br><span class="line">814</span><br><span class="line">815</span><br><span class="line">816</span><br><span class="line">817</span><br><span class="line">818</span><br><span class="line">819</span><br><span class="line">820</span><br><span class="line">821</span><br><span class="line">822</span><br><span class="line">823</span><br><span class="line">824</span><br><span class="line">825</span><br><span class="line">826</span><br><span class="line">827</span><br><span class="line">828</span><br><span class="line">829</span><br><span class="line">830</span><br><span class="line">831</span><br><span class="line">832</span><br><span class="line">833</span><br><span class="line">834</span><br><span class="line">835</span><br><span class="line">836</span><br><span class="line">837</span><br><span class="line">838</span><br><span class="line">839</span><br><span class="line">840</span><br><span class="line">841</span><br><span class="line">842</span><br><span class="line">843</span><br><span class="line">844</span><br><span class="line">845</span><br><span class="line">846</span><br><span class="line">847</span><br><span class="line">848</span><br><span class="line">849</span><br><span class="line">850</span><br><span class="line">851</span><br><span class="line">852</span><br><span class="line">853</span><br><span class="line">854</span><br><span class="line">855</span><br><span class="line">856</span><br><span class="line">857</span><br><span class="line">858</span><br><span class="line">859</span><br><span class="line">860</span><br><span class="line">861</span><br><span class="line">862</span><br><span class="line">863</span><br><span class="line">864</span><br><span class="line">865</span><br><span class="line">866</span><br><span class="line">867</span><br><span class="line">868</span><br><span class="line">869</span><br><span class="line">870</span><br><span class="line">871</span><br><span class="line">872</span><br><span class="line">873</span><br><span class="line">874</span><br><span class="line">875</span><br><span class="line">876</span><br><span class="line">877</span><br><span class="line">878</span><br><span class="line">879</span><br><span class="line">880</span><br><span class="line">881</span><br><span class="line">882</span><br><span class="line">883</span><br><span class="line">884</span><br><span class="line">885</span><br><span class="line">886</span><br><span class="line">887</span><br><span class="line">888</span><br><span class="line">889</span><br><span class="line">890</span><br><span class="line">891</span><br><span class="line">892</span><br><span class="line">893</span><br><span class="line">894</span><br><span class="line">895</span><br><span class="line">896</span><br><span class="line">897</span><br><span class="line">898</span><br><span class="line">899</span><br><span class="line">900</span><br><span class="line">901</span><br><span class="line">902</span><br><span class="line">903</span><br><span class="line">904</span><br><span class="line">905</span><br><span class="line">906</span><br><span class="line">907</span><br><span class="line">908</span><br><span class="line">909</span><br><span class="line">910</span><br><span class="line">911</span><br><span class="line">912</span><br><span class="line">913</span><br><span class="line">914</span><br><span class="line">915</span><br><span class="line">916</span><br><span class="line">917</span><br><span class="line">918</span><br><span class="line">919</span><br><span class="line">920</span><br><span class="line">921</span><br><span class="line">922</span><br><span class="line">923</span><br><span class="line">924</span><br><span class="line">925</span><br><span class="line">926</span><br><span class="line">927</span><br><span class="line">928</span><br><span class="line">929</span><br><span class="line">930</span><br><span class="line">931</span><br><span class="line">932</span><br><span class="line">933</span><br><span class="line">934</span><br><span class="line">935</span><br><span class="line">936</span><br><span class="line">937</span><br><span class="line">938</span><br><span class="line">939</span><br><span class="line">940</span><br><span class="line">941</span><br><span class="line">942</span><br><span class="line">943</span><br><span class="line">944</span><br><span class="line">945</span><br><span class="line">946</span><br><span class="line">947</span><br><span class="line">948</span><br><span class="line">949</span><br><span class="line">950</span><br><span class="line">951</span><br><span class="line">952</span><br><span class="line">953</span><br><span class="line">954</span><br><span class="line">955</span><br><span class="line">956</span><br><span class="line">957</span><br><span class="line">958</span><br><span class="line">959</span><br><span class="line">960</span><br><span class="line">961</span><br><span class="line">962</span><br><span class="line">963</span><br><span class="line">964</span><br><span class="line">965</span><br><span class="line">966</span><br><span class="line">967</span><br><span class="line">968</span><br><span class="line">969</span><br><span class="line">970</span><br><span class="line">971</span><br><span class="line">972</span><br><span class="line">973</span><br><span class="line">974</span><br><span class="line">975</span><br><span class="line">976</span><br><span class="line">977</span><br><span class="line">978</span><br><span class="line">979</span><br><span class="line">980</span><br><span class="line">981</span><br><span class="line">982</span><br><span class="line">983</span><br><span class="line">984</span><br><span class="line">985</span><br><span class="line">986</span><br><span class="line">987</span><br><span class="line">988</span><br><span class="line">989</span><br><span class="line">990</span><br><span class="line">991</span><br><span class="line">992</span><br><span class="line">993</span><br><span class="line">994</span><br><span class="line">995</span><br><span class="line">996</span><br><span class="line">997</span><br><span class="line">998</span><br><span class="line">999</span><br><span class="line">1000</span><br><span class="line">1001</span><br><span class="line">1002</span><br><span class="line">1003</span><br><span class="line">1004</span><br><span class="line">1005</span><br><span class="line">1006</span><br><span class="line">1007</span><br><span class="line">1008</span><br><span class="line">1009</span><br><span class="line">1010</span><br><span class="line">1011</span><br><span class="line">1012</span><br><span class="line">1013</span><br><span class="line">1014</span><br><span class="line">1015</span><br><span class="line">1016</span><br><span class="line">1017</span><br><span class="line">1018</span><br><span class="line">1019</span><br><span class="line">1020</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.component.RedisComponent;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.config.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.UploadResultDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.UserSpaceDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.*;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.SimplePage;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.UserInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.mappers.FileInfoMapper;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.mappers.UserInfoMapper;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileInfoService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.ProcessUtils;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.ScaleFilter;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Lazy;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.support.TransactionSynchronization;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.support.TransactionSynchronizationManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.RandomAccessFile;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件信息 业务接口实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 13:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;fileInfoService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileInfoServiceImpl</span> <span class="keyword">implements</span> <span class="title">FileInfoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(FileInfoServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="meta">@Lazy</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoServiceImpl fileInfoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoMapper&lt;FileInfo, FileInfoQuery&gt; fileInfoMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoMapper&lt;UserInfo, UserInfoQuery&gt; userInfoMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisComponent redisComponent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;FileInfo&gt; <span class="title">findListByParam</span><span class="params">(FileInfoQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileInfoMapper.selectList(param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">findCountByParam</span><span class="params">(FileInfoQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileInfoMapper.selectCount(param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationResultVO&lt;FileInfo&gt; <span class="title">findListByPage</span><span class="params">(FileInfoQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="keyword">this</span>.findCountByParam(param);</span><br><span class="line">        <span class="keyword">int</span> pageSize = param.getPageSize() == <span class="keyword">null</span> ? PageSize.SIZE15.getSize() : param.getPageSize();</span><br><span class="line"></span><br><span class="line">        SimplePage page = <span class="keyword">new</span> SimplePage(param.getPageNo(), count, pageSize);</span><br><span class="line">        param.setSimplePage(page);</span><br><span class="line">        List&lt;FileInfo&gt; list = <span class="keyword">this</span>.findListByParam(param);</span><br><span class="line">        PaginationResultVO&lt;FileInfo&gt; result = <span class="keyword">new</span> PaginationResultVO(count, page.getPageSize(),</span><br><span class="line">                page.getPageNo(), page.getPageTotal(), list);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">add</span><span class="params">(FileInfo bean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileInfoMapper.insert(bean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">addBatch</span><span class="params">(List&lt;FileInfo&gt; listBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (listBean == <span class="keyword">null</span> || listBean.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileInfoMapper.insertBatch(listBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增或者修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">addOrUpdateBatch</span><span class="params">(List&lt;FileInfo&gt; listBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (listBean == <span class="keyword">null</span> || listBean.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileInfoMapper.insertOrUpdateBatch(listBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FileInfo <span class="title">getFileInfoByFileIdAndUserId</span><span class="params">(String fileId, String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileInfoMapper.selectByFileIdAndUserId(fileId, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">updateFileInfoByFileIdAndUserId</span><span class="params">(FileInfo bean, String fileId, String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileInfoMapper.updateByFileIdAndUserId(bean, fileId, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteFileInfoByFileIdAndUserId</span><span class="params">(String fileId, String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileInfoMapper.deleteByFileIdAndUserId(fileId, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件分片上传</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> webUserDto 用户会话对象，包含用户的基本信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId     文件ID，如果为空则生成一个随机字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file       文件流对象，包含文件的内容和元数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName   文件名，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid    文件父id，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileMd5    文件MD5值，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chunkIndex 当前分片索引，从0开始，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> chunks     总分片数，大于0，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应对象，包含上传结果数据传输对象，包括文件ID和上传状态</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果出现业务异常，如网盘空间不足，文件上传失败等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UploadResultDto <span class="title">uploadFile</span><span class="params">(SessionWebUserDto webUserDto, String fileId, MultipartFile file,</span></span></span><br><span class="line"><span class="function"><span class="params">                                      String fileName, String filePid, String fileMd5, Integer chunkIndex, Integer chunks)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        UploadResultDto resultDto = <span class="keyword">new</span> UploadResultDto();</span><br><span class="line">        Boolean uploadSuccess = <span class="keyword">true</span>;</span><br><span class="line">        File tempFileFolder = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (StringTools.isEmpty(fileId)) &#123;</span><br><span class="line">                fileId = StringTools.getRandomString(Constants.LENGTH_10);</span><br><span class="line">                <span class="comment">//fileId = UUID.randomUUID().toString().replaceAll(&quot;-&quot;, &quot;&quot;);</span></span><br><span class="line">            &#125;</span><br><span class="line">            resultDto.setFileId(fileId);</span><br><span class="line">            Date curDate = <span class="keyword">new</span> Date();</span><br><span class="line">            UserSpaceDto spaceDto = redisComponent.getUserSpaceUse(webUserDto.getUserId());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (chunkIndex == <span class="number">0</span>) &#123;</span><br><span class="line">                FileInfoQuery infoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">                infoQuery.setFileMd5(fileMd5);</span><br><span class="line">                infoQuery.setSimplePage(<span class="keyword">new</span> SimplePage(<span class="number">0</span>, <span class="number">1</span>));</span><br><span class="line">                infoQuery.setStatus(FileStatusEnums.USING.getStatus());</span><br><span class="line">                List&lt;FileInfo&gt; dbFileList = <span class="keyword">this</span>.fileInfoMapper.selectList(infoQuery);</span><br><span class="line">                <span class="comment">//数据库已存在 秒传</span></span><br><span class="line">                <span class="keyword">if</span> (!dbFileList.isEmpty()) &#123;</span><br><span class="line">                    FileInfo dbFile = dbFileList.get(<span class="number">0</span>);</span><br><span class="line">                    <span class="comment">//判断文件大小</span></span><br><span class="line">                    <span class="keyword">if</span> (dbFile.getFileSize() + spaceDto.getUseSpace() &gt; spaceDto.getTotalSpace()) &#123;</span><br><span class="line">                        <span class="comment">//抛出提示 网盘空间不足</span></span><br><span class="line">                        <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_904);</span><br><span class="line">                    &#125;</span><br><span class="line">                    dbFile.setFileId(fileId);</span><br><span class="line">                    dbFile.setFilePid(filePid);</span><br><span class="line">                    dbFile.setUserId(webUserDto.getUserId());</span><br><span class="line">                    dbFile.setCreateTime(curDate);</span><br><span class="line">                    dbFile.setLastUpdateTime(curDate);</span><br><span class="line">                    dbFile.setStatus(FileStatusEnums.USING.getStatus());</span><br><span class="line">                    dbFile.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">                    dbFile.setFileMd5(fileMd5);</span><br><span class="line">                    <span class="comment">//文件重命名</span></span><br><span class="line">                    fileName = autoRename(filePid, webUserDto.getUserId(), fileName);</span><br><span class="line">                    dbFile.setFileName(fileName);</span><br><span class="line">                    <span class="keyword">this</span>.fileInfoMapper.insert(dbFile);</span><br><span class="line">                    resultDto.setStatus(UploadStatusEnums.UPLOAD_SECONDS.getCode());</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//更新用户使用空间</span></span><br><span class="line">                    updateUserSpace(webUserDto.getUserId(), dbFile.getFileSize());</span><br><span class="line">                    <span class="keyword">return</span> resultDto;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//判断磁盘空间</span></span><br><span class="line">            Long currentTempSize = redisComponent.getFileTempSize(webUserDto.getUserId(), fileId);</span><br><span class="line">            <span class="keyword">if</span> (file.getSize() + currentTempSize + spaceDto.getUseSpace() &gt; spaceDto.getTotalSpace()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_904);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//暂存临时目录</span></span><br><span class="line">            String tempFolderName = appConfig.getProjectFolder() + Constants.FILE_FOLDER_TEMP;</span><br><span class="line">            String currentUserFolderName = webUserDto.getUserId() + fileId;</span><br><span class="line"></span><br><span class="line">            tempFileFolder = <span class="keyword">new</span> File(tempFolderName, currentUserFolderName);</span><br><span class="line">            <span class="keyword">if</span> (!tempFileFolder.exists()) &#123;</span><br><span class="line">                tempFileFolder.mkdirs();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            File newFile = <span class="keyword">new</span> File(Paths.get(tempFileFolder.getPath(), String.valueOf(chunkIndex)).toString());</span><br><span class="line">            file.transferTo(newFile);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//保存临时大小</span></span><br><span class="line">            redisComponent.saveFileTempSize(webUserDto.getUserId(), fileId, file.getSize());</span><br><span class="line">            <span class="keyword">if</span> (chunkIndex &lt; chunks - <span class="number">1</span>) &#123;</span><br><span class="line">                resultDto.setStatus(UploadStatusEnums.UPLOADING.getCode());</span><br><span class="line">                <span class="keyword">return</span> resultDto;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//最后一个分片上传，记录到数据库，异步合并分片</span></span><br><span class="line">            String month = DateUtil.format(<span class="keyword">new</span> Date(), DateTimePatternEnum.YYYYMM.getPattern());</span><br><span class="line">            String fileSuffix = StringTools.getFileSuffix(fileName);</span><br><span class="line">            <span class="comment">//真实文件名</span></span><br><span class="line">            String realFileName = currentUserFolderName + fileSuffix;</span><br><span class="line">            FileTypeEnums fileTypeEnums = FileTypeEnums.getFileTypeBySuffix(fileSuffix);</span><br><span class="line">            <span class="comment">//自动重命名</span></span><br><span class="line">            fileName = autoRename(filePid, webUserDto.getUserId(), fileName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//region 数据库新增文件信息</span></span><br><span class="line">            FileInfo fileInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">            fileInfo.setFileId(fileId);</span><br><span class="line">            fileInfo.setUserId(webUserDto.getUserId());</span><br><span class="line">            fileInfo.setFileMd5(fileMd5);</span><br><span class="line">            fileInfo.setFileName(fileName);</span><br><span class="line">            fileInfo.setFilePath(Paths.get(month, realFileName).toString());</span><br><span class="line">            fileInfo.setFilePid(filePid);</span><br><span class="line">            fileInfo.setCreateTime(curDate);</span><br><span class="line">            fileInfo.setLastUpdateTime(curDate);</span><br><span class="line">            fileInfo.setFileCategory(fileTypeEnums.getCategory().getCategory());</span><br><span class="line">            fileInfo.setFileType(fileTypeEnums.getType());</span><br><span class="line">            fileInfo.setStatus(FileStatusEnums.TRANSFER.getStatus());</span><br><span class="line">            fileInfo.setFolderType(FileFolderTypeEnums.FILE.getType());</span><br><span class="line">            fileInfo.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">            <span class="keyword">this</span>.fileInfoMapper.insert(fileInfo);</span><br><span class="line">            <span class="comment">//endregion</span></span><br><span class="line"></span><br><span class="line">            Long totalSize = redisComponent.getFileTempSize(webUserDto.getUserId(), fileId);</span><br><span class="line">            updateUserSpace(webUserDto.getUserId(), totalSize);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//事务提交后在进行操作</span></span><br><span class="line">            TransactionSynchronizationManager.registerSynchronization(<span class="keyword">new</span> TransactionSynchronization() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCommit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    fileInfoService.transferFile(fileInfo.getFileId(), webUserDto);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line">            resultDto.setStatus(UploadStatusEnums.UPLOAD_FINISH.getCode());</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (BusinessException e) &#123;</span><br><span class="line">            uploadSuccess = <span class="keyword">false</span>;</span><br><span class="line">            logger.error(<span class="string">&quot;文件上传失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> e;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            uploadSuccess = <span class="keyword">false</span>;</span><br><span class="line">            logger.error(<span class="string">&quot;文件上传失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;文件上传失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!uploadSuccess &amp;&amp; tempFileFolder != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    FileUtils.deleteDirectory(tempFileFolder);</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;删除临时目录失败&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重命名文件（参照百度网盘的方式）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid  文件的父目录id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId   用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 重命名后的文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">autoRename</span><span class="params">(String filePid, String userId, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//TODO 待优化，数据库查询次数过多，存在性能问题</span></span><br><span class="line">        <span class="comment">//根据文件的父目录id，用户id和文件名，查询数据库中是否已经存在同名的文件</span></span><br><span class="line">        FileInfoQuery infoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        infoQuery.setFilePid(filePid);</span><br><span class="line">        infoQuery.setUserId(userId);</span><br><span class="line">        infoQuery.setFileName(fileName);</span><br><span class="line">        infoQuery.setStatus(FileStatusEnums.USING.getStatus());</span><br><span class="line">        List&lt;FileInfo&gt; dbFileList = <span class="keyword">this</span>.fileInfoMapper.selectList(infoQuery);</span><br><span class="line">        <span class="comment">//如果不存在同名的文件，就直接返回原来的文件名</span></span><br><span class="line">        <span class="keyword">if</span> (dbFileList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> fileName;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果存在同名的文件，就在原来的文件名后面加上一个数字，从1开始递增，直到找到一个不重复的文件名</span></span><br><span class="line">        <span class="keyword">int</span> index = <span class="number">1</span>;</span><br><span class="line">        String newName = fileName + <span class="string">&quot;(&quot;</span> + index + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            infoQuery.setFileName(newName);</span><br><span class="line">            dbFileList = <span class="keyword">this</span>.fileInfoMapper.selectList(infoQuery);</span><br><span class="line">            <span class="keyword">if</span> (dbFileList.isEmpty()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            index++;</span><br><span class="line">            newName = fileName + <span class="string">&quot;(&quot;</span> + index + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> newName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 更新用户空间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> totalSize</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateUserSpace</span><span class="params">(String userId, Long totalSize)</span> </span>&#123;</span><br><span class="line">        Integer count = userInfoMapper.updateUserSpace(userId, totalSize, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_904);</span><br><span class="line">        &#125;</span><br><span class="line">        UserSpaceDto spaceDto = redisComponent.getUserSpaceUse(userId);</span><br><span class="line">        spaceDto.setUseSpace(spaceDto.getUseSpace() + totalSize);</span><br><span class="line">        redisComponent.saveUserSpaceUse(userId, spaceDto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件转码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId     文件ID，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> webUserDto 用户会话对象，包含用户的基本信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">transferFile</span><span class="params">(String fileId, SessionWebUserDto webUserDto)</span> </span>&#123;</span><br><span class="line">        Boolean transferSuccess = <span class="keyword">true</span>;</span><br><span class="line">        String targetFilePath = <span class="keyword">null</span>;</span><br><span class="line">        String cover = <span class="keyword">null</span>;</span><br><span class="line">        FileTypeEnums fileTypeEnum = <span class="keyword">null</span>;</span><br><span class="line">        FileInfo fileInfo = fileInfoMapper.selectByFileIdAndUserId(fileId, webUserDto.getUserId());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (fileInfo == <span class="keyword">null</span> || !FileStatusEnums.TRANSFER.getStatus().equals(fileInfo.getStatus())) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//临时目录</span></span><br><span class="line">            String tempFolderName = appConfig.getProjectFolder() + Constants.FILE_FOLDER_TEMP;</span><br><span class="line">            String currentUserFolderName = webUserDto.getUserId() + fileId;</span><br><span class="line">            File fileFolder = <span class="keyword">new</span> File(tempFolderName, currentUserFolderName);</span><br><span class="line"></span><br><span class="line">            String fileSuffix = StringTools.getFileSuffix(fileInfo.getFileName());</span><br><span class="line">            String month = DateUtil.format(fileInfo.getCreateTime(), DateTimePatternEnum.YYYYMM.getPattern());</span><br><span class="line">            <span class="comment">//目标目录</span></span><br><span class="line">            String targetFolderName = appConfig.getProjectFolder() + Constants.FILE_FOLDER_FILE;</span><br><span class="line">            File targetFolder = <span class="keyword">new</span> File(Paths.get(targetFolderName, month).toString());</span><br><span class="line">            <span class="keyword">if</span> (!targetFolder.exists()) &#123;</span><br><span class="line">                targetFolder.mkdirs();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//真实的文件名</span></span><br><span class="line">            String realFileName = currentUserFolderName + fileSuffix;</span><br><span class="line">            targetFilePath = Paths.get(targetFolder.getPath(), realFileName).toString();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//合并文件</span></span><br><span class="line">            union(fileFolder.getPath(), targetFilePath, fileInfo.getFileName(), <span class="keyword">true</span>);</span><br><span class="line">            <span class="comment">//视频文件切割</span></span><br><span class="line">            fileTypeEnum = FileTypeEnums.getFileTypeBySuffix(fileSuffix);</span><br><span class="line">            <span class="keyword">if</span> (FileTypeEnums.VIDEO.equals(fileTypeEnum)) &#123;</span><br><span class="line">                cutFileToVideo(fileId, targetFilePath);</span><br><span class="line">                <span class="comment">//视频生成缩略图</span></span><br><span class="line">                cover = month + <span class="string">&quot;/&quot;</span> + currentUserFolderName + Constants.IMAGE_PNG_SUFFIX;</span><br><span class="line">                String coverPath = Paths.get(targetFolderName, cover).toString();</span><br><span class="line">                ScaleFilter.createCover4Video(<span class="keyword">new</span> File(targetFilePath), Constants.LENGTH_150, <span class="keyword">new</span> File(coverPath));</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (FileTypeEnums.IMAGE.equals(fileTypeEnum)) &#123;</span><br><span class="line">                <span class="comment">//生成缩略图</span></span><br><span class="line">                cover = month + <span class="string">&quot;/&quot;</span> + realFileName.replace(<span class="string">&quot;.&quot;</span>, <span class="string">&quot;_.&quot;</span>);</span><br><span class="line">                String coverPath = Paths.get(targetFolderName, cover).toString();</span><br><span class="line">                Boolean created = ScaleFilter.createThumbnailWidthFFmpeg(<span class="keyword">new</span> File(targetFilePath),</span><br><span class="line">                        Constants.LENGTH_150, <span class="keyword">new</span> File(coverPath), <span class="keyword">false</span>);</span><br><span class="line">                <span class="keyword">if</span> (!created) &#123;</span><br><span class="line">                    FileUtils.copyFile(<span class="keyword">new</span> File(targetFilePath), <span class="keyword">new</span> File(coverPath));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;文件转码失败,文件ID:&#123;&#125;,userId:&#123;&#125;&quot;</span>, fileId, webUserDto.getUserId(), ex);</span><br><span class="line">            transferSuccess = <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            FileInfo updateInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">            updateInfo.setFileSize(<span class="keyword">new</span> File(targetFilePath).length());</span><br><span class="line">            updateInfo.setFileCover(cover);</span><br><span class="line">            updateInfo.setStatus(transferSuccess ? FileStatusEnums.USING.getStatus() : FileStatusEnums.TRANSFER_FAIL.getStatus());</span><br><span class="line">            <span class="keyword">this</span>.fileInfoMapper.updateFileStatusWithOldStatus(fileId,</span><br><span class="line">                    webUserDto.getUserId(), updateInfo, FileStatusEnums.TRANSFER.getStatus());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件合并</span></span><br><span class="line"><span class="comment">     * 用于将分片的文件合并成一个完整的文件。根据分片的索引顺序，依次读取分片文件的内容，并写入到目标文件中</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dirPath    临时目录路径，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> toFilePath 目标文件路径，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName   文件名，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delSource  是否删除原目录，true为删除，false为不删除</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果出现业务异常，如目录不存在，合并分片失败等</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">union</span><span class="params">(String dirPath, String toFilePath, String fileName, <span class="keyword">boolean</span> delSource)</span> </span>&#123;</span><br><span class="line">        File dir = <span class="keyword">new</span> File(dirPath);</span><br><span class="line">        <span class="keyword">if</span> (!dir.exists()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;目录不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File[] fileList = dir.listFiles();</span><br><span class="line">        File targetFile = <span class="keyword">new</span> File(toFilePath);</span><br><span class="line">        RandomAccessFile writeFile = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            writeFile = <span class="keyword">new</span> RandomAccessFile(targetFile, <span class="string">&quot;rw&quot;</span>);</span><br><span class="line">            <span class="keyword">byte</span>[] b = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">10</span>];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; fileList.length; i++) &#123;</span><br><span class="line">                <span class="keyword">int</span> len = -<span class="number">1</span>;</span><br><span class="line">                File chunkFile = <span class="keyword">new</span> File(Paths.get(dirPath, String.valueOf(i)).toString());</span><br><span class="line">                RandomAccessFile readFile = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    readFile = <span class="keyword">new</span> RandomAccessFile(chunkFile, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">                    <span class="keyword">while</span> ((len = readFile.read(b)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                        writeFile.write(b, <span class="number">0</span>, len);</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;合并分片失败&quot;</span>, ex);</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;合并分片失败&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    readFile.close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;合并文件:&#123;&#125;失败&quot;</span>, fileName, ex);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;合并文件&quot;</span> + fileName + <span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (writeFile != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    writeFile.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (delSource &amp;&amp; dir.exists()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    FileUtils.deleteDirectory(dir);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">                    ex.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视频切割</span></span><br><span class="line"><span class="comment">     * 用于将视频文件切割成多个小片段，并生成一个索引文件。调用ffmpeg工具对视频进行切割，并指定每个片段的时间为30秒。</span></span><br><span class="line"><span class="comment">     * 生成一个同名的切片目录，用于存放切割后的片段和索引文件。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId        文件ID，不能为空</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoFilePath 视频文件路径，不能为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">cutFileToVideo</span><span class="params">(String fileId, String videoFilePath)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建同名切片目录</span></span><br><span class="line">        File tsFolder = <span class="keyword">new</span> File(videoFilePath.substring(<span class="number">0</span>, videoFilePath.lastIndexOf(<span class="string">&quot;.&quot;</span>)));</span><br><span class="line">        <span class="keyword">if</span> (!tsFolder.exists()) &#123;</span><br><span class="line">            tsFolder.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">final</span> String CMD_TRANSFER_2TS = <span class="string">&quot;ffmpeg -y -i %s  -vcodec copy -acodec copy -vbsf h264_mp4toannexb %s&quot;</span>;</span><br><span class="line">        <span class="keyword">final</span> String CMD_CUT_TS = <span class="string">&quot;ffmpeg -i %s -c copy -map 0 -f segment -segment_list %s -segment_time 30 %s/%s_%%4d.ts&quot;</span>;</span><br><span class="line"></span><br><span class="line">        String tsPath = Paths.get(tsFolder.getPath(), Constants.TS_NAME).toString();</span><br><span class="line">        <span class="comment">//生成.ts</span></span><br><span class="line">        String cmd = String.format(CMD_TRANSFER_2TS, videoFilePath, tsPath);</span><br><span class="line">        ProcessUtils.executeCommand(cmd, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//生成索引文件.m3u8 和切片.ts</span></span><br><span class="line">        cmd = String.format(CMD_CUT_TS, tsPath, Paths.get(tsFolder.getPath(), Constants.M3U8_NAME), tsFolder.getPath(), fileId);</span><br><span class="line">        ProcessUtils.executeCommand(cmd, <span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//删除index.ts</span></span><br><span class="line">        <span class="keyword">new</span> File(tsPath).delete();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新建目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid    父目录id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId     用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> folderName 目录名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FileInfo <span class="title">newFolder</span><span class="params">(String filePid, String userId, String folderName)</span> </span>&#123;</span><br><span class="line">        checkFileName(filePid, userId, folderName, FileFolderTypeEnums.FOLDER.getType());</span><br><span class="line"></span><br><span class="line">        Date curDate = <span class="keyword">new</span> Date();</span><br><span class="line">        FileInfo fileInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">        fileInfo.setFileId(StringTools.getRandomString(Constants.LENGTH_10));</span><br><span class="line">        fileInfo.setUserId(userId);</span><br><span class="line">        fileInfo.setFileName(folderName);</span><br><span class="line">        fileInfo.setFilePid(filePid);</span><br><span class="line">        fileInfo.setFolderType(FileFolderTypeEnums.FOLDER.getType());</span><br><span class="line">        fileInfo.setCreateTime(curDate);</span><br><span class="line">        fileInfo.setLastUpdateTime(curDate);</span><br><span class="line">        fileInfo.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        fileInfo.setStatus(FileStatusEnums.USING.getStatus());</span><br><span class="line">        <span class="keyword">this</span>.fileInfoMapper.insert(fileInfo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//再次查询是否有重名目录 考虑并发情况 若存在，事务回滚</span></span><br><span class="line">        FileInfoQuery fileInfoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        fileInfoQuery.setFilePid(filePid);</span><br><span class="line">        fileInfoQuery.setUserId(userId);</span><br><span class="line">        fileInfoQuery.setFileName(folderName);</span><br><span class="line">        fileInfoQuery.setFolderType(FileFolderTypeEnums.FOLDER.getType());</span><br><span class="line">        fileInfoQuery.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        Integer count = <span class="keyword">this</span>.fileInfoMapper.selectCount(fileInfoQuery);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;文件夹&quot;</span> + folderName + <span class="string">&quot;已经存在，操作失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fileInfo.setFileName(folderName);</span><br><span class="line">        fileInfo.setLastUpdateTime(curDate);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fileInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重命名文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId   文件id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId   用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FileInfo <span class="title">rename</span><span class="params">(String fileId, String userId, String fileName)</span> </span>&#123;</span><br><span class="line">        FileInfo fileInfo = <span class="keyword">this</span>.fileInfoMapper.selectByFileIdAndUserId(fileId, userId);</span><br><span class="line">        <span class="keyword">if</span> (fileInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;文件不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String filePid = fileInfo.getFilePid();</span><br><span class="line">        checkFileName(filePid, userId, fileName, fileInfo.getFolderType());</span><br><span class="line">        <span class="comment">//读取文件后缀  前端限制了不能更改文件后缀</span></span><br><span class="line">        <span class="keyword">if</span> (FileFolderTypeEnums.FILE.getType().equals(fileInfo.getFolderType())) &#123;</span><br><span class="line">            fileName = fileId + StringTools.getFileSuffix(fileInfo.getFilePath());</span><br><span class="line">        &#125;</span><br><span class="line">        Date curDate = <span class="keyword">new</span> Date();</span><br><span class="line">        FileInfo dbInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">        dbInfo.setFileName(fileName);</span><br><span class="line">        dbInfo.setLastUpdateTime(curDate);</span><br><span class="line">        <span class="keyword">this</span>.fileInfoMapper.updateByFileIdAndUserId(dbInfo, fileId, userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//再次查询是否有重名文件 考虑并发情况 若存在，事务回滚</span></span><br><span class="line">        FileInfoQuery fileInfoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        fileInfoQuery.setFilePid(filePid);</span><br><span class="line">        fileInfoQuery.setUserId(userId);</span><br><span class="line">        fileInfoQuery.setFileName(fileName);</span><br><span class="line">        fileInfoQuery.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        Integer count = <span class="keyword">this</span>.fileInfoMapper.selectCount(fileInfoQuery);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;文件名&quot;</span> + fileName + <span class="string">&quot;已经存在，操作失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fileInfo.setFileName(fileName);</span><br><span class="line">        fileInfo.setLastUpdateTime(curDate);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fileInfo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkFileName</span><span class="params">(String filePid, String userId, String fileName, Integer folderType)</span> </span>&#123;</span><br><span class="line">        FileInfoQuery fileInfoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        fileInfoQuery.setFilePid(filePid);</span><br><span class="line">        fileInfoQuery.setUserId(userId);</span><br><span class="line">        fileInfoQuery.setFileName(fileName);</span><br><span class="line">        fileInfoQuery.setFolderType(folderType);</span><br><span class="line">        fileInfoQuery.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        Integer count = <span class="keyword">this</span>.fileInfoMapper.selectCount(fileInfoQuery);</span><br><span class="line">        <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;此目录下已存在同名文件，请修改名称&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移动文件或目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIds 文件id，多个以逗号隔开</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> filePid 指定位置的id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId  用户id</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeFileFolder</span><span class="params">(String fileIds, String filePid, String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (fileIds.equals(filePid)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!Constants.ZERO_STR.equals(fileIds)) &#123;</span><br><span class="line">            FileInfo fileInfo = <span class="keyword">this</span>.getFileInfoByFileIdAndUserId(filePid, userId);</span><br><span class="line">            <span class="comment">//考虑postman工具乱传目录id的情况（不存在的目录id 以及他人的网盘下的目录 或者已被删除的目录）</span></span><br><span class="line">            <span class="keyword">if</span> (fileInfo == <span class="keyword">null</span> || FileDelFlagEnums.DEL.getFlag().equals(fileInfo.getDelFlag())) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String[] fileIdArray = fileIds.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        FileInfoQuery query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        query.setFilePid(filePid);</span><br><span class="line">        query.setUserId(userId);</span><br><span class="line">        List&lt;FileInfo&gt; dbFileList = <span class="keyword">this</span>.findListByParam(query);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, FileInfo&gt; dbFileNameMap = dbFileList.stream().collect(Collectors.toMap(</span><br><span class="line">                FileInfo::getFileName, Function.identity(), (data1, data2) -&gt; data2));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询选中的文件</span></span><br><span class="line">        query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        query.setUserId(userId);</span><br><span class="line">        query.setFileIdArray(fileIdArray);</span><br><span class="line">        List&lt;FileInfo&gt; selectFileList = <span class="keyword">this</span>.findListByParam(query);</span><br><span class="line">        <span class="comment">//将所选文件重命名</span></span><br><span class="line">        <span class="keyword">for</span> (FileInfo item : selectFileList) &#123;</span><br><span class="line">            FileInfo rootFileInfo = dbFileNameMap.get(item.getFileName());</span><br><span class="line">            <span class="comment">//文件名已经存在，重命名被还原的文件名</span></span><br><span class="line">            FileInfo updateInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">            <span class="keyword">if</span> (rootFileInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//生成的文件名可能会和已有的重复，概率较低</span></span><br><span class="line">                <span class="comment">//String fileName = StringTools.rename(item.getFileName());</span></span><br><span class="line">                String fileName = autoRename(filePid, userId, item.getFileName());</span><br><span class="line"></span><br><span class="line">                updateInfo.setFileName(fileName);</span><br><span class="line">            &#125;</span><br><span class="line">            updateInfo.setFilePid(filePid);</span><br><span class="line">            <span class="keyword">this</span>.fileInfoMapper.updateByFileIdAndUserId(updateInfo, item.getFileId(), userId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId  用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIds 文件id列表，用逗号分隔</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeFile2RecycleBatch</span><span class="params">(String userId, String fileIds)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//将文件id列表转换为数组</span></span><br><span class="line">        String[] fileIdArray = fileIds.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">//构造查询条件，根据用户id和文件id数组查询文件信息列表</span></span><br><span class="line">        FileInfoQuery query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        query.setUserId(userId);</span><br><span class="line">        query.setFileIdArray(fileIdArray);</span><br><span class="line">        query.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        List&lt;FileInfo&gt; fileInfoList = <span class="keyword">this</span>.fileInfoMapper.selectList(query);</span><br><span class="line">        <span class="comment">//如果文件信息列表为空，则直接返回</span></span><br><span class="line">        <span class="keyword">if</span> (fileInfoList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//定义一个列表，用于存储需要删除的文件id</span></span><br><span class="line">        List&lt;String&gt; delFilePidList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//过滤掉文件类型为文件的，只保留文件类型为目录的</span></span><br><span class="line">        fileInfoList = fileInfoList.stream().filter(m -&gt;</span><br><span class="line">                FileFolderTypeEnums.FOLDER.getType().equals(</span><br><span class="line">                        m.getFolderType())).collect(Collectors.toList());</span><br><span class="line">        <span class="comment">//遍历文件信息列表，递归查询每个文件的所有子目录，并将它们的文件id添加到delFilePidList列表中</span></span><br><span class="line">        <span class="keyword">for</span> (FileInfo fileInfo : fileInfoList) &#123;</span><br><span class="line">            findAllSubFolderFileList(delFilePidList, userId, fileInfo.getFileId(), FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果delFilePidList列表不为空，则更新这些文件的删除标志为DEL（删除）</span></span><br><span class="line">        <span class="keyword">if</span> (!delFilePidList.isEmpty()) &#123;</span><br><span class="line">            FileInfo updateInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">            updateInfo.setDelFlag(FileDelFlagEnums.DEL.getFlag());</span><br><span class="line">            <span class="keyword">this</span>.fileInfoMapper.batchUpdateFileDelFlag(updateInfo, userId, delFilePidList,</span><br><span class="line">                    <span class="keyword">null</span>, FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将选择的文件或目录的删除状态标志为RECYCLE（回收站），并设置至回收站的时间</span></span><br><span class="line">        List&lt;String&gt; delFileIdList = Arrays.asList(fileIdArray);</span><br><span class="line">        FileInfo fileInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">        fileInfo.setRecoveryTime(<span class="keyword">new</span> Date());</span><br><span class="line">        fileInfo.setDelFlag(FileDelFlagEnums.RECYCLE.getFlag());</span><br><span class="line">        <span class="keyword">this</span>.fileInfoMapper.batchUpdateFileDelFlag(fileInfo, userId,</span><br><span class="line">                <span class="keyword">null</span>, delFileIdList, FileDelFlagEnums.USING.getFlag());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归查询指定目录下的所有目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIdList 文件id列表，用于存储查询结果</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId     用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId     文件id，表示要查询的目录</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delFlag    删除标志，表示要查询的目录的状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findAllSubFolderFileList</span><span class="params">(List&lt;String&gt; fileIdList, String userId, String fileId, Integer delFlag)</span> </span>&#123;</span><br><span class="line">        fileIdList.add(fileId);</span><br><span class="line">        <span class="comment">//构造查询条件，根据用户id，父目录id，删除标志和目录类型查询子目录信息列表</span></span><br><span class="line">        FileInfoQuery query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        query.setUserId(userId);</span><br><span class="line">        query.setFilePid(fileId);</span><br><span class="line">        query.setDelFlag(delFlag);</span><br><span class="line">        query.setFolderType(FileFolderTypeEnums.FOLDER.getType());</span><br><span class="line">        List&lt;FileInfo&gt; fileInfoList = <span class="keyword">this</span>.fileInfoMapper.selectList(query);</span><br><span class="line">        <span class="comment">//遍历子目录信息列表，递归查询每个子目录的所有子目录，并将它们的文件id添加到fileIdList列表中</span></span><br><span class="line">        <span class="keyword">for</span> (FileInfo fileInfo : fileInfoList) &#123;</span><br><span class="line">            findAllSubFolderFileList(fileIdList, userId, fileInfo.getFileId(), delFlag);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 恢复文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId  用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIds 要恢复的文件id，多个以逗号隔开</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">recoverFileBatch</span><span class="params">(String userId, String fileIds)</span> </span>&#123;</span><br><span class="line">        String[] fileIdArray = fileIds.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        FileInfoQuery query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        query.setUserId(userId);</span><br><span class="line">        query.setFileIdArray(fileIdArray);</span><br><span class="line">        query.setDelFlag(FileDelFlagEnums.RECYCLE.getFlag());</span><br><span class="line">        List&lt;FileInfo&gt; fileInfoList = <span class="keyword">this</span>.fileInfoMapper.selectList(query);</span><br><span class="line"></span><br><span class="line">        List&lt;String&gt; delFileSubFolderFileIdList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (FileInfo fileInfo : fileInfoList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (FileFolderTypeEnums.FOLDER.getType().equals(fileInfo.getFolderType())) &#123;</span><br><span class="line">                findAllSubFolderFileList(delFileSubFolderFileIdList, userId, fileInfo.getFileId(), FileDelFlagEnums.DEL.getFlag());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//查询所有根目录的文件</span></span><br><span class="line">        query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        query.setUserId(userId);</span><br><span class="line">        query.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        query.setFilePid(Constants.ZERO_STR);</span><br><span class="line">        List&lt;FileInfo&gt; allRootFileList = <span class="keyword">this</span>.findListByParam(query);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, FileInfo&gt; rootFileMap = allRootFileList.stream().collect(Collectors.toMap(</span><br><span class="line">                FileInfo::getFileName, Function.identity(), (data1, data2) -&gt; data2));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询所有所选文件 将目录下的所有删除的文件更新为使用者</span></span><br><span class="line">        <span class="keyword">if</span> (!delFileSubFolderFileIdList.isEmpty()) &#123;</span><br><span class="line">            FileInfo fileInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">            fileInfo.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">            <span class="keyword">this</span>.fileInfoMapper.batchUpdateFileDelFlag(fileInfo, userId, delFileSubFolderFileIdList, <span class="keyword">null</span>, FileDelFlagEnums.DEL.getFlag());</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将选中的文件更新为正常，且父级目录设置为根目录</span></span><br><span class="line">        List&lt;String&gt; delFileIdList = Arrays.asList(fileIdArray);</span><br><span class="line">        FileInfo fileInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">        fileInfo.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        fileInfo.setFilePid(Constants.ZERO_STR);</span><br><span class="line">        fileInfo.setLastUpdateTime(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="keyword">this</span>.fileInfoMapper.batchUpdateFileDelFlag(fileInfo, userId, <span class="keyword">null</span>, delFileIdList, FileDelFlagEnums.RECYCLE.getFlag());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//将所选文件重命名</span></span><br><span class="line">        <span class="keyword">for</span> (FileInfo item : fileInfoList) &#123;</span><br><span class="line">            FileInfo rootFileInfo = rootFileMap.get(item.getFileName());</span><br><span class="line">            <span class="comment">//文件名已经存在，重命名被还原的文件名</span></span><br><span class="line">            <span class="keyword">if</span> (rootFileInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">                String fileName = StringTools.rename(item.getFileName());</span><br><span class="line">                FileInfo updateInfo = <span class="keyword">new</span> FileInfo();</span><br><span class="line">                updateInfo.setFileName(fileName);</span><br><span class="line">                <span class="keyword">this</span>.fileInfoMapper.updateByFileIdAndUserId(updateInfo, item.getFileId(), userId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除回收站中的文件/管理员删除文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId  用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileIds 文件ID数组，用逗号分隔</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> adminOp 是否是管理员操作，如果是，不需要判断删除标记</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchDelFile</span><span class="params">(String userId, String fileIds, Boolean adminOp)</span> </span>&#123;</span><br><span class="line">        String[] fileIdArray = fileIds.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        FileInfoQuery query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        query.setUserId(userId);</span><br><span class="line">        query.setFileIdArray(fileIdArray);</span><br><span class="line">        query.setDelFlag(FileDelFlagEnums.RECYCLE.getFlag());</span><br><span class="line">        List&lt;FileInfo&gt; fileInfoList = <span class="keyword">this</span>.fileInfoMapper.selectList(query);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//所有需要删除的目录id</span></span><br><span class="line">        List&lt;String&gt; delFileSubFileFolderFileIdList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//需要删除的文件列表</span></span><br><span class="line">        List&lt;FileInfo&gt; allDelFileList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        allDelFileList.addAll(fileInfoList.stream().filter(m -&gt; m.getFolderType().</span><br><span class="line">                equals(FileFolderTypeEnums.FILE.getType())).collect(Collectors.toList()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//找到所选文件子目录文件id</span></span><br><span class="line">        <span class="keyword">for</span> (FileInfo fileInfo : fileInfoList) &#123;</span><br><span class="line">            <span class="keyword">if</span> (FileFolderTypeEnums.FOLDER.getType().equals(fileInfo.getFolderType())) &#123;</span><br><span class="line">                findAllSubFolderFileList(delFileSubFileFolderFileIdList, userId, fileInfo.getFileId(), FileDelFlagEnums.DEL.getFlag());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据目录id找到所有需要删除文件</span></span><br><span class="line">        FileInfoQuery queryFile = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        queryFile.setUserId(userId);</span><br><span class="line">        queryFile.setFilePidArray(fileIdArray);</span><br><span class="line">        <span class="comment">//不设置文件删除状态 可能存在三种删除状态</span></span><br><span class="line">        <span class="comment">//queryFile.setDelFlag();</span></span><br><span class="line">        queryFile.setFolderType(FileFolderTypeEnums.FILE.getType());</span><br><span class="line">        allDelFileList.addAll(<span class="keyword">this</span>.fileInfoMapper.selectList(queryFile));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除所有选中文件，子目录中的文件</span></span><br><span class="line">        <span class="keyword">if</span> (!delFileSubFileFolderFileIdList.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">this</span>.fileInfoMapper.batchDelFile(userId, delFileSubFileFolderFileIdList,</span><br><span class="line">                    <span class="keyword">null</span>, adminOp ? <span class="keyword">null</span> : FileDelFlagEnums.DEL.getFlag());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除所选文件</span></span><br><span class="line">        <span class="keyword">this</span>.fileInfoMapper.batchDelFile(userId, <span class="keyword">null</span>, Arrays.asList(fileIdArray),</span><br><span class="line">                adminOp ? <span class="keyword">null</span> : FileDelFlagEnums.RECYCLE.getFlag());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//更新用户的使用空间</span></span><br><span class="line">        Long useSpace = <span class="keyword">this</span>.fileInfoMapper.selectUseSpace(userId);</span><br><span class="line">        UserInfo userInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">        userInfo.setUseSpace(useSpace);</span><br><span class="line">        <span class="keyword">this</span>.userInfoMapper.updateByUserId(userInfo, userId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置缓存</span></span><br><span class="line">        UserSpaceDto userSpaceDto = redisComponent.getUserSpaceUse(userId);</span><br><span class="line">        userSpaceDto.setUseSpace(useSpace);</span><br><span class="line">        redisComponent.saveUserSpaceUse(userId, userSpaceDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 新增一个方法调用，用于判断和删除物理文件</span></span><br><span class="line">        <span class="keyword">if</span> (!allDelFileList.isEmpty()) &#123;</span><br><span class="line">            deletePhysicalFiles(allDelFileList);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断和删除物理文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> allDelFileList 需要删除的文件列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deletePhysicalFiles</span><span class="params">(List&lt;FileInfo&gt; allDelFileList)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (FileInfo fileInfo : allDelFileList) &#123;</span><br><span class="line">            FileInfoQuery md5Query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">            md5Query.setFileMd5(fileInfo.getFileMd5());</span><br><span class="line">            md5Query.setStatus(FileStatusEnums.USING.getStatus());</span><br><span class="line">            List&lt;FileInfo&gt; md5FileInfoList = <span class="keyword">this</span>.fileInfoMapper.selectList(md5Query);</span><br><span class="line">            <span class="comment">// 如果数据库中没有其他记录使用了同样的MD5值，说明文件没有引用，可以被物理删除</span></span><br><span class="line">            <span class="keyword">if</span> (md5FileInfoList.isEmpty()) &#123;</span><br><span class="line">                String filePath = Paths.get(appConfig.getProjectFolder(), Constants.FILE_FOLDER_FILE,</span><br><span class="line">                        fileInfo.getFilePath()).toString();</span><br><span class="line">                File delFile = <span class="keyword">new</span> File(filePath);</span><br><span class="line">                <span class="keyword">if</span> (delFile.exists()) &#123;</span><br><span class="line">                    <span class="comment">// 删除物理文件</span></span><br><span class="line">                    delFile.delete();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">//删除对应的缩略图</span></span><br><span class="line">                String fileCoverPath = Paths.get(appConfig.getProjectFolder(), Constants.FILE_FOLDER_FILE,</span><br><span class="line">                        fileInfo.getFileCover()).toString();</span><br><span class="line">                File delFileCover = <span class="keyword">new</span> File(fileCoverPath);</span><br><span class="line">                <span class="keyword">if</span> (delFileCover.exists()) &#123;</span><br><span class="line">                    <span class="comment">// 删除物理文件</span></span><br><span class="line">                    delFileCover.delete();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验是否有权限访问子目录或者子文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rootFilePid 分享根目录或者根文件的ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId      分享者ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId      子目录或者子文件的ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果校验不通过，抛出业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkRootFilePid</span><span class="params">(String rootFilePid, String userId, String fileId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringTools.isEmpty(fileId)) &#123;</span><br><span class="line">            <span class="comment">//如果子目录或者子文件的ID为空，抛出参数错误异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (rootFilePid.equals(fileId)) &#123;</span><br><span class="line">            <span class="comment">//如果子目录或者子文件的ID等于根目录或者根文件的ID，说明是合法的访问，直接返回</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则，递归检查子目录或者子文件是否属于根目录或者根文件下的路径</span></span><br><span class="line">        checkFilePid(rootFilePid, fileId, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递归检查子目录或者子文件是否属于根目录或者根文件下的路径</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rootFilePid 分享根目录或者根文件的ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileId      子目录或者子文件的ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId      分享者ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果校验不通过，抛出业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">checkFilePid</span><span class="params">(String rootFilePid, String fileId, String userId)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据子目录或者子文件的ID和分享者ID，查询文件信息</span></span><br><span class="line">        FileInfo fileInfo = <span class="keyword">this</span>.fileInfoMapper.selectByFileIdAndUserId(fileId, userId);</span><br><span class="line">        <span class="keyword">if</span> (fileInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//如果文件信息为空，说明文件不存在或者已删除，抛出参数错误异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (Constants.ZERO_STR.equals(fileInfo.getFilePid())) &#123;</span><br><span class="line">            <span class="comment">//如果文件的父级ID为0，说明已经到根目录，但是没有找到根目录，抛出参数错误异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (fileInfo.getFilePath().equals(rootFilePid)) &#123;</span><br><span class="line">            <span class="comment">//如果文件的全路径等于根目录或者根文件的ID，说明是属于分享文件下的路径，直接返回</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//否则，继续递归检查文件的父级ID是否属于分享文件下的路径</span></span><br><span class="line">        checkFilePid(rootFilePid, fileInfo.getFilePid(), userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveShare</span><span class="params">(String shareRootFilePid, String shareFileIds, String myFolderId,</span></span></span><br><span class="line"><span class="function"><span class="params">                          String shareUserId, String currentUserId)</span> </span>&#123;</span><br><span class="line">        String[] shareFileIdArray = shareFileIds.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">//目标文件列表</span></span><br><span class="line">        FileInfoQuery fileInfoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        fileInfoQuery.setUserId(currentUserId);</span><br><span class="line">        fileInfoQuery.setFilePid(myFolderId);</span><br><span class="line">        fileInfoQuery.setDelFlag(FileDelFlagEnums.USING.getFlag());</span><br><span class="line">        List&lt;FileInfo&gt; currentFileList = <span class="keyword">this</span>.fileInfoMapper.selectList(fileInfoQuery);</span><br><span class="line">        Map&lt;String, FileInfo&gt; currentFileMap = currentFileList.stream().collect(Collectors.toMap(</span><br><span class="line">                FileInfo::getFileName, Function.identity(), (data1, data2) -&gt; data2));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//选择的文件</span></span><br><span class="line">        fileInfoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        fileInfoQuery.setUserId(shareUserId);</span><br><span class="line">        fileInfoQuery.setFileIdArray(shareFileIdArray);</span><br><span class="line">        List&lt;FileInfo&gt; shareFileList = <span class="keyword">this</span>.fileInfoMapper.selectList(fileInfoQuery);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//重命名选择的文件</span></span><br><span class="line">        List&lt;FileInfo&gt; copyFileList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        Date curData = <span class="keyword">new</span> Date();</span><br><span class="line">        <span class="keyword">for</span> (FileInfo item : shareFileList) &#123;</span><br><span class="line">            FileInfo sameNameFile = currentFileMap.get(item.getFileName());</span><br><span class="line">            <span class="keyword">if</span> (sameNameFile != <span class="keyword">null</span>) &#123;</span><br><span class="line">                item.setFileName(autoRename(myFolderId, item.getFileName(), currentUserId));</span><br><span class="line">            &#125;</span><br><span class="line">            findAllSubFile(copyFileList, item, shareUserId, currentUserId, curData, myFolderId);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.fileInfoMapper.insertBatch(copyFileList);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findAllSubFile</span><span class="params">(List&lt;FileInfo&gt; copyFileList, FileInfo fileInfo, String sourceUserId, String currentUserId,</span></span></span><br><span class="line"><span class="function"><span class="params">                                Date curData, String newFilePid)</span> </span>&#123;</span><br><span class="line">        String sourceFileId = fileInfo.getFileId();</span><br><span class="line">        fileInfo.setCreateTime(curData);</span><br><span class="line">        fileInfo.setLastUpdateTime(curData);</span><br><span class="line">        fileInfo.setFilePid(newFilePid);</span><br><span class="line">        String newFileId = StringTools.getRandomString(Constants.LENGTH_10);</span><br><span class="line">        fileInfo.setFileId(newFileId);</span><br><span class="line">        copyFileList.add(fileInfo);</span><br><span class="line">        <span class="keyword">if</span> (FileFolderTypeEnums.FOLDER.getType().equals(fileInfo.getFolderType())) &#123;</span><br><span class="line">            FileInfoQuery query = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">            query.setFilePid(sourceFileId);</span><br><span class="line">            query.setUserId(sourceUserId);</span><br><span class="line">            List&lt;FileInfo&gt; sourceFileList = <span class="keyword">this</span>.fileInfoMapper.selectList(query);</span><br><span class="line">            <span class="keyword">for</span> (FileInfo item : sourceFileList) &#123;</span><br><span class="line">                findAllSubFile(copyFileList, item, sourceUserId, currentUserId, curData, newFileId);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="FileShareServiceImpl类"><a href="#FileShareServiceImpl类" class="headerlink" title="FileShareServiceImpl类"></a>FileShareServiceImpl类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionShareDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileDelFlagEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.PageSize;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.ResponseCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.ShareValidTypeEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileShare;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileShareQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.SimplePage;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.mappers.FileShareMapper;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileShareService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.DateUtil;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Function;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-01 20:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;fileShareService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileShareServiceImpl</span> <span class="keyword">implements</span> <span class="title">FileShareService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileShareMapper&lt;FileShare, FileShareQuery&gt; fileShareMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;FileShare&gt; <span class="title">findListByParam</span><span class="params">(FileShareQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileShareMapper.selectList(param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">findCountByParam</span><span class="params">(FileShareQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileShareMapper.selectCount(param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationResultVO&lt;FileShare&gt; <span class="title">findListByPage</span><span class="params">(FileShareQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="keyword">this</span>.findCountByParam(param);</span><br><span class="line">        <span class="keyword">int</span> pageSize = param.getPageSize() == <span class="keyword">null</span> ? PageSize.SIZE15.getSize() : param.getPageSize();</span><br><span class="line"></span><br><span class="line">        SimplePage page = <span class="keyword">new</span> SimplePage(param.getPageNo(), count, pageSize);</span><br><span class="line">        param.setSimplePage(page);</span><br><span class="line">        List&lt;FileShare&gt; list = <span class="keyword">this</span>.findListByParam(param);</span><br><span class="line">        PaginationResultVO&lt;FileShare&gt; result = <span class="keyword">new</span> PaginationResultVO(count, page.getPageSize(),</span><br><span class="line">                page.getPageNo(), page.getPageTotal(), list);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">add</span><span class="params">(FileShare bean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileShareMapper.insert(bean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">addBatch</span><span class="params">(List&lt;FileShare&gt; listBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (listBean == <span class="keyword">null</span> || listBean.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileShareMapper.insertBatch(listBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增或者修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">addOrUpdateBatch</span><span class="params">(List&lt;FileShare&gt; listBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (listBean == <span class="keyword">null</span> || listBean.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileShareMapper.insertOrUpdateBatch(listBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FileShare <span class="title">getFileShareByShareId</span><span class="params">(String shareId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileShareMapper.selectByShareId(shareId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">updateFileShareByShareId</span><span class="params">(FileShare bean, String shareId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileShareMapper.updateByShareId(bean, shareId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteFileShareByShareId</span><span class="params">(String shareId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.fileShareMapper.deleteByShareId(shareId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存分享的文件信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileShare 分享对象，包含分享者ID、分享文件ID、有效类型、过期时间、提取码等信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">saveShare</span><span class="params">(FileShare fileShare)</span> </span>&#123;</span><br><span class="line">        ShareValidTypeEnums typeEnums = ShareValidTypeEnums.getByType(fileShare.getValidType());</span><br><span class="line">        <span class="keyword">if</span> (typeEnums == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ShareValidTypeEnums.FOREVER != typeEnums) &#123;</span><br><span class="line">            fileShare.setExpireTime(DateUtil.getAfterDate(typeEnums.getDays()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Date curDate = <span class="keyword">new</span> Date();</span><br><span class="line">        fileShare.setShareTime(curDate);</span><br><span class="line">        <span class="keyword">if</span> (StringTools.isEmpty(fileShare.getCode())) &#123;</span><br><span class="line">            fileShare.setCode(StringTools.getRandomString(Constants.LENGTH_5));</span><br><span class="line">        &#125;</span><br><span class="line">        fileShare.setShareId(StringTools.getRandomString(Constants.LENGTH_20));</span><br><span class="line">        <span class="keyword">this</span>.fileShareMapper.insert(fileShare);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量取消分享</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareIds 取消分享的文件id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchDeleteFileShare</span><span class="params">(String shareIds, String userId)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; shareIdList = Arrays.asList(shareIds.split(<span class="string">&quot;,&quot;</span>));</span><br><span class="line">        Integer count = <span class="keyword">this</span>.fileShareMapper.batchDeleteFileShare(shareIdList, userId);</span><br><span class="line">        <span class="keyword">if</span> (count != shareIdList.size()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_600);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验分享码</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> shareId 分享文件的ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> code    分享码</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 分享信息对象，包含分享者ID、分享文件ID和过期时间等信息</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> BusinessException 如果分享文件不存在或者已过期，或者分享码错误，抛出业务异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SessionShareDto <span class="title">checkShareCode</span><span class="params">(String shareId, String code)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//根据分享文件的ID，查询分享记录</span></span><br><span class="line">        FileShare share = <span class="keyword">this</span>.fileShareMapper.selectByShareId(shareId);</span><br><span class="line">        <span class="keyword">if</span> (share == <span class="keyword">null</span> || (share.getExpireTime() != <span class="keyword">null</span> &amp;&amp; <span class="keyword">new</span> Date().after(share.getExpireTime()))) &#123;</span><br><span class="line">            <span class="comment">//如果分享记录为空或者已过期，抛出分享失效异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_902);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!share.getCode().equals(code)) &#123;</span><br><span class="line">            <span class="comment">//如果分享码不正确，抛出提取码错误异常</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;提取码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//更新分享记录的浏览次数</span></span><br><span class="line">        <span class="keyword">this</span>.fileShareMapper.updateShareShowCount(shareId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建分享信息对象，用于保存到会话中</span></span><br><span class="line">        SessionShareDto sessionShareDto = <span class="keyword">new</span> SessionShareDto();</span><br><span class="line">        <span class="comment">//设置分享信息对象的属性值</span></span><br><span class="line">        sessionShareDto.setShareId(shareId);</span><br><span class="line">        sessionShareDto.setShareUserId(share.getUserId());</span><br><span class="line">        sessionShareDto.setFileId(share.getFileId());</span><br><span class="line">        sessionShareDto.setExpireTime(share.getExpireTime());</span><br><span class="line">        <span class="comment">//返回分享信息对象</span></span><br><span class="line">        <span class="keyword">return</span> sessionShareDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="UserInfoServiceImpl类"><a href="#UserInfoServiceImpl类" class="headerlink" title="UserInfoServiceImpl类"></a>UserInfoServiceImpl类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.component.RedisComponent;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.config.AppConfig;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.QQInfoDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SysSettingsDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.UserSpaceDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.PageSize;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.UserStatusEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.SimplePage;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.UserInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.mappers.FileInfoMapper;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.mappers.UserInfoMapper;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.EmailCodeService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.UserInfoService;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.JsonUtils;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.OKHttpUtils;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.utils.StringTools;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.ArrayUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息 业务接口实现</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:32</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service(&quot;userInfoService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserInfoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(UserInfoServiceImpl.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> UserInfoMapper&lt;UserInfo, UserInfoQuery&gt; userInfoMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoMapper&lt;FileInfo, FileInfoQuery&gt; fileInfoMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> EmailCodeService emailCodeService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> RedisComponent redisComponent;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> AppConfig appConfig;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;UserInfo&gt; <span class="title">findListByParam</span><span class="params">(UserInfoQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.selectList(param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">findCountByParam</span><span class="params">(UserInfoQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.selectCount(param);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaginationResultVO&lt;UserInfo&gt; <span class="title">findListByPage</span><span class="params">(UserInfoQuery param)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> count = <span class="keyword">this</span>.findCountByParam(param);</span><br><span class="line">        <span class="keyword">int</span> pageSize = param.getPageSize() == <span class="keyword">null</span> ? PageSize.SIZE15.getSize() : param.getPageSize();</span><br><span class="line"></span><br><span class="line">        SimplePage page = <span class="keyword">new</span> SimplePage(param.getPageNo(), count, pageSize);</span><br><span class="line">        param.setSimplePage(page);</span><br><span class="line">        List&lt;UserInfo&gt; list = <span class="keyword">this</span>.findListByParam(param);</span><br><span class="line">        PaginationResultVO&lt;UserInfo&gt; result = <span class="keyword">new</span> PaginationResultVO(count, page.getPageSize(),</span><br><span class="line">                page.getPageNo(), page.getPageTotal(), list);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">add</span><span class="params">(UserInfo bean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.insert(bean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">addBatch</span><span class="params">(List&lt;UserInfo&gt; listBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (listBean == <span class="keyword">null</span> || listBean.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.insertBatch(listBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增或者修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">addOrUpdateBatch</span><span class="params">(List&lt;UserInfo&gt; listBean)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (listBean == <span class="keyword">null</span> || listBean.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.insertOrUpdateBatch(listBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">getUserInfoByUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.selectByUserId(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">updateUserInfoByUserId</span><span class="params">(UserInfo bean, String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.updateByUserId(bean, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteUserInfoByUserId</span><span class="params">(String userId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.deleteByUserId(userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">getUserInfoByEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.selectByEmail(email);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">updateUserInfoByEmail</span><span class="params">(UserInfo bean, String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.updateByEmail(bean, email);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteUserInfoByEmail</span><span class="params">(String email)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.deleteByEmail(email);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">getUserInfoByNickName</span><span class="params">(String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.selectByNickName(nickName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">updateUserInfoByNickName</span><span class="params">(UserInfo bean, String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.updateByNickName(bean, nickName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteUserInfoByNickName</span><span class="params">(String nickName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.deleteByNickName(nickName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId获取对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> UserInfo <span class="title">getUserInfoByQqOpenId</span><span class="params">(String qqOpenId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.selectByQqOpenId(qqOpenId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">updateUserInfoByQqOpenId</span><span class="params">(UserInfo bean, String qqOpenId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.updateByQqOpenId(bean, qqOpenId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteUserInfoByQqOpenId</span><span class="params">(String qqOpenId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.userInfoMapper.deleteByQqOpenId(qqOpenId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(String email, String nickName, String password, String emailCode)</span> </span>&#123;</span><br><span class="line">        UserInfo userInfo = <span class="keyword">this</span>.userInfoMapper.selectByEmail(email);</span><br><span class="line">        <span class="keyword">if</span> (userInfo != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;邮箱账号已经存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        UserInfo nickNameUser = <span class="keyword">this</span>.userInfoMapper.selectByNickName(nickName);</span><br><span class="line">        <span class="keyword">if</span> (nickNameUser != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;昵称已经存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//校验邮箱验证码</span></span><br><span class="line">        emailCodeService.checkCode(email, emailCode);</span><br><span class="line"></span><br><span class="line">        String userId = StringTools.getRandomNumber(Constants.LENGTH_10);</span><br><span class="line">        userInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">        userInfo.setUserId(userId);</span><br><span class="line">        userInfo.setEmail(email);</span><br><span class="line">        userInfo.setNickName(nickName);</span><br><span class="line">        userInfo.setPassword(StringTools.encodeByMD5(password));</span><br><span class="line">        userInfo.setJoinTime(<span class="keyword">new</span> Date());</span><br><span class="line">        userInfo.setStatus(UserStatusEnum.ENABLE.getStatus());</span><br><span class="line">        userInfo.setUseSpace(<span class="number">0L</span>);</span><br><span class="line">        SysSettingsDto sysSettingsDto = redisComponent.getSysSettingsDto();</span><br><span class="line">        userInfo.setTotalSpace(sysSettingsDto.getUserInitUseSpace() * Constants.MB);</span><br><span class="line">        <span class="comment">//TODO 设置注册IP 注册地址（国内精确到市区）</span></span><br><span class="line">        <span class="keyword">this</span>.userInfoMapper.insert(userInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SessionWebUserDto <span class="title">login</span><span class="params">(String email, String password)</span> </span>&#123;</span><br><span class="line">        UserInfo userInfo = <span class="keyword">this</span>.userInfoMapper.selectByEmail(email);</span><br><span class="line">        <span class="keyword">if</span> (userInfo == <span class="keyword">null</span> || !userInfo.getPassword().equalsIgnoreCase(password)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;账号或者密码错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (UserStatusEnum.DISABLE.getStatus().equals(userInfo.getStatus())) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;账号已禁用&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UserInfo updateInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">        updateInfo.setLastLoginTime(<span class="keyword">new</span> Date());</span><br><span class="line">        <span class="comment">//TODO 设置最近登录IP地址（国内精确到市区）</span></span><br><span class="line">        <span class="keyword">this</span>.userInfoMapper.updateByUserId(updateInfo, userInfo.getUserId());</span><br><span class="line"></span><br><span class="line">        SessionWebUserDto sessionWebUserDto = <span class="keyword">new</span> SessionWebUserDto();</span><br><span class="line">        sessionWebUserDto.setNickName(userInfo.getNickName());</span><br><span class="line">        sessionWebUserDto.setUserId(userInfo.getUserId());</span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.contains(appConfig.getAdminEmails().split(<span class="string">&quot;,&quot;</span>), email)) &#123;</span><br><span class="line">            sessionWebUserDto.setAdmin(<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sessionWebUserDto.setAdmin(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//用户空间</span></span><br><span class="line">        UserSpaceDto userSpaceDto = <span class="keyword">new</span> UserSpaceDto();</span><br><span class="line">        Long useSpace = fileInfoMapper.selectUseSpace(userInfo.getUserId());</span><br><span class="line">        userSpaceDto.setUseSpace(useSpace);</span><br><span class="line">        userSpaceDto.setTotalSpace(userInfo.getTotalSpace());</span><br><span class="line">        redisComponent.saveUserSpaceUse(userInfo.getUserId(), userSpaceDto);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sessionWebUserDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">resetPwd</span><span class="params">(String email, String password, String emailCode)</span> </span>&#123;</span><br><span class="line">        UserInfo userInfo = <span class="keyword">this</span>.userInfoMapper.selectByEmail(email);</span><br><span class="line">        <span class="keyword">if</span> (userInfo == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;邮箱账号不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//校验邮箱验证码</span></span><br><span class="line">        emailCodeService.checkCode(email, emailCode);</span><br><span class="line"></span><br><span class="line">        UserInfo updateInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">        userInfo.setPassword(StringTools.encodeByMD5(password));</span><br><span class="line">        <span class="keyword">this</span>.userInfoMapper.updateByEmail(updateInfo, email);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SessionWebUserDto <span class="title">qqLogin</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//第一步 通过回调code 获取accessToken</span></span><br><span class="line">        <span class="comment">//使用appConfig中的qqUrlAccessToken模板，填充qqAppId，qqAppKey，code和qqUrlRedirect参数，发送GET请求</span></span><br><span class="line">        String accessToken = getQQAccessToken(code);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//第二步 获取qqopenid</span></span><br><span class="line">        <span class="comment">//使用appConfig中的qqUrlOpenId模板，填充accessToken参数，发送GET请求，并解析返回的json数据</span></span><br><span class="line">        String openId = getQQOpenId(accessToken);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据openId查询用户信息表，如果没有找到，则表示用户未注册</span></span><br><span class="line">        UserInfo user = <span class="keyword">this</span>.userInfoMapper.selectByQqOpenId(openId);</span><br><span class="line">        String avatar = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//自动注册</span></span><br><span class="line">            <span class="comment">//第三步 获取用户的基本信息</span></span><br><span class="line">            <span class="comment">//使用appConfig中的qqUrlUserInfo模板，填充accessToken，qqAppId和openId参数，发送GET请求，并转换为QQInfoDto对象</span></span><br><span class="line">            QQInfoDto qqInfo = getQQUserInfo(accessToken, openId);</span><br><span class="line">            user = <span class="keyword">new</span> UserInfo();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取用户昵称，如果超过20个字符，则截取前20个字符</span></span><br><span class="line">            String nickName = qqInfo.getNickname();</span><br><span class="line">            nickName = nickName.length() &gt; Constants.LENGTH_20 ? nickName.substring(<span class="number">0</span>, Constants.LENGTH_20) : nickName;</span><br><span class="line">            <span class="comment">//获取用户头像地址，优先使用高清头像figureurl_qq_2，如果为空，则使用普通头像figureurl_qq_1</span></span><br><span class="line">            avatar = StringTools.isEmpty(qqInfo.getFigureurl_qq_2()) ? qqInfo.getFigureurl_qq_1() : qqInfo.getFigureurl_qq_2();</span><br><span class="line"></span><br><span class="line">            Date curDate = <span class="keyword">new</span> Date();</span><br><span class="line">            <span class="comment">//上传头像到本地</span></span><br><span class="line">            user.setQqOpenId(openId);</span><br><span class="line">            user.setJoinTime(curDate);</span><br><span class="line">            user.setNickName(nickName);</span><br><span class="line">            user.setQqAvatar(avatar);</span><br><span class="line">            <span class="comment">//生成一个10位的随机字符串作为用户id</span></span><br><span class="line">            user.setUserId(StringTools.getRandomString(Constants.LENGTH_10));</span><br><span class="line">            user.setLastLoginTime(curDate);</span><br><span class="line">            user.setStatus(UserStatusEnum.ENABLE.getStatus());</span><br><span class="line">            user.setUseSpace(<span class="number">0L</span>);</span><br><span class="line">            <span class="comment">//从redis中获取系统设置的用户初始可用空间，并乘以MB转换为字节</span></span><br><span class="line">            user.setTotalSpace(redisComponent.getSysSettingsDto().getUserInitUseSpace() * Constants.MB);</span><br><span class="line">            <span class="comment">//将用户信息插入到数据库中</span></span><br><span class="line">            <span class="keyword">this</span>.userInfoMapper.insert(user);</span><br><span class="line">            <span class="comment">//重新查询用户信息表，获取用户对象</span></span><br><span class="line">            user = userInfoMapper.selectByQqOpenId(openId);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//如果用户已经注册，则更新最后登录时间，并获取用户头像地址</span></span><br><span class="line">            UserInfo updateInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">            updateInfo.setLastLoginTime(<span class="keyword">new</span> Date());</span><br><span class="line">            avatar = user.getQqAvatar();</span><br><span class="line">            <span class="keyword">this</span>.userInfoMapper.updateByQqOpenId(updateInfo, openId);</span><br><span class="line">            <span class="comment">//如果用户状态为禁用，则抛出异常提示无法登录</span></span><br><span class="line">            <span class="keyword">if</span> (UserStatusEnum.DISABLE.getStatus().equals(user.getStatus())) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;账号被禁用无法登录&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        SessionWebUserDto sessionWebUserDto = <span class="keyword">new</span> SessionWebUserDto();</span><br><span class="line">        sessionWebUserDto.setUserId(user.getUserId());</span><br><span class="line">        sessionWebUserDto.setNickName(user.getNickName());</span><br><span class="line">        sessionWebUserDto.setAvatar(avatar);</span><br><span class="line">        <span class="comment">//判断用户邮箱是否在appConfig中的adminEmails列表中，如果是，则设置为管理员，否则设置为普通用户</span></span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.contains(appConfig.getAdminEmails().split(<span class="string">&quot;,&quot;</span>), user.getEmail() == <span class="keyword">null</span> ? <span class="string">&quot;&quot;</span> : user.getEmail())) &#123;</span><br><span class="line">            sessionWebUserDto.setAdmin(<span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sessionWebUserDto.setAdmin(<span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        UserSpaceDto userSpaceDto = <span class="keyword">new</span> UserSpaceDto();</span><br><span class="line">        Long useSpace = fileInfoMapper.selectUseSpace(user.getUserId());</span><br><span class="line">        userSpaceDto.setUseSpace(useSpace);</span><br><span class="line">        userSpaceDto.setTotalSpace(user.getTotalSpace());</span><br><span class="line">        redisComponent.saveUserSpaceUse(user.getUserId(), userSpaceDto);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sessionWebUserDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getQQAccessToken</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 返回结果是字符串 access_token=*&amp;expires_in=7776000&amp;refresh_token=*</span></span><br><span class="line"><span class="comment">         * 返回错误 callback(&#123;UcWebConstants.VIEW_OBJ_RESULT_KEY:111,error_description:&quot;error msg&quot;&#125;)</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        String accessToken = <span class="keyword">null</span>;</span><br><span class="line">        String url = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//对qqUrlRedirect进行URL编码，避免特殊字符影响请求格式</span></span><br><span class="line">            url = String.format(appConfig.getQqUrlAccessToken(), appConfig.getQqAppId(), appConfig.getQqAppKey(), code, URLEncoder.encode(appConfig</span><br><span class="line">                    .getQqUrlRedirect(), <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;encode失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//发送GET请求，并获取返回结果字符串</span></span><br><span class="line">        String tokenResult = OKHttpUtils.getRequest(url);</span><br><span class="line">        <span class="comment">//如果返回结果为空或者包含错误码，则表示获取失败，抛出异常提示</span></span><br><span class="line">        <span class="keyword">if</span> (tokenResult == <span class="keyword">null</span> || tokenResult.indexOf(Constants.VIEW_OBJ_RESULT_KEY) != -<span class="number">1</span>) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;获取qqToken失败:&#123;&#125;&quot;</span>, tokenResult);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;获取qqToken失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将返回结果按&amp;分割成数组，并遍历数组找到access_token参数的值，并赋值给accessToken变量</span></span><br><span class="line">        String[] params = tokenResult.split(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (params != <span class="keyword">null</span> &amp;&amp; params.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String p : params) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p.indexOf(<span class="string">&quot;access_token&quot;</span>) != -<span class="number">1</span>) &#123;</span><br><span class="line">                    accessToken = p.split(<span class="string">&quot;=&quot;</span>)[<span class="number">1</span>];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> accessToken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getQQOpenId</span><span class="params">(String accessToken)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        <span class="comment">// 获取openId</span></span><br><span class="line">        <span class="comment">//使用appConfig中的qqUrlOpenId模板，填充accessToken参数，发送GET请求，并获取返回结果字符串</span></span><br><span class="line">        String url = String.format(appConfig.getQqUrlOpenId(), accessToken);</span><br><span class="line">        String openIDResult = OKHttpUtils.getRequest(url);</span><br><span class="line">        <span class="comment">//调用getQQResp方法，将返回结果字符串转换为json格式，并赋值给tmpJson变量</span></span><br><span class="line">        String tmpJson = <span class="keyword">this</span>.getQQResp(openIDResult);</span><br><span class="line">        <span class="comment">//如果tmpJson为空，则表示转换失败，抛出异常提示</span></span><br><span class="line">        <span class="keyword">if</span> (tmpJson == <span class="keyword">null</span>) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;调qq接口获取openID失败:tmpJson&#123;&#125;&quot;</span>, tmpJson);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;调qq接口获取openID失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//将tmpJson转换为Map对象，并赋值给jsonData变量</span></span><br><span class="line">        Map jsonData = JsonUtils.convertJson2Obj(tmpJson, Map.class);</span><br><span class="line">        <span class="comment">//如果jsonData为空或者包含错误码，则表示获取失败，抛出异常提示</span></span><br><span class="line">        <span class="keyword">if</span> (jsonData == <span class="keyword">null</span> || jsonData.containsKey(Constants.VIEW_OBJ_RESULT_KEY)) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;调qq接口获取openID失败:&#123;&#125;&quot;</span>, jsonData);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;调qq接口获取openID失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从jsonData中取出openid键对应的值，并返回该字符串值</span></span><br><span class="line">        <span class="keyword">return</span> String.valueOf(jsonData.get(<span class="string">&quot;openid&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">getQQResp</span><span class="params">(String result)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(result)) &#123;</span><br><span class="line">            <span class="keyword">int</span> pos = result.indexOf(<span class="string">&quot;callback&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (pos != -<span class="number">1</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> start = result.indexOf(<span class="string">&quot;(&quot;</span>);</span><br><span class="line">                <span class="keyword">int</span> end = result.lastIndexOf(<span class="string">&quot;)&quot;</span>);</span><br><span class="line">                <span class="comment">//从result中截取callback函数的参数部分（即json字符串），并返回该字符串值</span></span><br><span class="line">                String jsonStr = result.substring(start + <span class="number">1</span>, end - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> jsonStr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> QQInfoDto <span class="title">getQQUserInfo</span><span class="params">(String accessToken, String qqOpenId)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        <span class="comment">//使用appConfig中的qqUrlUserInfo模板，填充accessToken，qqAppId和openId参数，发送GET请求，并获取返回结果字符串，并赋值给response变量</span></span><br><span class="line">        String url = String.format(appConfig.getQqUrlUserInfo(), accessToken, appConfig.getQqAppId(), qqOpenId);</span><br><span class="line">        String response = OKHttpUtils.getRequest(url);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isNotBlank(response)) &#123;</span><br><span class="line">            <span class="comment">//将response转换为QQInfoDto对象，并赋值给qqInfo变量</span></span><br><span class="line">            QQInfoDto qqInfo = JsonUtils.convertJson2Obj(response, QQInfoDto.class);</span><br><span class="line">            <span class="comment">//如果qqInfo的ret属性不等于0，则表示获取失败，抛出异常提示</span></span><br><span class="line">            <span class="keyword">if</span> (qqInfo.getRet() != <span class="number">0</span>) &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;qqInfo:&#123;&#125;&quot;</span>, response);</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;调qq接口获取用户信息异常&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> qqInfo;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;调qq接口获取用户信息异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户状态</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId 用户ID</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status 用户状态，0为禁用，1为启用</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUserStatus</span><span class="params">(String userId, Integer status)</span> </span>&#123;</span><br><span class="line">        UserInfo userInfo = <span class="keyword">new</span> UserInfo();</span><br><span class="line">        userInfo.setStatus(status);</span><br><span class="line">        <span class="keyword">if</span> (UserStatusEnum.DISABLE.getStatus().equals(status)) &#123;</span><br><span class="line">            <span class="comment">//禁用用户把文件全部删除 一般是违规了</span></span><br><span class="line">            <span class="comment">//TODO 加个参数确认是否删除用户文件</span></span><br><span class="line">            userInfo.setUseSpace(<span class="number">0L</span>);</span><br><span class="line">            <span class="comment">//TODO 未进行物理删除文件 后续加上</span></span><br><span class="line">            fileInfoMapper.deleteFileByUserId(userId);</span><br><span class="line">        &#125;</span><br><span class="line">        userInfoMapper.updateByUserId(userInfo, userId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户存储总空间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userId      用户id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> changeSpace 改变的空间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">changeUserSpace</span><span class="params">(String userId, Integer changeSpace)</span> </span>&#123;</span><br><span class="line">        Long space = changeSpace * Constants.MB;</span><br><span class="line">        <span class="keyword">this</span>.userInfoMapper.updateUserSpace(userId, <span class="keyword">null</span>, space);</span><br><span class="line">        redisComponent.resetUserSpaceUse(userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="EmailCodeService类"><a href="#EmailCodeService类" class="headerlink" title="EmailCodeService类"></a>EmailCodeService类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.EmailCode;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.EmailCodeQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 邮箱验证码 业务接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:35</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmailCodeService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;EmailCode&gt; <span class="title">findListByParam</span><span class="params">(EmailCodeQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">findCountByParam</span><span class="params">(EmailCodeQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">PaginationResultVO&lt;EmailCode&gt; <span class="title">findListByPage</span><span class="params">(EmailCodeQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">add</span><span class="params">(EmailCode bean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">addBatch</span><span class="params">(List&lt;EmailCode&gt; listBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增/修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">addOrUpdateBatch</span><span class="params">(List&lt;EmailCode&gt; listBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据EmailAndCode查询对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">EmailCode <span class="title">getEmailCodeByEmailAndCode</span><span class="params">(String email, String code)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据EmailAndCode修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateEmailCodeByEmailAndCode</span><span class="params">(EmailCode bean, String email, String code)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据EmailAndCode删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteEmailCodeByEmailAndCode</span><span class="params">(String email, String code)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">sendEmailCode</span><span class="params">(String toEmail, Integer type)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">checkCode</span><span class="params">(String email, String code)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="FileInfoService类"><a href="#FileInfoService类" class="headerlink" title="FileInfoService类"></a>FileInfoService类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.UploadResultDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 文件信息 业务接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 13:57</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FileInfoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;FileInfo&gt; <span class="title">findListByParam</span><span class="params">(FileInfoQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">findCountByParam</span><span class="params">(FileInfoQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">PaginationResultVO&lt;FileInfo&gt; <span class="title">findListByPage</span><span class="params">(FileInfoQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">add</span><span class="params">(FileInfo bean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">addBatch</span><span class="params">(List&lt;FileInfo&gt; listBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增/修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">addOrUpdateBatch</span><span class="params">(List&lt;FileInfo&gt; listBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId查询对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">FileInfo <span class="title">getFileInfoByFileIdAndUserId</span><span class="params">(String fileId, String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateFileInfoByFileIdAndUserId</span><span class="params">(FileInfo bean, String fileId, String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据FileIdAndUserId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteFileInfoByFileIdAndUserId</span><span class="params">(String fileId, String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件分片上传</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UploadResultDto <span class="title">uploadFile</span><span class="params">(SessionWebUserDto webUserDto, String fileId, MultipartFile file, String fileName, String filePid,</span></span></span><br><span class="line"><span class="function"><span class="params">                               String fileMd5, Integer chunkIndex, Integer chunks)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新建目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">FileInfo <span class="title">newFolder</span><span class="params">(String filePid, String userId, String fileName)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件重命名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">FileInfo <span class="title">rename</span><span class="params">(String fileId, String userId, String filename)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移动文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">changeFileFolder</span><span class="params">(String fileIds, String filePid, String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">removeFile2RecycleBatch</span><span class="params">(String userId, String fileIds)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 恢复文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">recoverFileBatch</span><span class="params">(String userId, String fileIds)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量删除回收站中的文件/管理员删除文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">batchDelFile</span><span class="params">(String userId, String fileIds, Boolean adminOp)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验是否有权限访问子目录或者子文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">checkRootFilePid</span><span class="params">(String rootFilePid, String userId, String fileId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveShare</span><span class="params">(String shareRootFilePid, String shareFileIds, String myFolderId, String shareUserId, String currentUserId)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="FileShareService类"><a href="#FileShareService类" class="headerlink" title="FileShareService类"></a>FileShareService类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionShareDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileShare;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileShareQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 分享信息 业务接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-01 20:08</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">FileShareService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;FileShare&gt; <span class="title">findListByParam</span><span class="params">(FileShareQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">findCountByParam</span><span class="params">(FileShareQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">PaginationResultVO&lt;FileShare&gt; <span class="title">findListByPage</span><span class="params">(FileShareQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">add</span><span class="params">(FileShare bean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">addBatch</span><span class="params">(List&lt;FileShare&gt; listBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增/修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">addOrUpdateBatch</span><span class="params">(List&lt;FileShare&gt; listBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId查询对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">FileShare <span class="title">getFileShareByShareId</span><span class="params">(String shareId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateFileShareByShareId</span><span class="params">(FileShare bean, String shareId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据ShareId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteFileShareByShareId</span><span class="params">(String shareId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分享文件</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">saveShare</span><span class="params">(FileShare fileShare)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量取消分享</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">batchDeleteFileShare</span><span class="params">(String shareIds, String userId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 校验分享码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">SessionShareDto <span class="title">checkShareCode</span><span class="params">(String shareId,String code)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存到网盘</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="UserInfoService类"><a href="#UserInfoService类" class="headerlink" title="UserInfoService类"></a>UserInfoService类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.dto.SessionWebUserDto;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.UserInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.UserInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.vo.PaginationResultVO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 用户信息 业务接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserInfoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;UserInfo&gt; <span class="title">findListByParam</span><span class="params">(UserInfoQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据条件查询列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">findCountByParam</span><span class="params">(UserInfoQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 分页查询</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">PaginationResultVO&lt;UserInfo&gt; <span class="title">findListByPage</span><span class="params">(UserInfoQuery param)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">add</span><span class="params">(UserInfo bean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">addBatch</span><span class="params">(List&lt;UserInfo&gt; listBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量新增/修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">addOrUpdateBatch</span><span class="params">(List&lt;UserInfo&gt; listBean)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId查询对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UserInfo <span class="title">getUserInfoByUserId</span><span class="params">(String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateUserInfoByUserId</span><span class="params">(UserInfo bean, String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据UserId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteUserInfoByUserId</span><span class="params">(String userId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email查询对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UserInfo <span class="title">getUserInfoByEmail</span><span class="params">(String email)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateUserInfoByEmail</span><span class="params">(UserInfo bean, String email)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据Email删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteUserInfoByEmail</span><span class="params">(String email)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName查询对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UserInfo <span class="title">getUserInfoByNickName</span><span class="params">(String nickName)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateUserInfoByNickName</span><span class="params">(UserInfo bean, String nickName)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据NickName删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteUserInfoByNickName</span><span class="params">(String nickName)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId查询对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">UserInfo <span class="title">getUserInfoByQqOpenId</span><span class="params">(String qqOpenId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId修改</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateUserInfoByQqOpenId</span><span class="params">(UserInfo bean, String qqOpenId)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据QqOpenId删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Integer <span class="title">deleteUserInfoByQqOpenId</span><span class="params">(String qqOpenId)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">register</span><span class="params">(String email, String nickName, String password, String emailCode)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 登录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">SessionWebUserDto <span class="title">login</span><span class="params">(String email, String password)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 重置密码</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">resetPwd</span><span class="params">(String email, String password, String emailCode)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * qq登录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">SessionWebUserDto <span class="title">qqLogin</span><span class="params">(String code)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户状态</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updateUserStatus</span><span class="params">(String userId, Integer status)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 修改用户存储总空间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">changeUserSpace</span><span class="params">(String userId, Integer changeSpace)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="task包"><a href="#task包" class="headerlink" title="task包"></a>task包</h2><h3 id="FileCleanTask类"><a href="#FileCleanTask类" class="headerlink" title="FileCleanTask类"></a>FileCleanTask类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.task;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.FileDelFlagEnums;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.po.FileInfo;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.query.FileInfoQuery;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.service.FileInfoService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 定时检查和删除过期的文件</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-06-03 12:58</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileCleanTask</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> FileInfoService fileInfoService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 定时任务的执行方法，每天凌晨执行一次，查询出所有过期的文件并删除</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0 0 0 * * ?&quot;)</span> <span class="comment">// 定义一个定时任务，每天凌晨执行一次</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FileInfoQuery fileInfoQuery = <span class="keyword">new</span> FileInfoQuery();</span><br><span class="line">        fileInfoQuery.setDelFlag(FileDelFlagEnums.RECYCLE.getFlag());</span><br><span class="line">        <span class="comment">//需要查询过期的文件 在xml里的sql语句有进行处理 判断回收时间是否小于当前时间减去10天</span></span><br><span class="line">        fileInfoQuery.setQueryExpire(<span class="keyword">true</span>);</span><br><span class="line">        List&lt;FileInfo&gt; fileInfoList = fileInfoService.findListByParam(fileInfoQuery);</span><br><span class="line">        <span class="comment">// 将文件信息列表按用户ID分组，得到一个用户ID和文件信息列表的映射</span></span><br><span class="line">        Map&lt;String, List&lt;FileInfo&gt;&gt; fileInfoMap = fileInfoList.stream().collect(Collectors.groupingBy(FileInfo::getUserId));</span><br><span class="line">        <span class="comment">// 遍历每个用户ID和文件信息列表的映射，进行处理</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, List&lt;FileInfo&gt;&gt; entry : fileInfoMap.entrySet()) &#123;</span><br><span class="line">            String userId = entry.getKey();</span><br><span class="line">            <span class="comment">// 需要删除的文件信息列表</span></span><br><span class="line">            List&lt;String&gt; fileIds = entry.getValue().stream().map(p -&gt; p.getFileId()).collect(Collectors.toList());</span><br><span class="line">            <span class="comment">// 删除回收站中的文件</span></span><br><span class="line">            fileInfoService.batchDelFile(userId, String.join(<span class="string">&quot;,&quot;</span>, fileIds), <span class="keyword">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="utils包"><a href="#utils包" class="headerlink" title="utils包"></a>utils包</h2><h3 id="CopyTools类"><a href="#CopyTools类" class="headerlink" title="CopyTools类"></a>CopyTools类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 复制工具类</span></span><br><span class="line"><span class="comment"> * 提供一些复制对象或列表的方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 21:10</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CopyTools</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 复制列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sList  源列表</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetClass 目标类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 目标列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, S&gt; <span class="function">List&lt;T&gt; <span class="title">copyList</span><span class="params">(List&lt;S&gt; sList, Class&lt;T&gt; targetClass)</span> </span>&#123;</span><br><span class="line">        List&lt;T&gt; list = <span class="keyword">new</span> ArrayList&lt;T&gt;();</span><br><span class="line">        <span class="keyword">for</span> (S s : sList) &#123;</span><br><span class="line">            T t = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                t = targetClass.newInstance();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            BeanUtils.copyProperties(s, t);</span><br><span class="line">            list.add(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 复制对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s      源对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetClass 目标类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 目标对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T, S&gt; <span class="function">T <span class="title">copy</span><span class="params">(S s, Class&lt;T&gt; targetClass)</span> </span>&#123;</span><br><span class="line">        T t = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t = targetClass.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        BeanUtils.copyProperties(s, t);</span><br><span class="line">        <span class="keyword">return</span> t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="CreateImageCodeTools类"><a href="#CreateImageCodeTools类" class="headerlink" title="CreateImageCodeTools类"></a>CreateImageCodeTools类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.OutputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 生成图片验证码工具类</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 20:47</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateImageCodeTools</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 图片的宽度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> width = <span class="number">160</span>;</span><br><span class="line">    <span class="comment">// 图片的高度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height = <span class="number">40</span>;</span><br><span class="line">    <span class="comment">// 验证码字符个数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> codeCount = <span class="number">4</span>;</span><br><span class="line">    <span class="comment">// 验证码干扰线数</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> lineCount = <span class="number">20</span>;</span><br><span class="line">    <span class="comment">// 验证码</span></span><br><span class="line">    <span class="keyword">private</span> String code = <span class="keyword">null</span>;</span><br><span class="line">    <span class="comment">// 验证码图片Buffer</span></span><br><span class="line">    <span class="keyword">private</span> BufferedImage buffImg = <span class="keyword">null</span>;</span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CreateImageCodeTools</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        creatImage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CreateImageCodeTools</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">        creatImage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CreateImageCodeTools</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> codeCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">        <span class="keyword">this</span>.codeCount = codeCount;</span><br><span class="line">        creatImage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CreateImageCodeTools</span><span class="params">(<span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> codeCount, <span class="keyword">int</span> lineCount)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.width = width;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">        <span class="keyword">this</span>.codeCount = codeCount;</span><br><span class="line">        <span class="keyword">this</span>.lineCount = lineCount;</span><br><span class="line">        creatImage();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成图片</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">creatImage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> fontWidth = width / codeCount;<span class="comment">// 字体的宽度</span></span><br><span class="line">        <span class="keyword">int</span> fontHeight = height - <span class="number">5</span>;<span class="comment">// 字体的高度</span></span><br><span class="line">        <span class="keyword">int</span> codeY = height - <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 图像buffer</span></span><br><span class="line">        buffImg = <span class="keyword">new</span> BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        Graphics g = buffImg.getGraphics();</span><br><span class="line">        <span class="comment">//Graphics2D g = buffImg.createGraphics();</span></span><br><span class="line">        <span class="comment">// 设置背景色</span></span><br><span class="line">        g.setColor(getRandColor(<span class="number">200</span>, <span class="number">250</span>));</span><br><span class="line">        g.fillRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</span><br><span class="line">        <span class="comment">// 设置字体</span></span><br><span class="line">        <span class="comment">//Font font1 = getFont(fontHeight);</span></span><br><span class="line">        Font font = <span class="keyword">new</span> Font(<span class="string">&quot;Fixedsys&quot;</span>, Font.BOLD, fontHeight);</span><br><span class="line">        g.setFont(font);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置干扰线</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; lineCount; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> xs = random.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> ys = random.nextInt(height);</span><br><span class="line">            <span class="keyword">int</span> xe = xs + random.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> ye = ys + random.nextInt(height);</span><br><span class="line">            g.setColor(getRandColor(<span class="number">1</span>, <span class="number">255</span>));</span><br><span class="line">            g.drawLine(xs, ys, xe, ye);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加噪点</span></span><br><span class="line">        <span class="keyword">float</span> yawpRate = <span class="number">0.01f</span>;<span class="comment">// 噪声率</span></span><br><span class="line">        <span class="keyword">int</span> area = (<span class="keyword">int</span>) (yawpRate * width * height);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; area; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> x = random.nextInt(width);</span><br><span class="line">            <span class="keyword">int</span> y = random.nextInt(height);</span><br><span class="line">            buffImg.setRGB(x, y, random.nextInt(<span class="number">255</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        String str1 = randomStr(codeCount);<span class="comment">// 得到随机字符</span></span><br><span class="line">        <span class="keyword">this</span>.code = str1;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; codeCount; i++) &#123;</span><br><span class="line">            String strRand = str1.substring(i, i + <span class="number">1</span>);</span><br><span class="line">            g.setColor(getRandColor(<span class="number">1</span>, <span class="number">255</span>));</span><br><span class="line">            <span class="comment">// g.drawString(a,x,y);</span></span><br><span class="line">            <span class="comment">// a为要画出来的东西，x和y表示要画的东西最左侧字符的基线位于此图形上下文坐标系的 (x, y) 位置处</span></span><br><span class="line"></span><br><span class="line">            g.drawString(strRand, i * fontWidth + <span class="number">3</span>, codeY);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 得到随机字符</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> n</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">randomStr</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        String str1 = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890&quot;</span>;</span><br><span class="line">        String str2 = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">int</span> len = str1.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">double</span> r;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            r = (Math.random()) * len;</span><br><span class="line">            str2 = str2 + str1.charAt((<span class="keyword">int</span>) r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> str2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生成随机颜色</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fc</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bc</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Color <span class="title">getRandColor</span><span class="params">(<span class="keyword">int</span> fc, <span class="keyword">int</span> bc)</span> </span>&#123;<span class="comment">// 给定范围获得随机颜色</span></span><br><span class="line">        <span class="keyword">if</span> (fc &gt; <span class="number">255</span>) fc = <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">if</span> (bc &gt; <span class="number">255</span>) bc = <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">int</span> r = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">int</span> g = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">int</span> b = fc + random.nextInt(bc - fc);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Color(r, g, b);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 产生随机字体</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Font <span class="title">getFont</span><span class="params">(<span class="keyword">int</span> size)</span> </span>&#123;</span><br><span class="line">        Random random = <span class="keyword">new</span> Random();</span><br><span class="line">        Font font[] = <span class="keyword">new</span> Font[<span class="number">5</span>];</span><br><span class="line">        font[<span class="number">0</span>] = <span class="keyword">new</span> Font(<span class="string">&quot;Ravie&quot;</span>, Font.PLAIN, size);</span><br><span class="line">        font[<span class="number">1</span>] = <span class="keyword">new</span> Font(<span class="string">&quot;Antique Olive Compact&quot;</span>, Font.PLAIN, size);</span><br><span class="line">        font[<span class="number">2</span>] = <span class="keyword">new</span> Font(<span class="string">&quot;Fixedsys&quot;</span>, Font.PLAIN, size);</span><br><span class="line">        font[<span class="number">3</span>] = <span class="keyword">new</span> Font(<span class="string">&quot;Wide Latin&quot;</span>, Font.PLAIN, size);</span><br><span class="line">        font[<span class="number">4</span>] = <span class="keyword">new</span> Font(<span class="string">&quot;Gill Sans Ultra Bold&quot;</span>, Font.PLAIN, size);</span><br><span class="line">        <span class="keyword">return</span> font[random.nextInt(<span class="number">5</span>)];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 扭曲图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> g     图形对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w1    图片的宽度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h1    图片的高度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color 扭曲的颜色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shear</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line">        shearX(g, w1, h1, color);</span><br><span class="line">        shearY(g, w1, h1, color);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在水平方向上扭曲图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> g     图形对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w1    图片的宽度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h1    图片的高度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color 扭曲的颜色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shearX</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> period = random.nextInt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> borderGap = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> frames = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> phase = random.nextInt(<span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; h1; i++) &#123;</span><br><span class="line">            <span class="keyword">double</span> d = (<span class="keyword">double</span>) (period &gt;&gt; <span class="number">1</span>) * Math.sin((<span class="keyword">double</span>) i / (<span class="keyword">double</span>) period + (<span class="number">6.2831853071795862D</span> * (<span class="keyword">double</span>) phase) / (<span class="keyword">double</span>) frames);</span><br><span class="line">            g.copyArea(<span class="number">0</span>, i, w1, <span class="number">1</span>, (<span class="keyword">int</span>) d, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">                g.setColor(color);</span><br><span class="line">                g.drawLine((<span class="keyword">int</span>) d, i, <span class="number">0</span>, i);</span><br><span class="line">                g.drawLine((<span class="keyword">int</span>) d + w1, i, w1, i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在垂直方向上扭曲图片</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> g     图形对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> w1    图片的宽度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> h1    图片的高度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> color 扭曲的颜色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">shearY</span><span class="params">(Graphics g, <span class="keyword">int</span> w1, <span class="keyword">int</span> h1, Color color)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> period = random.nextInt(<span class="number">40</span>) + <span class="number">10</span>; <span class="comment">// 50;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">boolean</span> borderGap = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">int</span> frames = <span class="number">20</span>;</span><br><span class="line">        <span class="keyword">int</span> phase = <span class="number">7</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w1; i++) &#123;</span><br><span class="line">            <span class="keyword">double</span> d = (<span class="keyword">double</span>) (period &gt;&gt; <span class="number">1</span>) * Math.sin((<span class="keyword">double</span>) i / (<span class="keyword">double</span>) period + (<span class="number">6.2831853071795862D</span> * (<span class="keyword">double</span>) phase) / (<span class="keyword">double</span>) frames);</span><br><span class="line">            g.copyArea(i, <span class="number">0</span>, <span class="number">1</span>, h1, <span class="number">0</span>, (<span class="keyword">int</span>) d);</span><br><span class="line">            <span class="keyword">if</span> (borderGap) &#123;</span><br><span class="line">                g.setColor(color);</span><br><span class="line">                g.drawLine(i, (<span class="keyword">int</span>) d, i, <span class="number">0</span>);</span><br><span class="line">                g.drawLine(i, (<span class="keyword">int</span>) d + h1, i, h1);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 写入图片到输出流</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> sos 输出流对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException 如果写入失败，抛出异常</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(OutputStream sos)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ImageIO.write(buffImg, <span class="string">&quot;png&quot;</span>, sos);</span><br><span class="line">        sos.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BufferedImage <span class="title">getBuffImg</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> buffImg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> code.toLowerCase();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="DateUtil类"><a href="#DateUtil类" class="headerlink" title="DateUtil类"></a>DateUtil类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.ParseException;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 日期工具类，封装了一些常用的日期格式化和解析操作</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 22:22</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DateUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object lockObj = <span class="keyword">new</span> Object();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, ThreadLocal&lt;SimpleDateFormat&gt;&gt; sdfMap = <span class="keyword">new</span> HashMap&lt;String, ThreadLocal&lt;SimpleDateFormat&gt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> SimpleDateFormat <span class="title">getSdf</span><span class="params">(<span class="keyword">final</span> String pattern)</span> </span>&#123;</span><br><span class="line">        ThreadLocal&lt;SimpleDateFormat&gt; tl = sdfMap.get(pattern);</span><br><span class="line">        <span class="keyword">if</span> (tl == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lockObj) &#123;</span><br><span class="line">                tl = sdfMap.get(pattern);</span><br><span class="line">                <span class="keyword">if</span> (tl == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    tl = <span class="keyword">new</span> ThreadLocal&lt;SimpleDateFormat&gt;() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="function"><span class="keyword">protected</span> SimpleDateFormat <span class="title">initialValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> <span class="keyword">new</span> SimpleDateFormat(pattern);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;;</span><br><span class="line">                    sdfMap.put(pattern, tl);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> tl.get();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据模式格式化日期对象为字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> date    日期对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pattern 模式，例如&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 格式化后的字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">format</span><span class="params">(Date date, String pattern)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getSdf(pattern).format(date);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据模式解析字符串为日期对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> dateStr 字符串，例如&quot;2022-12-31 23:59:59&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pattern 模式，例如&quot;yyyy-MM-dd HH:mm:ss&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 解析后的日期对象，如果解析失败，返回当前日期</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">parse</span><span class="params">(String dateStr, String pattern)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getSdf(pattern).parse(dateStr);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ParseException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Date();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定天数后的日期对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> day 天数，可以为正数或负数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 指定天数后的日期对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Date <span class="title">getAfterDate</span><span class="params">(Integer day)</span> </span>&#123;</span><br><span class="line">        Calendar calendar = Calendar.getInstance();</span><br><span class="line">        calendar.add(Calendar.DAY_OF_YEAR, day);</span><br><span class="line">        <span class="keyword">return</span> calendar.getTime();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="JsonUtils类"><a href="#JsonUtils类" class="headerlink" title="JsonUtils类"></a>JsonUtils类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> Json工具类，提供对象和json字符串之间的转换方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 21:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JsonUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(JsonUtils.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将对象转换为json字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> obj 要转换的对象</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> json字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">convertObj2Json</span><span class="params">(Object obj)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JSON.toJSONString(obj);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将json字符串转换为对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> json        要转换的json字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetClass 目标对象的类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;         目标对象的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 转换后的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">T <span class="title">convertJson2Obj</span><span class="params">(String json, Class&lt;T&gt; targetClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JSONObject.parseObject(json, targetClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将json数组字符串转换为列表</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> json        要转换的json数组字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetClass 列表元素的类</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> &lt;T&gt;         列表元素的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 转换后的列表</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">convertJsonArray2List</span><span class="params">(String json, Class&lt;T&gt; targetClass)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JSONArray.parseArray(json, targetClass);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="OKHttpUtils类"><a href="#OKHttpUtils类" class="headerlink" title="OKHttpUtils类"></a>OKHttpUtils类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.ResponseCodeEnum;</span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> okhttp3.*;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.ConnectException;</span><br><span class="line"><span class="keyword">import</span> java.net.SocketTimeoutException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> OKHttp工具类，提供发送GET和POST请求的方法</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 21:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OKHttpUtils</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 请求超时时间5秒</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TIME_OUT_SECONDS = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Logger logger = LoggerFactory.getLogger(OKHttpUtils.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取OkHttpClient.Builder对象，设置一些通用的属性，如跟随重定向，重试策略，超时时间等</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> OkHttpClient.Builder对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> OkHttpClient.<span class="function">Builder <span class="title">getClientBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        OkHttpClient.Builder clientBuilder = <span class="keyword">new</span> OkHttpClient.Builder().followRedirects(<span class="keyword">false</span>).retryOnConnectionFailure(<span class="keyword">false</span>);</span><br><span class="line">        clientBuilder.connectTimeout(TIME_OUT_SECONDS, TimeUnit.SECONDS).readTimeout(TIME_OUT_SECONDS, TimeUnit.SECONDS);</span><br><span class="line">        <span class="keyword">return</span> clientBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取Request.Builder对象，并根据header参数设置请求头信息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> header 请求头参数，键值对形式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Request.Builder对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Request.<span class="function">Builder <span class="title">getRequestBuilder</span><span class="params">(Map&lt;String, String&gt; header)</span> </span>&#123;</span><br><span class="line">        Request.Builder requestBuilder = <span class="keyword">new</span> Request.Builder();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> != header) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; map : header.entrySet()) &#123;</span><br><span class="line">                String key = map.getKey();</span><br><span class="line">                String value;</span><br><span class="line">                <span class="keyword">if</span> (map.getValue() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    value = map.getValue();</span><br><span class="line">                &#125;</span><br><span class="line">                requestBuilder.addHeader(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> requestBuilder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取FormBody.Builder对象，并根据params参数设置表单数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params 表单参数，键值对形式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> FormBody.Builder对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> FormBody.<span class="function">Builder <span class="title">getBuilder</span><span class="params">(Map&lt;String, String&gt; params)</span> </span>&#123;</span><br><span class="line">        FormBody.Builder builder = <span class="keyword">new</span> FormBody.Builder();</span><br><span class="line">        <span class="keyword">if</span> (params == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> builder;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; map : params.entrySet()) &#123;</span><br><span class="line">            String key = map.getKey();</span><br><span class="line">            String value;</span><br><span class="line">            <span class="keyword">if</span> (map.getValue() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                value = map.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">            builder.add(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> builder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送GET请求，并返回响应结果字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url 请求地址，包含查询参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应结果字符串，如果发生异常，则返回null或者抛出BusinessException异常提示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getRequest</span><span class="params">(String url)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        ResponseBody responseBody = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获取OkHttpClient.Builder对象，并构建OkHttpClient对象</span></span><br><span class="line">            OkHttpClient.Builder clientBuilder = getClientBuilder();</span><br><span class="line">            <span class="comment">//获取Request.Builder对象，并构建Request对象，设置请求地址和请求方法为GET</span></span><br><span class="line">            Request.Builder requestBuilder = getRequestBuilder(<span class="keyword">null</span>);</span><br><span class="line">            OkHttpClient client = clientBuilder.build();</span><br><span class="line">            Request request = requestBuilder.url(url).build();</span><br><span class="line">            <span class="comment">//发送请求，并获取响应对象Response，从中获取响应体ResponseBody，并转换为字符串responseStr返回</span></span><br><span class="line">            Response response = client.newCall(request).execute();</span><br><span class="line">            responseBody = response.body();</span><br><span class="line">            String responseStr = responseBody.string();</span><br><span class="line">            logger.info(<span class="string">&quot;postRequest请求地址:&#123;&#125;,返回信息:&#123;&#125;&quot;</span>, url, responseStr);</span><br><span class="line">            <span class="keyword">return</span> responseStr;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SocketTimeoutException | ConnectException e) &#123;</span><br><span class="line">            <span class="comment">//如果发生超时或者连接异常，则记录日志并抛出BusinessException异常提示500错误码（服务器内部错误）</span></span><br><span class="line">            logger.error(<span class="string">&quot;OKhttp POST 请求超时,url:&#123;&#125;&quot;</span>, url, e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_500);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//如果发生其他异常，则记录日志并返回null值</span></span><br><span class="line">            logger.error(<span class="string">&quot;OKhttp GET 请求异常&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//最后关闭响应体资源，避免内存泄漏</span></span><br><span class="line">            <span class="keyword">if</span> (responseBody != <span class="keyword">null</span>) &#123;</span><br><span class="line">                responseBody.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 发送POST请求，并返回响应结果字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> url    请求地址，不包含查询参数</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> params 表单参数，键值对形式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 响应结果字符串，如果发生异常，则返回null或者抛出BusinessException异常提示</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">postRequest</span><span class="params">(String url, Map&lt;String, String&gt; params)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        ResponseBody body = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (params == <span class="keyword">null</span>) &#123;</span><br><span class="line">                params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//获取OkHttpClient.Builder对象，并构建OkHttpClient对象</span></span><br><span class="line">            OkHttpClient.Builder clientBuilder =</span><br><span class="line">                    <span class="keyword">new</span> OkHttpClient.Builder().followRedirects(<span class="keyword">false</span>).retryOnConnectionFailure(<span class="keyword">false</span>);</span><br><span class="line">            clientBuilder.connectTimeout(TIME_OUT_SECONDS, TimeUnit.SECONDS).readTimeout(TIME_OUT_SECONDS, TimeUnit.SECONDS);</span><br><span class="line">            OkHttpClient client = clientBuilder.build();</span><br><span class="line">            <span class="comment">//获取FormBody.Builder对象，并根据params参数设置表单数据，并构建RequestBody对象requestBody作为请求体数据</span></span><br><span class="line">            FormBody.Builder builder = <span class="keyword">new</span> FormBody.Builder();</span><br><span class="line">            RequestBody requestBody = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; map : params.entrySet()) &#123;</span><br><span class="line">                String key = map.getKey();</span><br><span class="line">                String value;</span><br><span class="line">                <span class="keyword">if</span> (map.getValue() == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    value = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    value = map.getValue();</span><br><span class="line">                &#125;</span><br><span class="line">                builder.add(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            requestBody = builder.build();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取Request.Builder对象，并构建Request对象，设置请求地址和请求方法为POST，并设置请求体数据requestBody</span></span><br><span class="line">            Request.Builder requestBuilder = <span class="keyword">new</span> Request.Builder();</span><br><span class="line">            Request request = requestBuilder.url(url).post(requestBody).build();</span><br><span class="line">            <span class="comment">//发送请求，并获取响应对象Response，从中获取响应体ResponseBody，并转换为字符串responseStr返回</span></span><br><span class="line">            Response response = client.newCall(request).execute();</span><br><span class="line">            body = response.body();</span><br><span class="line">            String responseStr = body.string();</span><br><span class="line">            logger.info(<span class="string">&quot;postRequest请求地址:&#123;&#125;,参数:&#123;&#125;,返回信息:&#123;&#125;&quot;</span>, url, JsonUtils.convertObj2Json(params), responseStr);</span><br><span class="line">            <span class="keyword">return</span> responseStr;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SocketTimeoutException | ConnectException e) &#123;</span><br><span class="line">            <span class="comment">//如果发生超时或者连接异常，则记录日志并抛出BusinessException异常提示500错误码（服务器内部错误）</span></span><br><span class="line">            logger.error(<span class="string">&quot;OKhttp POST 请求超时,url:&#123;&#125;,请求参数：&#123;&#125;&quot;</span>, url, JsonUtils.convertObj2Json(params), e);</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(ResponseCodeEnum.CODE_500);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//如果发生其他异常，则记录日志并返回null值</span></span><br><span class="line">            logger.error(<span class="string">&quot;OKhttp POST 请求异常,url:&#123;&#125;,请求参数：&#123;&#125;&quot;</span>, url, JsonUtils.convertObj2Json(params), e);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//最后关闭响应体资源，避免内存泄漏</span></span><br><span class="line">            <span class="keyword">if</span> (body != <span class="keyword">null</span>) &#123;</span><br><span class="line">                body.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ProcessUtils类"><a href="#ProcessUtils类" class="headerlink" title="ProcessUtils类"></a>ProcessUtils类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.exception.BusinessException;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 视频处理工具类</span></span><br><span class="line"><span class="comment"> * 用于执行命令行指令，并获取执行结果。它主要用于调用ffmpeg工具对视频进行转码和切割。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 16:18</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(ProcessUtils.class);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">executeCommand</span><span class="params">(String cmd, Boolean outPrintLog)</span> <span class="keyword">throws</span> BusinessException </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringTools.isEmpty(cmd)) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;--- 指令执行失败，因为要执行的FFmpeg指令为空！ ---&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Runtime runtime = Runtime.getRuntime();</span><br><span class="line">        Process process = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            process = Runtime.getRuntime().exec(cmd);</span><br><span class="line">            <span class="comment">// 执行ffmpeg指令</span></span><br><span class="line">            <span class="comment">// 取出输出流和错误流的信息</span></span><br><span class="line">            <span class="comment">// 注意：必须要取出ffmpeg在执行命令过程中产生的输出信息，如果不取的话当输出流信息填满jvm存储输出留信息的缓冲区时，线程就回阻塞住</span></span><br><span class="line">            PrintStream errorStream = <span class="keyword">new</span> PrintStream(process.getErrorStream());</span><br><span class="line">            PrintStream inputStream = <span class="keyword">new</span> PrintStream(process.getInputStream());</span><br><span class="line">            errorStream.start();</span><br><span class="line">            inputStream.start();</span><br><span class="line">            <span class="comment">// 等待ffmpeg命令执行完</span></span><br><span class="line">            process.waitFor();</span><br><span class="line">            <span class="comment">// 获取执行结果字符串</span></span><br><span class="line">            String result = errorStream.stringBuffer.append(inputStream.stringBuffer + <span class="string">&quot;\n&quot;</span>).toString();</span><br><span class="line">            <span class="comment">// 输出执行的命令信息</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (outPrintLog) &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;执行命令:&#123;&#125;，已执行完毕,执行结果:&#123;&#125;&quot;</span>, cmd, result);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                logger.info(<span class="string">&quot;执行命令:&#123;&#125;，已执行完毕&quot;</span>, cmd);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// logger.error(&quot;执行命令失败:&#123;&#125; &quot;, e.getMessage());</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BusinessException(<span class="string">&quot;视频转换失败&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != process) &#123;</span><br><span class="line">                ProcessKiller ffmpegKiller = <span class="keyword">new</span> ProcessKiller(process);</span><br><span class="line">                runtime.addShutdownHook(ffmpegKiller);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在程序退出前结束已有的FFmpeg进程</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessKiller</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Process process;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">ProcessKiller</span><span class="params">(Process process)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.process = process;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.process.destroy();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于取出ffmpeg线程执行过程中产生的各种输出和错误流的信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintStream</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        InputStream inputStream = <span class="keyword">null</span>;</span><br><span class="line">        BufferedReader bufferedReader = <span class="keyword">null</span>;</span><br><span class="line">        StringBuffer stringBuffer = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PrintStream</span><span class="params">(InputStream inputStream)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.inputStream = inputStream;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">null</span> == inputStream) &#123;</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">                String line = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">while</span> ((line = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    stringBuffer.append(line);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                logger.error(<span class="string">&quot;读取输入流出错了！错误信息：&quot;</span> + e.getMessage());</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">null</span> != bufferedReader) &#123;</span><br><span class="line">                        bufferedReader.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="keyword">null</span> != inputStream) &#123;</span><br><span class="line">                        inputStream.close();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                    logger.error(<span class="string">&quot;调用PrintStream读取输出流后，关闭流时出错！&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ScaleFilter类"><a href="#ScaleFilter类" class="headerlink" title="ScaleFilter类"></a>ScaleFilter类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 图片和视频缩放工具类</span></span><br><span class="line"><span class="comment"> * 用于对图片和视频进行缩放和生成缩略图。它主要用于提高文件的预览效果和节省存储空间。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-28 16:24</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScaleFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(ScaleFilter.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Boolean <span class="title">createThumbnailWidthFFmpeg</span><span class="params">(File file, <span class="keyword">int</span> thumbnailWidth, File targetFile, Boolean delSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            BufferedImage src = ImageIO.read(file);</span><br><span class="line">            <span class="comment">//thumbnailWidth 缩略图的宽度   thumbnailHeight 缩略图的高度</span></span><br><span class="line">            <span class="keyword">int</span> sorceW = src.getWidth();</span><br><span class="line">            <span class="keyword">int</span> sorceH = src.getHeight();</span><br><span class="line">            <span class="comment">//小于 指定高宽不压缩</span></span><br><span class="line">            <span class="keyword">if</span> (sorceW &lt;= thumbnailWidth) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            compressImage(file, thumbnailWidth, targetFile, delSource);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compressImageWidthPercentage</span><span class="params">(File sourceFile, BigDecimal widthPercentage, File targetFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            BigDecimal widthResult = widthPercentage.multiply(<span class="keyword">new</span> BigDecimal(ImageIO.read(sourceFile).getWidth()));</span><br><span class="line">            compressImage(sourceFile, widthResult.intValue(), targetFile, <span class="keyword">true</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;压缩图片失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">createCover4Video</span><span class="params">(File sourceFile, Integer width, File targetFile)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String cmd = <span class="string">&quot;ffmpeg -i %s -y -vframes 1 -vf scale=%d:%d/a %s&quot;</span>;</span><br><span class="line">            ProcessUtils.executeCommand(String.format(cmd, sourceFile.getAbsoluteFile(), width, width, targetFile.getAbsoluteFile()), <span class="keyword">false</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;生成视频封面失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">compressImage</span><span class="params">(File sourceFile, Integer width, File targetFile, Boolean delSource)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String cmd = <span class="string">&quot;ffmpeg -i %s -vf scale=%d:-1 %s -y&quot;</span>;</span><br><span class="line">            ProcessUtils.executeCommand(String.format(cmd, sourceFile.getAbsoluteFile(), width, targetFile.getAbsoluteFile()), <span class="keyword">false</span>);</span><br><span class="line">            <span class="keyword">if</span> (delSource) &#123;</span><br><span class="line">                FileUtils.forceDelete(sourceFile);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            logger.error(<span class="string">&quot;压缩图片失败&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="StringTools类"><a href="#StringTools类" class="headerlink" title="StringTools类"></a>StringTools类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.constants.Constants;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.codec.digest.DigestUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.RandomStringUtils;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 字符串工具类</span></span><br><span class="line"><span class="comment"> * 提供一些字符串相关的操作，如MD5加密，判断空字符串，获取文件后缀，重命名文件，生成随机字符串，转义HTML等</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-26 21:13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringTools</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对字符串进行MD5加密</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> originString 原始字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 加密后的字符串，如果原始字符串为空，则返回null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">encodeByMD5</span><span class="params">(String originString)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StringTools.isEmpty(originString) ? <span class="keyword">null</span> : DigestUtils.md5Hex(originString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断字符串是否为空</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> str 要判断的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true表示为空，false表示不为空</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (str == <span class="keyword">null</span> || <span class="string">&quot;&quot;</span>.equals(str) || <span class="string">&quot;null&quot;</span>.equals(str) || <span class="string">&quot;\u0000&quot;</span>.equals(str)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;&quot;</span>.equals(str.trim())) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件的后缀名</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 后缀名，如果没有后缀，则返回空字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFileSuffix</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        Integer index = fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        String suffix = fileName.substring(index);</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取文件名（不含后缀）</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 文件名（不含后缀），如果没有后缀，则返回原文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getFileNameNoSuffix</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        Integer index = fileName.lastIndexOf(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (index == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> fileName;</span><br><span class="line">        &#125;</span><br><span class="line">        fileName = fileName.substring(<span class="number">0</span>, index);</span><br><span class="line">        <span class="keyword">return</span> fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 对文件名进行重命名，添加一个随机字符串作为后缀</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fileName 文件名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 重命名后的文件名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">rename</span><span class="params">(String fileName)</span> </span>&#123;</span><br><span class="line">        String fileNameReal = getFileNameNoSuffix(fileName);</span><br><span class="line">        String suffix = getFileSuffix(fileName);</span><br><span class="line">        <span class="keyword">return</span> fileNameReal + <span class="string">&quot;_&quot;</span> + getRandomString(Constants.LENGTH_5) + suffix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取一个指定长度的随机字符串，包含字母和数字</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 字符串长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 随机字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">getRandomString</span><span class="params">(Integer count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RandomStringUtils.random(count, <span class="keyword">true</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取一个指定长度的随机数字字符串</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 字符串长度</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 随机数字字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String <span class="title">getRandomNumber</span><span class="params">(Integer count)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> RandomStringUtils.random(count, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转义标题中的特殊字符，如&lt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content 标题内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 转义后的内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">escapeTitle</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty(content)) &#123;</span><br><span class="line">            <span class="keyword">return</span> content;</span><br><span class="line">        &#125;</span><br><span class="line">        content = content.replace(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&amp;lt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 转义HTML中的特殊字符，如&lt;, , \n等</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> content HTML内容</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 转义后的内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">escapeHtml</span><span class="params">(String content)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty(content)) &#123;</span><br><span class="line">            <span class="keyword">return</span> content;</span><br><span class="line">        &#125;</span><br><span class="line">        content = content.replace(<span class="string">&quot;&lt;&quot;</span>, <span class="string">&quot;&amp;lt;&quot;</span>);</span><br><span class="line">        content = content.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&amp;nbsp;&quot;</span>);</span><br><span class="line">        content = content.replace(<span class="string">&quot;\n&quot;</span>, <span class="string">&quot;&lt;br&gt;&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断路径是否合法，即不包含…/或…\等相对路径符号</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path 路径字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true表示合法，false表示不合法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">pathIsOk</span><span class="params">(String path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringTools.isEmpty(path)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (path.contains(<span class="string">&quot;../&quot;</span>) || path.contains(<span class="string">&quot;..\\&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="VerifyUtils类"><a href="#VerifyUtils类" class="headerlink" title="VerifyUtils类"></a>VerifyUtils类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.xcshare.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.xcshare.entity.enums.VerifyRegexEnum;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.regex.Matcher;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> xingchen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> 验证工具类</span></span><br><span class="line"><span class="comment"> * 提供一些字符串的验证功能，如根据正则表达式或枚举类型验证字符串是否符合要求</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span> 2023-05-27 12:45</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VerifyUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据正则表达式验证字符串是否符合要求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> regex 正则表达式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 待验证的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 验证结果，如果字符串为空或不符合正则表达式，则返回false，否则返回true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(String regex, String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (StringTools.isEmpty(value)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Pattern pattern = Pattern.compile(regex);</span><br><span class="line">        Matcher matcher = pattern.matcher(value);</span><br><span class="line">        <span class="keyword">return</span> matcher.matches();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据枚举类型验证字符串是否符合要求</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> regex 枚举类型，包含了一些常用的正则表达式</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 待验证的字符串</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 验证结果，如果字符串为空或不符合枚举类型对应的正则表达式，则返回false，否则返回true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">verify</span><span class="params">(VerifyRegexEnum regex, String value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> verify(regex.getRegex(), value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="resources包"><a href="#resources包" class="headerlink" title="resources包"></a>resources包</h2><h3 id="mappers包-1"><a href="#mappers包-1" class="headerlink" title="mappers包"></a>mappers包</h3><h4 id="EmailCodeMapper-1"><a href="#EmailCodeMapper-1" class="headerlink" title="EmailCodeMapper"></a>EmailCodeMapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.xcshare.mappers.EmailCodeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--实体映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;base_result_map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.xcshare.entity.po.EmailCode&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--邮箱--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--编号--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--创建时间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--0:未使用  1:已使用--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询结果列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_column_list&quot;</span>&gt;</span></span><br><span class="line">        email</span><br><span class="line">        ,code,create_time,status</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition_filed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.email != null and query.email!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and email = #&#123;query.email&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.code != null and query.code!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and code = #&#123;query.code&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.createTime != null and query.createTime!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and  create_time=str_to_date(#&#123;query.createTime&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.status != null&quot;</span>&gt;</span></span><br><span class="line">            and status = #&#123;query.status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通用条件列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询条件列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;query_condition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.emailFuzzy!= null  and query.emailFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and email like concat(&#x27;%&#x27;, #&#123;query.emailFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.codeFuzzy!= null  and query.codeFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and code like concat(&#x27;%&#x27;, #&#123;query.codeFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.createTimeStart!= null and query.createTimeStart!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  create_time&gt;=str_to_date(#&#123;query.createTimeStart&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.createTimeEnd!= null and query.createTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  create_time&lt; date_sub(str_to_date(#&#123;query.createTimeEnd&#125;,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询集合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        FROM email_code</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.orderBy!=null&quot;</span>&gt;</span></span><br><span class="line">            order by $&#123;query.orderBy&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.simplePage!=null&quot;</span>&gt;</span></span><br><span class="line">            limit #&#123;query.simplePage.start&#125;,#&#123;query.simplePage.end&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询数量--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        SELECT count(1) FROM email_code</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入 （匹配有值的字段）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.EmailCode&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO email_code</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email != null&quot;</span>&gt;</span></span><br><span class="line">                email,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code != null&quot;</span>&gt;</span></span><br><span class="line">                code,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime != null&quot;</span>&gt;</span></span><br><span class="line">                create_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.email&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.code&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.createTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入或者更新 （匹配有值的字段）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.EmailCode&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO email_code</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email != null&quot;</span>&gt;</span></span><br><span class="line">                email,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code != null&quot;</span>&gt;</span></span><br><span class="line">                code,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime != null&quot;</span>&gt;</span></span><br><span class="line">                create_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.email&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.code&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.createTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        on DUPLICATE key update</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email!=null&quot;</span>&gt;</span></span><br><span class="line">                email = VALUES(email),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code!=null&quot;</span>&gt;</span></span><br><span class="line">                code = VALUES(code),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime!=null&quot;</span>&gt;</span></span><br><span class="line">                create_time = VALUES(create_time),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                status = VALUES(status),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加 （批量插入）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.EmailCode&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO email_code(</span><br><span class="line">        email,</span><br><span class="line">        code,</span><br><span class="line">        create_time,</span><br><span class="line">        status</span><br><span class="line">        )values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;item.email&#125;,</span><br><span class="line">            #&#123;item.code&#125;,</span><br><span class="line">            #&#123;item.createTime&#125;,</span><br><span class="line">            #&#123;item.status&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 批量新增修改 （批量插入）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdateBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.EmailCode&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO email_code(</span><br><span class="line">        email,</span><br><span class="line">        code,</span><br><span class="line">        create_time,</span><br><span class="line">        status</span><br><span class="line">        )values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;item.email&#125;,</span><br><span class="line">            #&#123;item.code&#125;,</span><br><span class="line">            #&#123;item.createTime&#125;,</span><br><span class="line">            #&#123;item.status&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        on DUPLICATE key update</span><br><span class="line">        email = VALUES(email),</span><br><span class="line">        code = VALUES(code),</span><br><span class="line">        create_time = VALUES(create_time),</span><br><span class="line">        status = VALUES(status)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据EmailAndCode修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByEmailAndCode&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.EmailCode&quot;</span>&gt;</span></span><br><span class="line">        UPDATE email_code</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime != null&quot;</span>&gt;</span></span><br><span class="line">                create_time = #&#123;bean.createTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where email=#&#123;email&#125; and code=#&#123;code&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据EmailAndCode删除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByEmailAndCode&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from email_code</span><br><span class="line">        where email = #&#123;email&#125;</span><br><span class="line">          and code = #&#123;code&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据PrimaryKey获取对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByEmailAndCode&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        from email_code where email=#&#123;email&#125; and code=#&#123;code&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;disableEmailCode&quot;</span>&gt;</span></span><br><span class="line">        update email_code</span><br><span class="line">        set status = 1</span><br><span class="line">        where email = #&#123;email&#125;</span><br><span class="line">          and status = 0</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="FileInfoMapper-1"><a href="#FileInfoMapper-1" class="headerlink" title="FileInfoMapper"></a>FileInfoMapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br><span class="line">739</span><br><span class="line">740</span><br><span class="line">741</span><br><span class="line">742</span><br><span class="line">743</span><br><span class="line">744</span><br><span class="line">745</span><br><span class="line">746</span><br><span class="line">747</span><br><span class="line">748</span><br><span class="line">749</span><br><span class="line">750</span><br><span class="line">751</span><br><span class="line">752</span><br><span class="line">753</span><br><span class="line">754</span><br><span class="line">755</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.xcshare.mappers.FileInfoMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--实体映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;base_result_map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.xcshare.entity.po.FileInfo&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--文件ID--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户ID--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--md5值，第一次上传记录--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_md5&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileMd5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--父级ID--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_pid&quot;</span> <span class="attr">property</span>=<span class="string">&quot;filePid&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--文件大小--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_size&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileSize&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--文件名称--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--封面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_cover&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileCover&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--文件路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_path&quot;</span> <span class="attr">property</span>=<span class="string">&quot;filePath&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--创建时间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;create_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--最后更新时间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_update_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastUpdateTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--0:文件 1:目录--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;folder_type&quot;</span> <span class="attr">property</span>=<span class="string">&quot;folderType&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--1:视频 2:音频  3:图片 4:文档 5:其他--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_category&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileCategory&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1:视频 2:音频  3:图片 4:pdf 5:doc 6:excel 7:txt 8:code 9:zip 10:其他--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_type&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileType&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--0:转码中 1转码失败 2:转码成功--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--回收站时间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;recovery_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;recoveryTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--删除标记 0:删除  1:回收站  2:正常--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;del_flag&quot;</span> <span class="attr">property</span>=<span class="string">&quot;delFlag&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询结果列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_column_list&quot;</span>&gt;</span></span><br><span class="line">        file_id</span><br><span class="line">        ,user_id,file_md5,file_pid,file_size,</span><br><span class="line">		 file_name,file_cover,file_path,create_time,last_update_time,</span><br><span class="line">		 folder_type,file_category,file_type,status,recovery_time,</span><br><span class="line">		 del_flag</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition_filed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileId != null and query.fileId!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and file_id = #&#123;query.fileId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.userId != null and query.userId!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and user_id = #&#123;query.userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileMd5 != null and query.fileMd5!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and file_md5 = #&#123;query.fileMd5&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.filePid != null and query.filePid!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and file_pid = #&#123;query.filePid&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileSize != null&quot;</span>&gt;</span></span><br><span class="line">            and file_size = #&#123;query.fileSize&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileName != null and query.fileName!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and file_name = #&#123;query.fileName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileCover != null and query.fileCover!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and file_cover = #&#123;query.fileCover&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.filePath != null and query.filePath!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and file_path = #&#123;query.filePath&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.createTime != null and query.createTime!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and  create_time=str_to_date(#&#123;query.createTime&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.lastUpdateTime != null and query.lastUpdateTime!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and  last_update_time=str_to_date(#&#123;query.lastUpdateTime&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.folderType != null&quot;</span>&gt;</span></span><br><span class="line">            and folder_type = #&#123;query.folderType&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileCategory != null&quot;</span>&gt;</span></span><br><span class="line">            and file_category = #&#123;query.fileCategory&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileType != null&quot;</span>&gt;</span></span><br><span class="line">            and file_type = #&#123;query.fileType&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.status != null&quot;</span>&gt;</span></span><br><span class="line">            and status = #&#123;query.status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.recoveryTime != null and query.recoveryTime!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and  recovery_time=str_to_date(#&#123;query.recoveryTime&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.delFlag != null&quot;</span>&gt;</span></span><br><span class="line">            and del_flag = #&#123;query.delFlag&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileIdArray!=null and query.fileIdArray.length&gt;0&quot;</span>&gt;</span></span><br><span class="line">            and file_id in(<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;query.fileIdArray&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.filePidArray!=null and query.filePidArray.length&gt;0&quot;</span>&gt;</span></span><br><span class="line">            and file_pid in(<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;query.filePidArray&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.excludeFileIdArray!=null and query.excludeFileIdArray.length&gt;0&quot;</span>&gt;</span></span><br><span class="line">            and file_id not in(<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;query.excludeFileIdArray&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span></span><br><span class="line">            #&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通用条件列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询条件列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;query_condition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileIdFuzzy!= null  and query.fileIdFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and file_id like concat(&#x27;%&#x27;, #&#123;query.fileIdFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.userIdFuzzy!= null  and query.userIdFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and user_id like concat(&#x27;%&#x27;, #&#123;query.userIdFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileMd5Fuzzy!= null  and query.fileMd5Fuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and file_md5 like concat(&#x27;%&#x27;, #&#123;query.fileMd5Fuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.filePidFuzzy!= null  and query.filePidFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and file_pid like concat(&#x27;%&#x27;, #&#123;query.filePidFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileNameFuzzy!= null  and query.fileNameFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and file_name like concat(&#x27;%&#x27;, #&#123;query.fileNameFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileCoverFuzzy!= null  and query.fileCoverFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and file_cover like concat(&#x27;%&#x27;, #&#123;query.fileCoverFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.filePathFuzzy!= null  and query.filePathFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and file_path like concat(&#x27;%&#x27;, #&#123;query.filePathFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.createTimeStart!= null and query.createTimeStart!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  create_time&gt;=str_to_date(#&#123;query.createTimeStart&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.createTimeEnd!= null and query.createTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  create_time&lt; date_sub(str_to_date(#&#123;query.createTimeEnd&#125;,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.lastUpdateTimeStart!= null and query.lastUpdateTimeStart!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  last_update_time&gt;=str_to_date(#&#123;query.lastUpdateTimeStart&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.lastUpdateTimeEnd!= null and query.lastUpdateTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  last_update_time&lt; date_sub(str_to_date(#&#123;query.lastUpdateTimeEnd&#125;,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.recoveryTimeStart!= null and query.recoveryTimeStart!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  recovery_time&gt;=str_to_date(#&#123;query.recoveryTimeStart&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.recoveryTimeEnd!= null and query.recoveryTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  recovery_time&lt; date_sub(str_to_date(#&#123;query.recoveryTimeEnd&#125;,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.queryExpire!=null and query.queryExpire&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[  and recovery_time&lt; date_sub(now(),interval 10 day)]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询集合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.queryNickName!=null and query.queryNickName&quot;</span>&gt;</span></span><br><span class="line">            ,(select nick_name from user_info u where u.user_id = f.user_id) nickName</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        FROM file_info f</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.orderBy!=null&quot;</span>&gt;</span></span><br><span class="line">            order by $&#123;query.orderBy&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.simplePage!=null&quot;</span>&gt;</span></span><br><span class="line">            limit #&#123;query.simplePage.start&#125;,#&#123;query.simplePage.end&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询数量--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        SELECT count(1) FROM file_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入 （匹配有值的字段）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileInfo&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO file_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId != null&quot;</span>&gt;</span></span><br><span class="line">                file_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileMd5 != null&quot;</span>&gt;</span></span><br><span class="line">                file_md5,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePid != null&quot;</span>&gt;</span></span><br><span class="line">                file_pid,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileSize != null&quot;</span>&gt;</span></span><br><span class="line">                file_size,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileName != null&quot;</span>&gt;</span></span><br><span class="line">                file_name,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCover != null&quot;</span>&gt;</span></span><br><span class="line">                file_cover,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePath != null&quot;</span>&gt;</span></span><br><span class="line">                file_path,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime != null&quot;</span>&gt;</span></span><br><span class="line">                create_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastUpdateTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_update_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.folderType != null&quot;</span>&gt;</span></span><br><span class="line">                folder_type,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCategory != null&quot;</span>&gt;</span></span><br><span class="line">                file_category,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileType != null&quot;</span>&gt;</span></span><br><span class="line">                file_type,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.recoveryTime != null&quot;</span>&gt;</span></span><br><span class="line">                recovery_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.delFlag != null&quot;</span>&gt;</span></span><br><span class="line">                del_flag,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileMd5!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileMd5&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePid!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.filePid&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileSize!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileSize&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileName!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCover!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileCover&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePath!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.filePath&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.createTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastUpdateTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.lastUpdateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.folderType!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.folderType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCategory!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileCategory&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileType!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.recoveryTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.recoveryTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.delFlag!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.delFlag&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入或者更新 （匹配有值的字段）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileInfo&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO file_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId != null&quot;</span>&gt;</span></span><br><span class="line">                file_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileMd5 != null&quot;</span>&gt;</span></span><br><span class="line">                file_md5,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePid != null&quot;</span>&gt;</span></span><br><span class="line">                file_pid,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileSize != null&quot;</span>&gt;</span></span><br><span class="line">                file_size,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileName != null&quot;</span>&gt;</span></span><br><span class="line">                file_name,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCover != null&quot;</span>&gt;</span></span><br><span class="line">                file_cover,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePath != null&quot;</span>&gt;</span></span><br><span class="line">                file_path,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime != null&quot;</span>&gt;</span></span><br><span class="line">                create_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastUpdateTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_update_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.folderType != null&quot;</span>&gt;</span></span><br><span class="line">                folder_type,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCategory != null&quot;</span>&gt;</span></span><br><span class="line">                file_category,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileType != null&quot;</span>&gt;</span></span><br><span class="line">                file_type,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.recoveryTime != null&quot;</span>&gt;</span></span><br><span class="line">                recovery_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.delFlag != null&quot;</span>&gt;</span></span><br><span class="line">                del_flag,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileMd5!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileMd5&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePid!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.filePid&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileSize!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileSize&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileName!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCover!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileCover&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePath!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.filePath&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.createTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastUpdateTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.lastUpdateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.folderType!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.folderType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCategory!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileCategory&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileType!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.recoveryTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.recoveryTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.delFlag!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.delFlag&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        on DUPLICATE key update</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId!=null&quot;</span>&gt;</span></span><br><span class="line">                file_id = VALUES(file_id),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                user_id = VALUES(user_id),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileMd5!=null&quot;</span>&gt;</span></span><br><span class="line">                file_md5 = VALUES(file_md5),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePid!=null&quot;</span>&gt;</span></span><br><span class="line">                file_pid = VALUES(file_pid),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileSize!=null&quot;</span>&gt;</span></span><br><span class="line">                file_size = VALUES(file_size),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileName!=null&quot;</span>&gt;</span></span><br><span class="line">                file_name = VALUES(file_name),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCover!=null&quot;</span>&gt;</span></span><br><span class="line">                file_cover = VALUES(file_cover),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePath!=null&quot;</span>&gt;</span></span><br><span class="line">                file_path = VALUES(file_path),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime!=null&quot;</span>&gt;</span></span><br><span class="line">                create_time = VALUES(create_time),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastUpdateTime!=null&quot;</span>&gt;</span></span><br><span class="line">                last_update_time = VALUES(last_update_time),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.folderType!=null&quot;</span>&gt;</span></span><br><span class="line">                folder_type = VALUES(folder_type),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCategory!=null&quot;</span>&gt;</span></span><br><span class="line">                file_category = VALUES(file_category),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileType!=null&quot;</span>&gt;</span></span><br><span class="line">                file_type = VALUES(file_type),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                status = VALUES(status),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.recoveryTime!=null&quot;</span>&gt;</span></span><br><span class="line">                recovery_time = VALUES(recovery_time),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.delFlag!=null&quot;</span>&gt;</span></span><br><span class="line">                del_flag = VALUES(del_flag),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加 （批量插入）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileInfo&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO file_info(</span><br><span class="line">        file_id,</span><br><span class="line">        user_id,</span><br><span class="line">        file_md5,</span><br><span class="line">        file_pid,</span><br><span class="line">        file_size,</span><br><span class="line">        file_name,</span><br><span class="line">        file_cover,</span><br><span class="line">        file_path,</span><br><span class="line">        create_time,</span><br><span class="line">        last_update_time,</span><br><span class="line">        folder_type,</span><br><span class="line">        file_category,</span><br><span class="line">        file_type,</span><br><span class="line">        status,</span><br><span class="line">        recovery_time,</span><br><span class="line">        del_flag</span><br><span class="line">        )values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;item.fileId&#125;,</span><br><span class="line">            #&#123;item.userId&#125;,</span><br><span class="line">            #&#123;item.fileMd5&#125;,</span><br><span class="line">            #&#123;item.filePid&#125;,</span><br><span class="line">            #&#123;item.fileSize&#125;,</span><br><span class="line">            #&#123;item.fileName&#125;,</span><br><span class="line">            #&#123;item.fileCover&#125;,</span><br><span class="line">            #&#123;item.filePath&#125;,</span><br><span class="line">            #&#123;item.createTime&#125;,</span><br><span class="line">            #&#123;item.lastUpdateTime&#125;,</span><br><span class="line">            #&#123;item.folderType&#125;,</span><br><span class="line">            #&#123;item.fileCategory&#125;,</span><br><span class="line">            #&#123;item.fileType&#125;,</span><br><span class="line">            #&#123;item.status&#125;,</span><br><span class="line">            #&#123;item.recoveryTime&#125;,</span><br><span class="line">            #&#123;item.delFlag&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 批量新增修改 （批量插入）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdateBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileInfo&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO file_info(</span><br><span class="line">        file_id,</span><br><span class="line">        user_id,</span><br><span class="line">        file_md5,</span><br><span class="line">        file_pid,</span><br><span class="line">        file_size,</span><br><span class="line">        file_name,</span><br><span class="line">        file_cover,</span><br><span class="line">        file_path,</span><br><span class="line">        create_time,</span><br><span class="line">        last_update_time,</span><br><span class="line">        folder_type,</span><br><span class="line">        file_category,</span><br><span class="line">        file_type,</span><br><span class="line">        status,</span><br><span class="line">        recovery_time,</span><br><span class="line">        del_flag</span><br><span class="line">        )values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;item.fileId&#125;,</span><br><span class="line">            #&#123;item.userId&#125;,</span><br><span class="line">            #&#123;item.fileMd5&#125;,</span><br><span class="line">            #&#123;item.filePid&#125;,</span><br><span class="line">            #&#123;item.fileSize&#125;,</span><br><span class="line">            #&#123;item.fileName&#125;,</span><br><span class="line">            #&#123;item.fileCover&#125;,</span><br><span class="line">            #&#123;item.filePath&#125;,</span><br><span class="line">            #&#123;item.createTime&#125;,</span><br><span class="line">            #&#123;item.lastUpdateTime&#125;,</span><br><span class="line">            #&#123;item.folderType&#125;,</span><br><span class="line">            #&#123;item.fileCategory&#125;,</span><br><span class="line">            #&#123;item.fileType&#125;,</span><br><span class="line">            #&#123;item.status&#125;,</span><br><span class="line">            #&#123;item.recoveryTime&#125;,</span><br><span class="line">            #&#123;item.delFlag&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        on DUPLICATE key update</span><br><span class="line">        file_id = VALUES(file_id),</span><br><span class="line">        user_id = VALUES(user_id),</span><br><span class="line">        file_md5 = VALUES(file_md5),</span><br><span class="line">        file_pid = VALUES(file_pid),</span><br><span class="line">        file_size = VALUES(file_size),</span><br><span class="line">        file_name = VALUES(file_name),</span><br><span class="line">        file_cover = VALUES(file_cover),</span><br><span class="line">        file_path = VALUES(file_path),</span><br><span class="line">        create_time = VALUES(create_time),</span><br><span class="line">        last_update_time = VALUES(last_update_time),</span><br><span class="line">        folder_type = VALUES(folder_type),</span><br><span class="line">        file_category = VALUES(file_category),</span><br><span class="line">        file_type = VALUES(file_type),</span><br><span class="line">        status = VALUES(status),</span><br><span class="line">        recovery_time = VALUES(recovery_time),</span><br><span class="line">        del_flag = VALUES(del_flag)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据FileIdAndUserId修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByFileIdAndUserId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileInfo&quot;</span>&gt;</span></span><br><span class="line">        UPDATE file_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileMd5 != null&quot;</span>&gt;</span></span><br><span class="line">                file_md5 = #&#123;bean.fileMd5&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePid != null&quot;</span>&gt;</span></span><br><span class="line">                file_pid = #&#123;bean.filePid&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileSize != null&quot;</span>&gt;</span></span><br><span class="line">                file_size = #&#123;bean.fileSize&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileName != null&quot;</span>&gt;</span></span><br><span class="line">                file_name = #&#123;bean.fileName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCover != null&quot;</span>&gt;</span></span><br><span class="line">                file_cover = #&#123;bean.fileCover&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePath != null&quot;</span>&gt;</span></span><br><span class="line">                file_path = #&#123;bean.filePath&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime != null&quot;</span>&gt;</span></span><br><span class="line">                create_time = #&#123;bean.createTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastUpdateTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_update_time = #&#123;bean.lastUpdateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.folderType != null&quot;</span>&gt;</span></span><br><span class="line">                folder_type = #&#123;bean.folderType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCategory != null&quot;</span>&gt;</span></span><br><span class="line">                file_category = #&#123;bean.fileCategory&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileType != null&quot;</span>&gt;</span></span><br><span class="line">                file_type = #&#123;bean.fileType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.recoveryTime != null&quot;</span>&gt;</span></span><br><span class="line">                recovery_time = #&#123;bean.recoveryTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.delFlag != null&quot;</span>&gt;</span></span><br><span class="line">                del_flag = #&#123;bean.delFlag&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where file_id=#&#123;fileId&#125; and user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据FileIdAndUserId删除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByFileIdAndUserId&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from file_info</span><br><span class="line">        where file_id = #&#123;fileId&#125;</span><br><span class="line">          and user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据PrimaryKey获取对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByFileIdAndUserId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        from file_info where file_id=#&#123;fileId&#125; and user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUseSpace&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Long&quot;</span>&gt;</span></span><br><span class="line">        select IFNULL(sum(file_size), 0)</span><br><span class="line">        from file_info</span><br><span class="line">        where user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateFileStatusWithOldStatus&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileInfo&quot;</span>&gt;</span></span><br><span class="line">        update file_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileMd5 != null&quot;</span>&gt;</span></span><br><span class="line">                file_md5 = #&#123;bean.fileMd5&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePid != null&quot;</span>&gt;</span></span><br><span class="line">                file_pid = #&#123;bean.filePid&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileSize != null&quot;</span>&gt;</span></span><br><span class="line">                file_size = #&#123;bean.fileSize&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileName != null&quot;</span>&gt;</span></span><br><span class="line">                file_name = #&#123;bean.fileName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCover != null&quot;</span>&gt;</span></span><br><span class="line">                file_cover = #&#123;bean.fileCover&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePath != null&quot;</span>&gt;</span></span><br><span class="line">                file_path = #&#123;bean.filePath&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime != null&quot;</span>&gt;</span></span><br><span class="line">                create_time = #&#123;bean.createTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastUpdateTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_update_time = #&#123;bean.lastUpdateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.folderType != null&quot;</span>&gt;</span></span><br><span class="line">                folder_type = #&#123;bean.folderType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCategory != null&quot;</span>&gt;</span></span><br><span class="line">                file_category = #&#123;bean.fileCategory&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileType != null&quot;</span>&gt;</span></span><br><span class="line">                file_type = #&#123;bean.fileType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.recoveryTime != null&quot;</span>&gt;</span></span><br><span class="line">                recovery_time = #&#123;bean.recoveryTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.delFlag != null&quot;</span>&gt;</span></span><br><span class="line">                del_flag = #&#123;bean.delFlag&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where file_id = #&#123;fileId&#125;</span><br><span class="line">        and user_id = #&#123;userId&#125;</span><br><span class="line">        and status = #&#123;oldStatus&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;batchUpdateFileDelFlag&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileInfo&quot;</span>&gt;</span></span><br><span class="line">        update file_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileMd5 != null&quot;</span>&gt;</span></span><br><span class="line">                file_md5 = #&#123;bean.fileMd5&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePid != null&quot;</span>&gt;</span></span><br><span class="line">                file_pid = #&#123;bean.filePid&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileSize != null&quot;</span>&gt;</span></span><br><span class="line">                file_size = #&#123;bean.fileSize&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileName != null&quot;</span>&gt;</span></span><br><span class="line">                file_name = #&#123;bean.fileName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCover != null&quot;</span>&gt;</span></span><br><span class="line">                file_cover = #&#123;bean.fileCover&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.filePath != null&quot;</span>&gt;</span></span><br><span class="line">                file_path = #&#123;bean.filePath&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.createTime != null&quot;</span>&gt;</span></span><br><span class="line">                create_time = #&#123;bean.createTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastUpdateTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_update_time = #&#123;bean.lastUpdateTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.folderType != null&quot;</span>&gt;</span></span><br><span class="line">                folder_type = #&#123;bean.folderType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileCategory != null&quot;</span>&gt;</span></span><br><span class="line">                file_category = #&#123;bean.fileCategory&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileType != null&quot;</span>&gt;</span></span><br><span class="line">                file_type = #&#123;bean.fileType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.recoveryTime != null&quot;</span>&gt;</span></span><br><span class="line">                recovery_time = #&#123;bean.recoveryTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.delFlag != null&quot;</span>&gt;</span></span><br><span class="line">                del_flag = #&#123;bean.delFlag&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where user_id = #&#123;userId&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;filePidList!=null&quot;</span>&gt;</span></span><br><span class="line">            and file_pid in(<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;filePidList&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;fileIdList!=null&quot;</span>&gt;</span></span><br><span class="line">            and file_id in(<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;fileIdList&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;oldDelFlag!=null&quot;</span>&gt;</span></span><br><span class="line">            and del_flag=#&#123;oldDelFlag&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;batchDelFile&quot;</span>&gt;</span></span><br><span class="line">        delete from file_info</span><br><span class="line">        where user_id = #&#123;userId&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;filePidList!=null&quot;</span>&gt;</span></span><br><span class="line">            and file_pid in(<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;filePidList&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;fileIdList!=null&quot;</span>&gt;</span></span><br><span class="line">            and file_id in(<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;fileIdList&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;oldDelFlag!=null&quot;</span>&gt;</span></span><br><span class="line">            and del_flag=#&#123;oldDelFlag&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteFileByUserId&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from file_info</span><br><span class="line">        where user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="FileShareMapper-1"><a href="#FileShareMapper-1" class="headerlink" title="FileShareMapper"></a>FileShareMapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.xcshare.mappers.FileShareMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--实体映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;base_result_map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.xcshare.entity.po.FileShare&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分享ID--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;share_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;shareId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--文件ID--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户ID--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--有效期类型 0:1天 1:7天 2:30天 3:永久有效--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;valid_type&quot;</span> <span class="attr">property</span>=<span class="string">&quot;validType&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--失效时间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;expire_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;expireTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分享时间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;share_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;shareTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--提取码--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;code&quot;</span> <span class="attr">property</span>=<span class="string">&quot;code&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--浏览次数--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;show_count&quot;</span> <span class="attr">property</span>=<span class="string">&quot;showCount&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--文件名称--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--封面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_cover&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileCover&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--0:文件 1:目录--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;folder_type&quot;</span> <span class="attr">property</span>=<span class="string">&quot;folderType&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--1:视频 2:音频  3:图片 4:文档 5:其他--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_category&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileCategory&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1:视频 2:音频  3:图片 4:pdf 5:doc 6:excel 7:txt 8:code 9:zip 10:其他--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;file_type&quot;</span> <span class="attr">property</span>=<span class="string">&quot;fileType&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询结果列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_column_list&quot;</span>&gt;</span></span><br><span class="line">        share_id</span><br><span class="line">        ,s.file_id,s.user_id,valid_type,expire_time,</span><br><span class="line">		 share_time,code,show_count</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition_filed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.shareId != null and query.shareId!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and share_id = #&#123;query.shareId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileId != null and query.fileId!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and s.file_id = #&#123;query.fileId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.userId != null and query.userId!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and s.user_id = #&#123;query.userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.validType != null&quot;</span>&gt;</span></span><br><span class="line">            and valid_type = #&#123;query.validType&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.expireTime != null and query.expireTime!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and  expire_time=str_to_date(#&#123;query.expireTime&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.shareTime != null and query.shareTime!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and  share_time=str_to_date(#&#123;query.shareTime&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.code != null and query.code!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and code = #&#123;query.code&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.showCount != null&quot;</span>&gt;</span></span><br><span class="line">            and show_count = #&#123;query.showCount&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通用条件列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询条件列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;query_condition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.shareIdFuzzy!= null  and query.shareIdFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and share_id like concat(&#x27;%&#x27;, #&#123;query.shareIdFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.fileIdFuzzy!= null  and query.fileIdFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and s.file_id like concat(&#x27;%&#x27;, #&#123;query.fileIdFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.userIdFuzzy!= null  and query.userIdFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and s.user_id like concat(&#x27;%&#x27;, #&#123;query.userIdFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.expireTimeStart!= null and query.expireTimeStart!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  expire_time&gt;=str_to_date(#&#123;query.expireTimeStart&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.expireTimeEnd!= null and query.expireTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  expire_time&lt; date_sub(str_to_date(#&#123;query.expireTimeEnd&#125;,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.shareTimeStart!= null and query.shareTimeStart!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  share_time&gt;=str_to_date(#&#123;query.shareTimeStart&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.shareTimeEnd!= null and query.shareTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  share_time&lt; date_sub(str_to_date(#&#123;query.shareTimeEnd&#125;,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.codeFuzzy!= null  and query.codeFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and code like concat(&#x27;%&#x27;, #&#123;query.codeFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询集合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.queryFileName!=null and query.queryFileName&quot;</span>&gt;</span></span><br><span class="line">            ,f.file_name,f.folder_type,f.file_category,f.file_type,f.file_cover</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        FROM file_share s</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.queryFileName!=null and query.queryFileName&quot;</span>&gt;</span></span><br><span class="line">            left join file_info f on s.file_id = f.file_id and f.user_id = #&#123;query.userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.orderBy!=null&quot;</span>&gt;</span></span><br><span class="line">            order by $&#123;query.orderBy&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.simplePage!=null&quot;</span>&gt;</span></span><br><span class="line">            limit #&#123;query.simplePage.start&#125;,#&#123;query.simplePage.end&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询数量--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        SELECT count(1) FROM file_share s</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入 （匹配有值的字段）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileShare&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO file_share</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareId != null&quot;</span>&gt;</span></span><br><span class="line">                share_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId != null&quot;</span>&gt;</span></span><br><span class="line">                file_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.validType != null&quot;</span>&gt;</span></span><br><span class="line">                valid_type,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.expireTime != null&quot;</span>&gt;</span></span><br><span class="line">                expire_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareTime != null&quot;</span>&gt;</span></span><br><span class="line">                share_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code != null&quot;</span>&gt;</span></span><br><span class="line">                code,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.showCount != null&quot;</span>&gt;</span></span><br><span class="line">                show_count,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.shareId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.validType!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.validType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.expireTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.expireTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.shareTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.code&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.showCount!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.showCount&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入或者更新 （匹配有值的字段）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileShare&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO file_share</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareId != null&quot;</span>&gt;</span></span><br><span class="line">                share_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId != null&quot;</span>&gt;</span></span><br><span class="line">                file_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.validType != null&quot;</span>&gt;</span></span><br><span class="line">                valid_type,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.expireTime != null&quot;</span>&gt;</span></span><br><span class="line">                expire_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareTime != null&quot;</span>&gt;</span></span><br><span class="line">                share_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code != null&quot;</span>&gt;</span></span><br><span class="line">                code,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.showCount != null&quot;</span>&gt;</span></span><br><span class="line">                show_count,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.shareId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.fileId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.validType!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.validType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.expireTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.expireTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.shareTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.code&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.showCount!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.showCount&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        on DUPLICATE key update</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareId!=null&quot;</span>&gt;</span></span><br><span class="line">                share_id = VALUES(share_id),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId!=null&quot;</span>&gt;</span></span><br><span class="line">                file_id = VALUES(file_id),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                user_id = VALUES(user_id),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.validType!=null&quot;</span>&gt;</span></span><br><span class="line">                valid_type = VALUES(valid_type),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.expireTime!=null&quot;</span>&gt;</span></span><br><span class="line">                expire_time = VALUES(expire_time),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareTime!=null&quot;</span>&gt;</span></span><br><span class="line">                share_time = VALUES(share_time),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code!=null&quot;</span>&gt;</span></span><br><span class="line">                code = VALUES(code),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.showCount!=null&quot;</span>&gt;</span></span><br><span class="line">                show_count = VALUES(show_count),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加 （批量插入）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileShare&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO file_share(</span><br><span class="line">        share_id,</span><br><span class="line">        file_id,</span><br><span class="line">        user_id,</span><br><span class="line">        valid_type,</span><br><span class="line">        expire_time,</span><br><span class="line">        share_time,</span><br><span class="line">        code,</span><br><span class="line">        show_count</span><br><span class="line">        )values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;item.shareId&#125;,</span><br><span class="line">            #&#123;item.fileId&#125;,</span><br><span class="line">            #&#123;item.userId&#125;,</span><br><span class="line">            #&#123;item.validType&#125;,</span><br><span class="line">            #&#123;item.expireTime&#125;,</span><br><span class="line">            #&#123;item.shareTime&#125;,</span><br><span class="line">            #&#123;item.code&#125;,</span><br><span class="line">            #&#123;item.showCount&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 批量新增修改 （批量插入）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdateBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileShare&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO file_share(</span><br><span class="line">        share_id,</span><br><span class="line">        file_id,</span><br><span class="line">        user_id,</span><br><span class="line">        valid_type,</span><br><span class="line">        expire_time,</span><br><span class="line">        share_time,</span><br><span class="line">        code,</span><br><span class="line">        show_count</span><br><span class="line">        )values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;item.shareId&#125;,</span><br><span class="line">            #&#123;item.fileId&#125;,</span><br><span class="line">            #&#123;item.userId&#125;,</span><br><span class="line">            #&#123;item.validType&#125;,</span><br><span class="line">            #&#123;item.expireTime&#125;,</span><br><span class="line">            #&#123;item.shareTime&#125;,</span><br><span class="line">            #&#123;item.code&#125;,</span><br><span class="line">            #&#123;item.showCount&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        on DUPLICATE key update</span><br><span class="line">        share_id = VALUES(share_id),</span><br><span class="line">        file_id = VALUES(file_id),</span><br><span class="line">        user_id = VALUES(user_id),</span><br><span class="line">        valid_type = VALUES(valid_type),</span><br><span class="line">        expire_time = VALUES(expire_time),</span><br><span class="line">        share_time = VALUES(share_time),</span><br><span class="line">        code = VALUES(code),</span><br><span class="line">        show_count = VALUES(show_count)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据ShareId修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByShareId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.FileShare&quot;</span>&gt;</span></span><br><span class="line">        UPDATE file_share</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.fileId != null&quot;</span>&gt;</span></span><br><span class="line">                file_id = #&#123;bean.fileId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id = #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.validType != null&quot;</span>&gt;</span></span><br><span class="line">                valid_type = #&#123;bean.validType&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.expireTime != null&quot;</span>&gt;</span></span><br><span class="line">                expire_time = #&#123;bean.expireTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.shareTime != null&quot;</span>&gt;</span></span><br><span class="line">                share_time = #&#123;bean.shareTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.code != null&quot;</span>&gt;</span></span><br><span class="line">                code = #&#123;bean.code&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.showCount != null&quot;</span>&gt;</span></span><br><span class="line">                show_count = #&#123;bean.showCount&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where share_id=#&#123;shareId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据ShareId删除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByShareId&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from file_share</span><br><span class="line">        where share_id = #&#123;shareId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据PrimaryKey获取对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByShareId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        from file_share s where share_id=#&#123;shareId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;batchDeleteFileShare&quot;</span>&gt;</span></span><br><span class="line">        delete from file_share</span><br><span class="line">        where user_id =#&#123;userId&#125;</span><br><span class="line">        and share_id in(<span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;shareIdList&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span>&gt;</span>#&#123;item&#125;<span class="tag">&lt;/<span class="name">foreach</span>&gt;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateShareShowCount&quot;</span>&gt;</span></span><br><span class="line">        update file_share</span><br><span class="line">        set show_count=show_count + 1</span><br><span class="line">        where share_id = #&#123;shareId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="UserInfoMapper-1"><a href="#UserInfoMapper-1" class="headerlink" title="UserInfoMapper"></a>UserInfoMapper</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.xcshare.mappers.UserInfoMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--实体映射--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;base_result_map&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--用户ID--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--昵称--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;nick_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;nickName&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--邮箱--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--qqOpenID--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;qq_open_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;qqOpenId&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--qq头像--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;qq_avatar&quot;</span> <span class="attr">property</span>=<span class="string">&quot;qqAvatar&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--密码--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;password&quot;</span> <span class="attr">property</span>=<span class="string">&quot;password&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--加入时间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;join_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;joinTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--最后登录时间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;last_login_time&quot;</span> <span class="attr">property</span>=<span class="string">&quot;lastLoginTime&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--0:禁用 1:正常--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;status&quot;</span> <span class="attr">property</span>=<span class="string">&quot;status&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--使用空间单位byte--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;use_space&quot;</span> <span class="attr">property</span>=<span class="string">&quot;useSpace&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--总空间--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;total_space&quot;</span> <span class="attr">property</span>=<span class="string">&quot;totalSpace&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询结果列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_column_list&quot;</span>&gt;</span></span><br><span class="line">        user_id</span><br><span class="line">        ,nick_name,email,qq_open_id,qq_avatar,</span><br><span class="line">		 password,join_time,last_login_time,status,use_space,</span><br><span class="line">		 total_space</span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition_filed&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.userId != null and query.userId!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and user_id = #&#123;query.userId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.nickName != null and query.nickName!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and nick_name = #&#123;query.nickName&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.email != null and query.email!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and email = #&#123;query.email&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.qqOpenId != null and query.qqOpenId!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and qq_open_id = #&#123;query.qqOpenId&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.qqAvatar != null and query.qqAvatar!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and qq_avatar = #&#123;query.qqAvatar&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.password != null and query.password!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            and password = #&#123;query.password&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.joinTime != null and query.joinTime!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and  join_time=str_to_date(#&#123;query.joinTime&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.lastLoginTime != null and query.lastLoginTime!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and  last_login_time=str_to_date(#&#123;query.lastLoginTime&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.status != null&quot;</span>&gt;</span></span><br><span class="line">            and status = #&#123;query.status&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.useSpace != null&quot;</span>&gt;</span></span><br><span class="line">            and use_space = #&#123;query.useSpace&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">            and total_space = #&#123;query.totalSpace&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 通用条件列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;base_condition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通用查询条件列--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;query_condition&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_condition_filed&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.userIdFuzzy!= null  and query.userIdFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and user_id like concat(&#x27;%&#x27;, #&#123;query.userIdFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.nickNameFuzzy!= null  and query.nickNameFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and nick_name like concat(&#x27;%&#x27;, #&#123;query.nickNameFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.emailFuzzy!= null  and query.emailFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and email like concat(&#x27;%&#x27;, #&#123;query.emailFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.qqOpenIdFuzzy!= null  and query.qqOpenIdFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and qq_open_id like concat(&#x27;%&#x27;, #&#123;query.qqOpenIdFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.qqAvatarFuzzy!= null  and query.qqAvatarFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and qq_avatar like concat(&#x27;%&#x27;, #&#123;query.qqAvatarFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.passwordFuzzy!= null  and query.passwordFuzzy!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                and password like concat(&#x27;%&#x27;, #&#123;query.passwordFuzzy&#125;, &#x27;%&#x27;)</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.joinTimeStart!= null and query.joinTimeStart!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  join_time&gt;=str_to_date(#&#123;query.joinTimeStart&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.joinTimeEnd!= null and query.joinTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  join_time&lt; date_sub(str_to_date(#&#123;query.joinTimeEnd&#125;,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.lastLoginTimeStart!= null and query.lastLoginTimeStart!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  last_login_time&gt;=str_to_date(#&#123;query.lastLoginTimeStart&#125;, &#x27;%Y-%m-%d&#x27;) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.lastLoginTimeEnd!= null and query.lastLoginTimeEnd!=&#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">                &lt;![CDATA[ and  last_login_time&lt; date_sub(str_to_date(#&#123;query.lastLoginTimeEnd&#125;,&#x27;%Y-%m-%d&#x27;),interval -1 day) ]]&gt;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询集合--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectList&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        SELECT</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        FROM user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.orderBy!=null&quot;</span>&gt;</span></span><br><span class="line">            order by $&#123;query.orderBy&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;query.simplePage!=null&quot;</span>&gt;</span></span><br><span class="line">            limit #&#123;query.simplePage.start&#125;,#&#123;query.simplePage.end&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 查询数量--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectCount&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">        SELECT count(1) FROM user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_condition&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入 （匹配有值的字段）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.nickName != null&quot;</span>&gt;</span></span><br><span class="line">                nick_name,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email != null&quot;</span>&gt;</span></span><br><span class="line">                email,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqOpenId != null&quot;</span>&gt;</span></span><br><span class="line">                qq_open_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar != null&quot;</span>&gt;</span></span><br><span class="line">                qq_avatar,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password != null&quot;</span>&gt;</span></span><br><span class="line">                password,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime != null&quot;</span>&gt;</span></span><br><span class="line">                join_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_login_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace != null&quot;</span>&gt;</span></span><br><span class="line">                use_space,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">                total_space,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.nickName!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.nickName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.email&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqOpenId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.qqOpenId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.qqAvatar&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.joinTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.lastLoginTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.useSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.totalSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 插入或者更新 （匹配有值的字段）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdate&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;(&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.nickName != null&quot;</span>&gt;</span></span><br><span class="line">                nick_name,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email != null&quot;</span>&gt;</span></span><br><span class="line">                email,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqOpenId != null&quot;</span>&gt;</span></span><br><span class="line">                qq_open_id,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar != null&quot;</span>&gt;</span></span><br><span class="line">                qq_avatar,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password != null&quot;</span>&gt;</span></span><br><span class="line">                password,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime != null&quot;</span>&gt;</span></span><br><span class="line">                join_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_login_time,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace != null&quot;</span>&gt;</span></span><br><span class="line">                use_space,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">                total_space,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;values (&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;)&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.nickName!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.nickName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.email&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqOpenId!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.qqOpenId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.qqAvatar&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.joinTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.lastLoginTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.useSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace!=null&quot;</span>&gt;</span></span><br><span class="line">                #&#123;bean.totalSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">        on DUPLICATE key update</span><br><span class="line">        <span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffix</span>=<span class="string">&quot;&quot;</span> <span class="attr">suffixOverrides</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId!=null&quot;</span>&gt;</span></span><br><span class="line">                user_id = VALUES(user_id),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.nickName!=null&quot;</span>&gt;</span></span><br><span class="line">                nick_name = VALUES(nick_name),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email!=null&quot;</span>&gt;</span></span><br><span class="line">                email = VALUES(email),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqOpenId!=null&quot;</span>&gt;</span></span><br><span class="line">                qq_open_id = VALUES(qq_open_id),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar!=null&quot;</span>&gt;</span></span><br><span class="line">                qq_avatar = VALUES(qq_avatar),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password!=null&quot;</span>&gt;</span></span><br><span class="line">                password = VALUES(password),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime!=null&quot;</span>&gt;</span></span><br><span class="line">                join_time = VALUES(join_time),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime!=null&quot;</span>&gt;</span></span><br><span class="line">                last_login_time = VALUES(last_login_time),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status!=null&quot;</span>&gt;</span></span><br><span class="line">                status = VALUES(status),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace!=null&quot;</span>&gt;</span></span><br><span class="line">                use_space = VALUES(use_space),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace!=null&quot;</span>&gt;</span></span><br><span class="line">                total_space = VALUES(total_space),</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 添加 （批量插入）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO user_info(</span><br><span class="line">        user_id,</span><br><span class="line">        nick_name,</span><br><span class="line">        email,</span><br><span class="line">        qq_open_id,</span><br><span class="line">        qq_avatar,</span><br><span class="line">        password,</span><br><span class="line">        join_time,</span><br><span class="line">        last_login_time,</span><br><span class="line">        status,</span><br><span class="line">        use_space,</span><br><span class="line">        total_space</span><br><span class="line">        )values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;item.userId&#125;,</span><br><span class="line">            #&#123;item.nickName&#125;,</span><br><span class="line">            #&#123;item.email&#125;,</span><br><span class="line">            #&#123;item.qqOpenId&#125;,</span><br><span class="line">            #&#123;item.qqAvatar&#125;,</span><br><span class="line">            #&#123;item.password&#125;,</span><br><span class="line">            #&#123;item.joinTime&#125;,</span><br><span class="line">            #&#123;item.lastLoginTime&#125;,</span><br><span class="line">            #&#123;item.status&#125;,</span><br><span class="line">            #&#123;item.useSpace&#125;,</span><br><span class="line">            #&#123;item.totalSpace&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 批量新增修改 （批量插入）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrUpdateBatch&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        INSERT INTO user_info(</span><br><span class="line">        user_id,</span><br><span class="line">        nick_name,</span><br><span class="line">        email,</span><br><span class="line">        qq_open_id,</span><br><span class="line">        qq_avatar,</span><br><span class="line">        password,</span><br><span class="line">        join_time,</span><br><span class="line">        last_login_time,</span><br><span class="line">        status,</span><br><span class="line">        use_space,</span><br><span class="line">        total_space</span><br><span class="line">        )values</span><br><span class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;item&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">            (</span><br><span class="line">            #&#123;item.userId&#125;,</span><br><span class="line">            #&#123;item.nickName&#125;,</span><br><span class="line">            #&#123;item.email&#125;,</span><br><span class="line">            #&#123;item.qqOpenId&#125;,</span><br><span class="line">            #&#123;item.qqAvatar&#125;,</span><br><span class="line">            #&#123;item.password&#125;,</span><br><span class="line">            #&#123;item.joinTime&#125;,</span><br><span class="line">            #&#123;item.lastLoginTime&#125;,</span><br><span class="line">            #&#123;item.status&#125;,</span><br><span class="line">            #&#123;item.useSpace&#125;,</span><br><span class="line">            #&#123;item.totalSpace&#125;</span><br><span class="line">            )</span><br><span class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        on DUPLICATE key update</span><br><span class="line">        user_id = VALUES(user_id),</span><br><span class="line">        nick_name = VALUES(nick_name),</span><br><span class="line">        email = VALUES(email),</span><br><span class="line">        qq_open_id = VALUES(qq_open_id),</span><br><span class="line">        qq_avatar = VALUES(qq_avatar),</span><br><span class="line">        password = VALUES(password),</span><br><span class="line">        join_time = VALUES(join_time),</span><br><span class="line">        last_login_time = VALUES(last_login_time),</span><br><span class="line">        status = VALUES(status),</span><br><span class="line">        use_space = VALUES(use_space),</span><br><span class="line">        total_space = VALUES(total_space)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据UserId修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByUserId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        UPDATE user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.nickName != null&quot;</span>&gt;</span></span><br><span class="line">                nick_name = #&#123;bean.nickName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email != null&quot;</span>&gt;</span></span><br><span class="line">                email = #&#123;bean.email&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqOpenId != null&quot;</span>&gt;</span></span><br><span class="line">                qq_open_id = #&#123;bean.qqOpenId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar != null&quot;</span>&gt;</span></span><br><span class="line">                qq_avatar = #&#123;bean.qqAvatar&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password != null&quot;</span>&gt;</span></span><br><span class="line">                password = #&#123;bean.password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime != null&quot;</span>&gt;</span></span><br><span class="line">                join_time = #&#123;bean.joinTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_login_time = #&#123;bean.lastLoginTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace != null&quot;</span>&gt;</span></span><br><span class="line">                use_space = #&#123;bean.useSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">                total_space = #&#123;bean.totalSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据UserId删除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByUserId&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from user_info</span><br><span class="line">        where user_id = #&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据PrimaryKey获取对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByUserId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        from user_info where user_id=#&#123;userId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据Email修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByEmail&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        UPDATE user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id = #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.nickName != null&quot;</span>&gt;</span></span><br><span class="line">                nick_name = #&#123;bean.nickName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqOpenId != null&quot;</span>&gt;</span></span><br><span class="line">                qq_open_id = #&#123;bean.qqOpenId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar != null&quot;</span>&gt;</span></span><br><span class="line">                qq_avatar = #&#123;bean.qqAvatar&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password != null&quot;</span>&gt;</span></span><br><span class="line">                password = #&#123;bean.password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime != null&quot;</span>&gt;</span></span><br><span class="line">                join_time = #&#123;bean.joinTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_login_time = #&#123;bean.lastLoginTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace != null&quot;</span>&gt;</span></span><br><span class="line">                use_space = #&#123;bean.useSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">                total_space = #&#123;bean.totalSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where email=#&#123;email&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据Email删除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByEmail&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from user_info</span><br><span class="line">        where email = #&#123;email&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据PrimaryKey获取对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByEmail&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        from user_info where email=#&#123;email&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据NickName修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByNickName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        UPDATE user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id = #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email != null&quot;</span>&gt;</span></span><br><span class="line">                email = #&#123;bean.email&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqOpenId != null&quot;</span>&gt;</span></span><br><span class="line">                qq_open_id = #&#123;bean.qqOpenId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar != null&quot;</span>&gt;</span></span><br><span class="line">                qq_avatar = #&#123;bean.qqAvatar&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password != null&quot;</span>&gt;</span></span><br><span class="line">                password = #&#123;bean.password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime != null&quot;</span>&gt;</span></span><br><span class="line">                join_time = #&#123;bean.joinTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_login_time = #&#123;bean.lastLoginTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace != null&quot;</span>&gt;</span></span><br><span class="line">                use_space = #&#123;bean.useSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">                total_space = #&#123;bean.totalSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where nick_name=#&#123;nickName&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据NickName删除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByNickName&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from user_info</span><br><span class="line">        where nick_name = #&#123;nickName&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据PrimaryKey获取对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByNickName&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        from user_info where nick_name=#&#123;nickName&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据QqOpenId修改--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByQqOpenId&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.xcshare.entity.po.UserInfo&quot;</span>&gt;</span></span><br><span class="line">        UPDATE user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.userId != null&quot;</span>&gt;</span></span><br><span class="line">                user_id = #&#123;bean.userId&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.nickName != null&quot;</span>&gt;</span></span><br><span class="line">                nick_name = #&#123;bean.nickName&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.email != null&quot;</span>&gt;</span></span><br><span class="line">                email = #&#123;bean.email&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.qqAvatar != null&quot;</span>&gt;</span></span><br><span class="line">                qq_avatar = #&#123;bean.qqAvatar&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.password != null&quot;</span>&gt;</span></span><br><span class="line">                password = #&#123;bean.password&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.joinTime != null&quot;</span>&gt;</span></span><br><span class="line">                join_time = #&#123;bean.joinTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.lastLoginTime != null&quot;</span>&gt;</span></span><br><span class="line">                last_login_time = #&#123;bean.lastLoginTime&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.status != null&quot;</span>&gt;</span></span><br><span class="line">                status = #&#123;bean.status&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.useSpace != null&quot;</span>&gt;</span></span><br><span class="line">                use_space = #&#123;bean.useSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bean.totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">                total_space = #&#123;bean.totalSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where qq_open_id=#&#123;qqOpenId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据QqOpenId删除--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteByQqOpenId&quot;</span>&gt;</span></span><br><span class="line">        delete</span><br><span class="line">        from user_info</span><br><span class="line">        where qq_open_id = #&#123;qqOpenId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 根据PrimaryKey获取对象--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByQqOpenId&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;base_result_map&quot;</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;base_column_list&quot;</span>/&gt;</span></span><br><span class="line">        from user_info where qq_open_id=#&#123;qqOpenId&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUserSpace&quot;</span>&gt;</span></span><br><span class="line">        update user_info</span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;useSpace != null&quot;</span>&gt;</span></span><br><span class="line">                use_space = use_space + #&#123;useSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">                total_space = total_space + #&#123;totalSpace&#125;,</span><br><span class="line">            <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        where user_id = #&#123;userId&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;useSpace != null&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and (use_space + #&#123;useSpace&#125;) &lt;= total_space ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;totalSpace != null&quot;</span>&gt;</span></span><br><span class="line">            &lt;![CDATA[ and (total_space + #&#123;totalSpace&#125;) &gt;= use_space ]]&gt;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="logback-spring-xml"><a href="#logback-spring-xml" class="headerlink" title="logback-spring.xml"></a>logback-spring.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;10 minutes&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;stdot&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss,GMT+8&#125; [%p][%c][%M][%L]-&gt; %m%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;log.path&quot;</span> <span class="attr">source</span>=<span class="string">&quot;project.folder&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProperty</span> <span class="attr">scope</span>=<span class="string">&quot;context&quot;</span> <span class="attr">name</span>=<span class="string">&quot;log.root.level&quot;</span> <span class="attr">source</span>=<span class="string">&quot;log.root.level&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_FOLDER&quot;</span> <span class="attr">value</span>=<span class="string">&quot;logs&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_FILE_NAME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;easypan.log&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/$&#123;LOG_FOLDER&#125;/$&#123;LOG_FILE_NAME&#125;<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">FileNamePattern</span>&gt;</span>$&#123;log.path&#125;/$&#123;LOG_FOLDER&#125;/$&#123;LOG_FILE_NAME&#125;.%d&#123;yyyyMMdd&#125;.%i<span class="tag">&lt;/<span class="name">FileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">cleanHistoryOnStart</span>&gt;</span>true<span class="tag">&lt;/<span class="name">cleanHistoryOnStart</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">TimeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">MaxFileSize</span>&gt;</span>20MB<span class="tag">&lt;/<span class="name">MaxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">TimeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss,GMT+8&#125; [%p][%c][%M][%L]-&gt; %m%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">append</span>&gt;</span>false<span class="tag">&lt;/<span class="name">append</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">prudent</span>&gt;</span>false<span class="tag">&lt;/<span class="name">prudent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;$&#123;log.root.level&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;stdot&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;file&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.xcshare<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xingyunpan<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>xingyunpan<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">springboot.version</span>&gt;</span>2.7.12<span class="tag">&lt;/<span class="name">springboot.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mybatis.version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">mybatis.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logback.version</span>&gt;</span>1.2.10<span class="tag">&lt;/<span class="name">logback.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.23<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aspectjweaver.version</span>&gt;</span>1.9.4<span class="tag">&lt;/<span class="name">aspectjweaver.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">fastjson.version</span>&gt;</span>1.2.66<span class="tag">&lt;/<span class="name">fastjson.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons.lang3.version</span>&gt;</span>3.4<span class="tag">&lt;/<span class="name">commons.lang3.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons.codec.version</span>&gt;</span>1.9<span class="tag">&lt;/<span class="name">commons.codec.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commons.io.version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">commons.io.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">openapi.version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">openapi.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">okhttp3.version</span>&gt;</span>3.2.0<span class="tag">&lt;/<span class="name">okhttp3.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--邮件发送--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springboot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--redis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springboot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 数据库--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mysql.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日志版本 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;logback.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--切面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;aspectjweaver.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--fastjson--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;fastjson.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--apache common--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-lang3<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons.lang3.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-codec<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons.codec.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-io<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;commons.io.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--Swagger依赖--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;dependency&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    &lt;groupId&gt;io.springfox&lt;/groupId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    &lt;artifactId&gt;springfox-boot-starter&lt;/artifactId&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--    &lt;version&gt;$&#123;swagger.version&#125;&lt;/version&gt;--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--&lt;/dependency&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 使用springdoc-openapi-ui来生成OpenAPI 3文档，</span></span><br><span class="line"><span class="comment">            因为它与Spring Boot 2.6.0兼容，而springfox-boot-starter 3.0.0不兼容 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springdoc<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springdoc-openapi-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;openapi.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--okhttp--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.squareup.okhttp3<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>okhttp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;okhttp3.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.lionsoul<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ip2region<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div><div class="article-footer"><blockquote class="mt-2x"><ul class="post-copyright list-unstyled"><li class="post-copyright-link hidden-xs"><strong>本文链接：</strong> <a href="http://www.xc234.ltd/2023/06/03/%E6%98%9F%E4%BA%91%E7%9B%98/" title="星云盘" target="_blank" rel="external">http://www.xc234.ltd/2023/06/03/%E6%98%9F%E4%BA%91%E7%9B%98/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by/4.0/deed.zh" target="_blank" rel="external">CC BY 4.0 CN协议</a> 许可协议。转载请注明出处！</li></ul></blockquote><div class="panel panel-default panel-badger"><div class="panel-body"><figure class="media"><div class="media-left"><a href="https://github.com/HAOTIANXINGCHEN" target="_blank" class="img-burn thumb-sm visible-lg"><img src="/images/avatar.jpg" class="img-rounded w-full" alt=""></a></div><div class="media-body"><h3 class="media-heading"><a href="https://github.com/HAOTIANXINGCHEN" target="_blank"><span class="text-dark">星辰</span><small class="ml-1x">不断学习的小菜鸡</small></a></h3><div>个人简介。</div></div></figure></div></div></div></article><section id="comments"><div id="vcomments"></div></section></div><nav class="bar bar-footer clearfix" data-stick-bottom><div class="bar-inner"><ul class="pager pull-left"><li class="next"><a href="/2022/07/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="设计模式学习笔记"><span>下一篇&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a></li></ul><div class="bar-right"><div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div></div></div></nav></main><footer class="footer" itemscope itemtype="http://schema.org/WPFooter"><ul class="social-links"><li><a href="https://github.com/HAOTIANXINGCHEN" target="_blank" title="Github"><i class="icon icon-github"></i></a></li><li><a href="https://weibo.com/u/5202817724" target="_blank" title="Weibo"><i class="icon icon-weibo"></i></a></li><li><a href="/null" target="_blank" title="Twitter"><i class="icon icon-twitter"></i></a></li><li><a href="/null" target="_blank" title="Behance"><i class="icon icon-behance"></i></a></li><li><a href="/atom.xml" target="_blank" title="Rss"><i class="icon icon-rss"></i></a></li></ul><div class="copyright"><div class="publishby">Theme by <a href="https://github.com/cofess" target="_blank">cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.</div></div></footer><script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script><script>window.jQuery||document.write('<script src="js/jquery.min.js"><\/script>')</script><script src="/js/plugin.min.js"></script><script src="/js/application.js"></script><script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"文章",PAGES:"页面",CATEGORIES:"分类",TAGS:"标签",UNTITLED:"(未命名)"},ROOT_URL:"/",CONTENT_URL:"/content.json"}</script><script src="/js/insight.js"></script><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/npm/valine"></script><script type="text/javascript">var GUEST=["nick","mail","link"],meta=(meta="nick,mail,link").split(",").filter(function(e){return-1<GUEST.indexOf(e)});new Valine({el:"#vcomments",verify:!1,notify:!1,appId:"",appKey:"",placeholder:"Just go go",avatar:"mm",meta:meta,pageSize:"10",visitor:!1})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618,"jsonPath":"/live2dw/assets/assets/haru01.model.json"},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.8},"log":false});</script></body></html>